System.register(["jimu-core","jimu-ui","jimu-ui/basic/list-tree","jimu-theme","jimu-arcgis","jimu-ui/basic/sql-expression-runtime","jimu-layouts/layout-runtime"],(function(e,t){var a={},n={},s={},o={},l={},r={},i={};return{setters:[function(e){a.BaseVersionManager=e.BaseVersionManager,a.CONSTANTS=e.CONSTANTS,a.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.Immutable=e.Immutable,a.MessageManager=e.MessageManager,a.React=e.React,a.ReactRedux=e.ReactRedux,a.RecordSetChangeType=e.RecordSetChangeType,a.ResizeObserver=e.ResizeObserver,a.appConfigUtils=e.appConfigUtils,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.injectIntl=e.injectIntl,a.jsx=e.jsx,a.lodash=e.lodash,a.moduleLoader=e.moduleLoader},function(e){n.Button=e.Button,n.Checkbox=e.Checkbox,n.DataActionDropDown=e.DataActionDropDown,n.Icon=e.Icon,n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.MobilePanel=e.MobilePanel,n.Modal=e.Modal,n.ModalBody=e.ModalBody,n.ModalFooter=e.ModalFooter,n.NumericInput=e.NumericInput,n.Pagination=e.Pagination,n.PanelHeader=e.PanelHeader,n.Popper=e.Popper,n.Select=e.Select,n.Tooltip=e.Tooltip,n.WidgetPlaceholder=e.WidgetPlaceholder,n.hooks=e.hooks},function(e){s.List=e.List,s.TreeItemActionType=e.TreeItemActionType},function(e){o.withTheme=e.withTheme},function(e){l.JimuMapViewComponent=e.JimuMapViewComponent,l.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.SqlExpressionRuntime=e.SqlExpressionRuntime,r.getShownClauseNumberByExpression=e.getShownClauseNumberByExpression},function(e){i.LayoutItemSizeModes=e.LayoutItemSizeModes}],execute:function(){e((()=>{var e={73379:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.417 0H0v12.888h5.607v-.805H.8V.806h12.815V6.04h.801V0z" fill="#fff"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.412 14.902a4.373 4.373 0 002.868-1.067L15.434 16l.566-.57-2.161-2.173c.612-.761.979-1.73.979-2.785 0-2.447-1.973-4.43-4.405-4.43-2.433 0-4.406 1.983-4.406 4.43 0 2.447 1.973 4.43 4.405 4.43zm0-.805c1.991 0 3.605-1.623 3.605-3.625s-1.614-3.625-3.604-3.625c-1.991 0-3.605 1.623-3.605 3.625s1.614 3.625 3.604 3.625z" fill="#fff"></path><path d="M2.403 2.417h9.611v.805H2.403v-.805zM7.209 4.833H2.403v.806h4.806v-.806zM2.403 7.25h2.403v.805H2.403V7.25zM4.806 9.666H2.403v.806h2.403v-.806z" fill="#fff"></path></svg>'},10119:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 4l-6 8-6-8h12z" fill="#000"></path></svg>'},98940:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 2l8 6-8 6V2z" fill="#000"></path></svg>'},95369:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 7a1 1 0 100 2 1 1 0 000-2zm5 1a1 1 0 112 0 1 1 0 01-2 0zm6 0a1 1 0 112 0 1 1 0 01-2 0z" fill="#000"></path></svg>'},33869:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 7.5a.522.522 0 01-.516.527H2.976L6.473 11.6a.535.535 0 010 .746.508.508 0 01-.73 0L1 7.5l4.743-4.846a.508.508 0 01.73 0 .535.535 0 010 .746L2.976 6.973h11.508c.285 0 .516.236.516.527z" fill="#000"></path></svg>'},3273:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.653 13.854a.485.485 0 010-.708L10.24 8 4.653 2.854a.485.485 0 010-.708.538.538 0 01.738 0l5.956 5.5a.485.485 0 010 .708l-5.956 5.5a.538.538 0 01-.738 0z" fill="#000"></path></svg>'},65283:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M.438 1C.196 1 0 1.224 0 1.5s.196.5.438.5h15.124c.242 0 .438-.224.438-.5s-.196-.5-.438-.5H.438zM0 7.5c0-.276.196-.5.438-.5h15.124c.242 0 .438.224.438.5s-.196.5-.438.5H.438C.196 8 0 7.776 0 7.5zM0 13.5c0-.276.196-.5.438-.5h15.124c.242 0 .438.224.438.5s-.196.5-.438.5H.438C.196 14 0 13.776 0 13.5z" fill="#000"></path></svg>'},54357:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6.5a.5.5 0 011 0v6a.5.5 0 01-1 0v-6zM9.5 6a.5.5 0 00-.5.5v6a.5.5 0 001 0v-6a.5.5 0 00-.5-.5z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M11 0H5a1 1 0 00-1 1v2H.5a.5.5 0 000 1h1.6l.81 11.1a1 1 0 00.995.9h8.19a1 1 0 00.995-.9L13.9 4h1.6a.5.5 0 000-1H12V1a1 1 0 00-1-1zm0 3V1H5v2h6zm1.895 1h-9.79l.8 11h8.19l.8-11z" fill="#000"></path></svg>'},88866:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5.5a1 1 0 100-2 1 1 0 000 2zM6.5 7.5A.5.5 0 017 7h1.5v4.5h1a.5.5 0 010 1h-3a.5.5 0 010-1h1V8H7a.5.5 0 01-.5-.5z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16A8 8 0 118 0a8 8 0 010 16zm0-1A7 7 0 108 1a7 7 0 000 14z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125L14.334 14H1.667L8 2.125zm-.882-.47a1 1 0 011.765 0l6.333 11.874A1 1 0 0114.334 15H1.667a1 1 0 01-.882-1.47L7.118 1.653zM8 4.874a.905.905 0 00-.9.995l.35 3.507a.552.552 0 001.1 0L8.9 5.87a.905.905 0 00-.9-.995zm1 7a1 1 0 11-2 0 1 1 0 012 0z" fill="#000"></path></svg>'},94539:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 4.796L4.796 4 8.02 7.224l3.184-3.184.796.796L8.816 8.02l3.144 3.144-.796.796L8.02 8.816 4.836 12l-.796-.796L7.224 8.02 4 4.796z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M0 4l4-4h8l4 4v8l-4 4H4l-4-4V4zm1 .414L4.414 1h7.172L15 4.414v7.172L11.586 15H4.414L1 11.586V4.414z" fill="#000"></path></svg>'},26826:e=>{"use strict";e.exports=l},48891:e=>{"use strict";e.exports=a},74758:e=>{"use strict";e.exports=i},34796:e=>{"use strict";e.exports=o},30726:e=>{"use strict";e.exports=n},59587:e=>{"use strict";e.exports=s},15506:e=>{"use strict";e.exports=r}},t={};function c(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,c),s.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var a in t)c.o(t,a)&&!c.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{default:()=>Ke});var e,t,a,n,s,o,l,r,i,d,p,m=c(48891),f=c(30726);!function(e){e.Point="Point",e.Polyline="Polyline",e.Polygon="Polygon",e.Rectangle="Rectangle",e.Circle="Circle"}(e||(e={})),function(e){e.NewSelection="NEW_SELECTION",e.AddToSelection="ADD_TO_CURRENT_SELECTION",e.RemoveFromSelection="REMOVE_FROM_CURRENT_SELECTION",e.SubsetSelection="SUBSET_FROM_CURRENT_SELECTION",e.SwitchSelction="SWITCH_CURRENT_SELECTION"}(t||(t={})),function(e){e.Block="BLOCK",e.Inline="INLINE",e.Popper="POPPER"}(a||(a={})),function(e){e.CurrentMapExtent="CurrentMapExtent",e.InteractiveDrawMode="InteractiveDrawMode",e.None=""}(n||(n={})),function(e){e.Intersect="intersects",e.Contain="contains",e.Cross="crosses",e.EnvelopeIntersect="envelope-intersects",e.IndexIntersect="index-intersects",e.Overlap="overlaps",e.Touch="touches",e.Within="within"}(s||(s={})),function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.Yards="Yards",e.NauticalMiles="NauticalMiles"}(o||(o={})),function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(l||(l={})),function(e){e.MultiPage="MultiPage",e.LazyLoad="LazyLoad"}(r||(r={})),function(e){e.PopupSetting="PopupSetting",e.SelectAttributes="SelectAttributes"}(i||(i={})),function(e){e.Asc="Asc",e.Desc="Desc"}(d||(d={})),function(e){e.DefaultSymbol="DefaultSymbol",e.CustomSymbol="CustomSymbol"}(p||(p={}));const g={_widgetLabel:"Query",noDataAvailable:"Error in loading data",noQueryItem:"No query",newQueryHint:'Add content by clicking the "{label}" button on the configuration panel',attributeFilter:"Attribute filter",spatialFilter:"Spatial filter",spatialFilterType_CurrentMapExtent:"Current map extent",spatialFilterType_InteractiveDrawMode:"Drawn graphic",relationship:"Relationship",spatialRelation_Intersect:"Intersect",spatialRelation_Contain:"Contain",spatialRelation_Cross:"Cross",spatialRelation_EnvelopeIntersect:"Envelope Intersect",spatialRelation_IndexIntersect:"Index Intersect",spatialRelation_Overlap:"Overlap",spatialRelation_Touch:"Touch",spatialRelation_Within:"Within",results:"Results",featuresDisplayed:"Features displayed",clearResult:"Clear results",checkResult:"Check results",mapMustBeVisible:"Map must be visible",chooseFilterType:"Choose the filter type",chooseGeometryType:"Choose the geometry type",clearDrawing:"Clear the graphic when applying",featureFromDs:"Selecting features from data source",featureFromMap:"Geometries from a map",chooseFilterLayer:"Choose a filter layer",selectedRecords:"{num} records are selected for the filter",bufferDistance:"Buffer distance",unit_Miles:"Miles",unit_Kilometers:"Kilometers",unit_Feet:"Feet",unit_Meters:"Meters",unit_Yards:"Yards",unit_NauticalMiles:"Nautical miles",spatialNotAvailable:"Spatial filter is not available here.",spatialNotAvailableDesc:"Spatial filter is not supported for a data source that already contains a spatial query."};var v=c(79964),h=c.n(v),y=c(94539),x=c.n(y),S=c(33869),b=c.n(S),R=c(3273),w=c.n(R),j=c(54357),I=c.n(j),C=c(95369),N=c.n(C);const M=()=>({iconMap:{iconQuery:c(73379),iconWarning:h(),iconError:x(),arrowNavBack:b(),arrowRight:w(),toolDelete:I(),iconMore:N()},unitInfoMap:{[o.Miles]:"miles",[o.Kilometers]:"kilometers",[o.Feet]:"feet",[o.Meters]:"meters",[o.Yards]:"yards",[o.NauticalMiles]:"nauticalMiles"},spatialRelationInfoMap:{[s.Intersect]:"intersects",[s.Contain]:"contains",[s.Cross]:"crosses",[s.EnvelopeIntersect]:"envelope-intersects",[s.IndexIntersect]:"index-intersects",[s.Overlap]:"overlaps",[s.Touch]:"touches",[s.Within]:"within"}});class D extends m.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.5.0",description:"1.5.0",upgrader:e=>{var t;let a=e;return null===(t=e.queryItems)||void 0===t||t.forEach(((e,t)=>{null==e.useAttributeFilter&&(a=a.setIn(["queryItems",t,"useAttributeFilter"],!0)),null==e.useSpatialFilter&&(a=a.setIn(["queryItems",t,"useSpatialFilter"],!0))})),a}},{version:"1.6.0",description:"1.6.0",upgrader:e=>{var t;let a=e;if((null===(t=e.queryItems)||void 0===t?void 0:t.length)>0){const t=e.queryItems[0];a=a.set("resultListDirection",t.resultListDirection),a=a.set("resultPagingStyle",t.resultPagingStyle)}return a}}]}}const O=new D;var T=c(59587),k=c(34796);const{useState:E}=m.React;var P;(0,k.withTheme)((e=>{const{theme:t,panelVisible:a,setPanelVisible:n,getI18nMessage:s,isModal:o=!0,title:l=s("queryMessage"),bodyContent:r="",hasHeader:i=!0,hasFooter:c=!0}=e,u=()=>n(!1),d=()=>(0,m.jsx)(m.React.Fragment,null,i&&(0,m.jsx)(f.PanelHeader,{className:"py-2",title:l,onClose:u}),(0,m.jsx)(f.ModalBody,null,r),c&&(0,m.jsx)(f.ModalFooter,null,(0,m.jsx)(f.Button,{onClick:u},s("ok")))),p="ui-unit-dialog-panel";return o?(0,m.jsx)(f.Modal,{className:`${p}`,isOpen:a,toggle:u,backdrop:"static"},d()):(0,m.jsx)("div",{className:`${p} modal-dialog ${a?"":"collapse"}`,css:m.css`
      &.ui-unit-dialog-panel.modal-dialog {
        margin: 0;
        width: 100%;
        .modal-content {
          background-color: ${t.colors.palette.light[600]};
          color: ${t.colors.black};
          font-size: .75rem;
          font-weight: 400;
          border: none;
          .panel-header {
            font-size: .8125rem;
            padding: .625rem;
          }
          .modal-body {
            padding: 0 .625rem .75rem;
            white-space: normal;
          }
        }
      }
    `},(0,m.jsx)("div",{className:"modal-content"},d()))})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(P||(P={}));const z=(0,k.withTheme)((e=>{const{theme:t,className:a,title:n,statusType:s}=e;return s&&(0,m.jsx)("div",{className:`${null!=a?a:""} ui-unit-status-indicator ui-unit-status-indicator_status-type-${s}`,title:n,css:m.css`
    &.ui-unit-status-indicator {
      display: flex;
      &.ui-unit-status-indicator_status-type-loading {
        &:before {
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          content: '';
          width: 1rem;
          height: 1rem;
          display: block;
          border: 1px solid ${null===(r=null===(l=null===(o=null==t?void 0:t.colors)||void 0===o?void 0:o.palette)||void 0===l?void 0:l.light)||void 0===r?void 0:r[400]};
          border-radius: 50%;
          border-top: 1px solid ${null===(u=null===(c=null===(i=null==t?void 0:t.colors)||void 0===i?void 0:i.palette)||void 0===c?void 0:c.primary)||void 0===u?void 0:u[600]};
          box-sizing: border-box;
          animation: loading 2s infinite linear;
          margin-right: .25rem;
        }
      }
    }
  `});var o,l,r,i,c,u}));function L(e){var t,a,n;const{useDataSource:s,onStatusChange:o,onDataSourceCreated:l,showMessage:r=!1}=e,i=f.hooks.useTranslate(),[c,u]=m.React.useState(null),[d,p]=m.React.useState(null),g=m.React.useCallback((e=>{if(e){const{status:t,instanceStatus:a}=e;a===m.DataSourceStatus.NotCreated?(u("creating"),null==o||o(!1)):a===m.DataSourceStatus.CreateError||t===m.DataSourceStatus.LoadError?(u("error"),null==o||o(!1)):t===m.DataSourceStatus.NotReady?(u("warning"),null==o||o(!1)):(u(null),null==o||o(!0))}}),[o]),v=m.React.useCallback((e=>{p(e),null==l||l(e)}),[l]),y=m.React.useCallback((()=>{p(null),u("error"),null==o||o(!1)}),[o]);let S,b,R;if("creating"===c)S=x(),b=i("loading");else if("error"===c)S=x(),b=i("dataSourceCreateError"),R="var(--danger-500)";else if("warning"===c){const e=null===(t=null==d?void 0:d.getOriginDataSources())||void 0===t?void 0:t[0],o=null==e?void 0:e.getLabel(),l=m.appConfigUtils.getWidgetIdByOutputDataSource(s),r=null===(n=((null===(a=null===window||void 0===window?void 0:window.jimuConfig)||void 0===a?void 0:a.isBuilder)?(0,m.getAppStore)().getState().appStateInBuilder:(0,m.getAppStore)().getState()).appConfig.widgets[l])||void 0===n?void 0:n.label;R="var(--warning-700)",S=h(),b=i("outputDataIsNotGenerated",{outputDsLabel:null!=o?o:"",sourceWidgetName:null!=r?r:""})}return(0,m.jsx)(m.React.Fragment,null,(0,m.jsx)(m.DataSourceComponent,{useDataSource:s,onDataSourceInfoChange:g,onDataSourceCreated:v,onCreateDataSourceFailed:y}),"creating"===c&&(0,m.jsx)(z,{statusType:P.Loading,title:b}),("error"===c||"warning"===c)&&(0,m.jsx)("div",{className:"d-flex align-items-center"},(0,m.jsx)(f.Tooltip,{title:b},(0,m.jsx)(f.Button,{size:"sm",type:"tertiary",icon:!0},(0,m.jsx)(f.Icon,{icon:S,color:R}))),r&&(0,m.jsx)("div",{className:"status-message"},b)))}const B=m.css`
  font-weight: 500;
  font-size: 14px;
`;function F(e){const{icon:t,name:a}=e;return(0,m.jsx)("div",{className:"d-flex align-items-center text-truncate",css:B},t&&(0,m.jsx)(f.Icon,{className:"query-task-icon mr-2",icon:t.svg}),(0,m.jsx)("div",{className:"text-truncate",title:a},a))}const _={icon:null,displayLabel:!0,sqlExprObj:null,useAttributeFilter:!0,useSpatialFilter:!0,spatialMapWidgetIds:[],spatialFilterTypes:[],spatialInteractiveCreateToolTypes:[e.Point,e.Polyline,e.Polygon,e.Rectangle,e.Circle],spatialInteractiveEnableBuffer:!1,spatialInteractiveBufferDistance:0,spatialInteractiveBufferUnit:o.Meters,spatialRelations:[s.Intersect],spatialRelationUseDataSources:[],spatialRelationEnableSelectTool:!1,spatialRelationEnableBuffer:!1,spatialRelationBufferDistance:0,spatialRelationBufferUnit:o.Meters,resultListDirection:l.Vertical,resultPagingStyle:r.MultiPage,resultFieldsType:i.PopupSetting,resultSymbolType:p.DefaultSymbol,resultCustomSymbol:{angle:0,color:[255,255,255,255],outline:{color:[255,255,255,255],style:"esriSLSSolid",type:"esriSLS",width:1},size:6,style:"esriSMSCircle",type:"esriSMS",xoffset:0,yoffset:0},resultAllowChangeSymbol:!1,allowExport:!1,sortOptions:[],itemSizeMap:{arrangementHorizontalPopper:{minSize:{width:300,height:300},defaultSize:{width:360,height:480}}}},{iconMap:q}=M(),A=m.css`
  height: 32px;
`;function V(e){const{queryItem:t,onStatusChange:a}=e,[n,s]=m.React.useState(!0),o=Object.assign({},_,t),{icon:l,name:r,useDataSource:i}=o;return(0,m.jsx)("div",{className:"d-flex align-items-center pl-2 pr-1 w-100",css:A},(0,m.jsx)(F,{icon:l,name:r}),(0,m.jsx)("div",{className:"ml-auto"},(0,m.jsx)(L,{useDataSource:i,onStatusChange:e=>{s(e),a(e)}})),(0,m.jsx)(f.Button,{"aria-label":r,className:"ml-2",size:"sm",type:"tertiary",disabled:!n,icon:!0},(0,m.jsx)(f.Icon,{size:16,icon:q.arrowRight,autoFlip:!0})))}const $=e=>{const{className:t}=e,a=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a}(e,["className"]),n=(0,m.classNames)("jimu-icon-component",t);return m.React.createElement(f.Icon,Object.assign({className:n,icon:I()},a))};var U=c(26826),H=c(15506);const W=m.React.createContext({resetSymbol:null});function G(e){const{distance:t=0,unit:a=o.Meters,onBufferChange:n}=e,s=f.hooks.useTranslate(g),[l,r]=m.React.useState(t),[i,c]=m.React.useState(a),u=m.React.useContext(W),d=m.React.useRef(u.resetSymbol);m.React.useEffect((()=>{let e=!1;t!==l&&(r(t),e=!0),a!==i&&(c(a),e=!0),e&&n(t,a)}),[t,a]),m.React.useEffect((()=>{u.resetSymbol&&u.resetSymbol!==d.current&&(d.current=u.resetSymbol,r(t),c(a),n(t,a))}),[u.resetSymbol,t,a,n]);const p=m.React.useCallback((e=>{r(e)}),[]),v=m.React.useCallback((e=>{r(e),n(e,i)}),[n,i]),h=m.React.useCallback((e=>{c(e.target.value),n(l,e.target.value)}),[n,l]);return(0,m.jsx)(m.React.Fragment,null,(0,m.jsx)(f.NumericInput,{"aria-label":s("bufferDistance"),className:"mr-1",value:l,onChange:p,onAcceptValue:v}),(0,m.jsx)(f.Select,{"aria-label":s("unit"),value:i,onChange:h},Object.values(o).map((e=>(0,m.jsx)("option",{key:e,value:e},s(`unit_${e}`))))))}const J=m.css`margin-top: 0.75rem;`;function Q(e){const{onSelectionChange:t,useDataSources:a,spatialRelations:n,enableBuffer:o,bufferDistance:l,bufferUnit:r,onBufferChange:i,onRelationChange:c}=e,u=f.hooks.useTranslate(g),[d,p]=m.React.useState(a[0]),[v,h]=m.React.useState(0),[y,x]=m.React.useState(null==n?void 0:n[0]),S=m.React.useContext(W),b=m.React.useRef(S.resetSymbol),R=m.React.useMemo((()=>Object.entries(s).map((([e,t])=>({value:t,label:u(`spatialRelation_${e}`)})))),[u]);f.hooks.useEffectOnce((()=>{(null==n?void 0:n.length)>0&&c(n[0]),o&&i(l,r)})),m.React.useEffect((()=>{S.resetSymbol&&S.resetSymbol!==b.current&&(b.current=S.resetSymbol,x(null==n?void 0:n[0]),c(null==n?void 0:n[0]))}),[S.resetSymbol,c,n]),m.React.useEffect((()=>{n?n.includes(y)||(x(n[0]),c(n[0])):x(null)}),[n,y,c]);const w=m.React.useCallback((e=>{const t=a.find((t=>t.dataSourceId===e.target.value));p((0,m.Immutable)(t))}),[a]),j=m.React.useCallback((()=>{const e=m.DataSourceManager.getInstance().getDataSource(d.dataSourceId),a=null==e?void 0:e.getSelectedRecords();if((null==a?void 0:a.length)>0){const e=a.map((e=>e.getGeometry()));t(e),h(a.length)}else t(null),h(0)}),[d.dataSourceId,t]),I=m.React.useCallback((e=>{x(e.target.value),c(e.target.value)}),[c]);return(0,m.jsx)("div",null,(0,m.jsx)("div",{css:J},u("chooseFilterLayer")),(0,m.jsx)(f.Select,{"aria-label":u("chooseFilterLayer"),value:d.dataSourceId,onChange:w},a.map((e=>{const t=m.DataSourceManager.getInstance().getDataSource(e.dataSourceId);return(0,m.jsx)("option",{key:e.dataSourceId,value:e.dataSourceId},null==t?void 0:t.getLabel())}))),(0,m.jsx)("div",{className:"mt-1 font-italic",css:m.css`color: var(--dark-800);`},u("selectedRecords",{num:v})),(null==n?void 0:n.length)>0&&(0,m.jsx)("div",{css:J},(0,m.jsx)("div",{className:"text-truncate mb-0"},u("relationship")),(0,m.jsx)(f.Select,{"aria-label":u("relationship"),value:y,onChange:I},n.map((e=>{return(0,m.jsx)("option",{key:e,value:e},(t=e,R.find((e=>e.value===t)).label));var t})))),o&&(0,m.jsx)("div",{role:"group","aria-label":u("bufferDistance"),css:J},(0,m.jsx)("div",{className:"text-truncate"},u("bufferDistance")),(0,m.jsx)("div",{className:"d-flex mt-1"},(0,m.jsx)(G,{distance:l,unit:r,onBufferChange:i}))),(0,m.jsx)(m.DataSourceComponent,{useDataSource:d,onDataSourceInfoChange:j}))}function K(e){const{onGeometryChange:t,mapWidgetIds:a}=e,[n,s]=m.React.useState(null),o=m.React.useRef(null);m.React.useEffect((()=>{if(null==n?void 0:n.view){const e=n.view.watch("extent",(e=>{o.current?t(o.current.fromExtent(e)):(0,U.loadArcGISJSAPIModules)(["esri/geometry/Polygon"]).then((a=>{o.current=a[0],t(o.current.fromExtent(e))}))}));return t(n.view.extent),()=>{e.remove()}}}),[n,t]);const l=m.React.useCallback((e=>{s(null!=(null==e?void 0:e.view)?e:null)}),[]);return(0,m.jsx)(m.React.Fragment,null,null==a?void 0:a.map(((e,t)=>(0,m.jsx)(U.JimuMapViewComponent,{key:t,useMapWidgetId:e,onActiveViewChange:l}))))}const Y={[e.Point]:{drawToolName:"point",esriClassName:"esri-icon-point",toolIndex:0},[e.Polyline]:{drawToolName:"polyline",esriClassName:"esri-icon-polyline",toolIndex:4},[e.Polygon]:{drawToolName:"polygon",esriClassName:"esri-icon-polygon",toolIndex:2},[e.Rectangle]:{drawToolName:"rectangle",esriClassName:"esri-icon-checkbox-unchecked",toolIndex:1},[e.Circle]:{drawToolName:"circle",esriClassName:"esri-icon-radio-unchecked",toolIndex:3}};function Z(e){const{toolTypes:t=[],jimuMapView:a,onDrawEnd:n}=e,s=f.hooks.useTranslate(g),[o,l]=m.React.useState(null),r=m.React.useRef(null),i=m.React.useRef(null),[c,u]=m.React.useState(!1),d=m.React.useMemo((()=>({createTools:Object.entries(Y).reduce(((e,[a,n])=>Object.assign(Object.assign({},e),{[n.drawToolName]:t.includes(a)})),{point:!1}),selectionTools:{"lasso-selection":!1,"rectangle-selection":!1},settingsMenu:!1,undoRedoMenu:!1})),[t]);f.hooks.useEffectOnce((()=>{m.moduleLoader.loadModule("jimu-ui/advanced/map").then((e=>{l(e)}))}));const p=m.React.useCallback((({sketch:e})=>{r.current=e.layer}),[]),v=m.React.useCallback((()=>{var e;null===(e=r.current)||void 0===e||e.removeAll()}),[]),h=m.React.useCallback((e=>{i.current=e,n(e,r.current,c)}),[n,c]),y=m.React.useCallback((()=>{i.current=null,n(null)}),[n]),x=m.React.useCallback((e=>{i.current&&n(i.current,r.current,e.target.checked),u(e.target.checked)}),[n]),S=null==o?void 0:o.Draw;return S?Object.keys(d.createTools).some((e=>d.createTools[e]))?(0,m.jsx)("div",null,(0,m.jsx)(S,{jimuMapView:a,disableSymbolSelector:!0,updateOnGraphicClick:!1,creationMode:"single",visibleElements:d,onDrawToolCreated:p,onDrawStart:v,onDrawEnd:h,onDrawToolCleared:y}),(0,m.jsx)("label",{className:"d-flex align-items-center"},(0,m.jsx)(f.Checkbox,{checked:c,onChange:x,className:"mr-2"}),s("clearDrawing"))):null:(0,m.jsx)(z,{statusType:P.Loading})}function X(e){const{onGeometryChange:t,createToolTypes:a,mapWidgetIds:n,enableBuffer:s,bufferDistance:o,bufferUnit:l,onBufferChange:r}=e,[i,c]=m.React.useState(null),u=f.hooks.useTranslate(g),d=m.React.useContext(W),p=m.React.useRef(d.resetSymbol),v=m.React.useRef(null);f.hooks.useEffectOnce((()=>{s&&r(o,l)})),m.React.useEffect((()=>{var e;d.resetSymbol&&d.resetSymbol!==p.current&&(p.current=d.resetSymbol,null===(e=v.current)||void 0===e||e.removeAll(),t(null))}),[d.resetSymbol,t]);const h=m.React.useCallback((e=>{c(null!=(null==e?void 0:e.view)?e:null)}),[]),y=m.React.useCallback(((e,a,n)=>{v.current=a,t(null==e?void 0:e.geometry,a,e,n)}),[t]);return(0,m.jsx)(m.React.Fragment,null,null==n?void 0:n.map(((e,t)=>(0,m.jsx)(U.JimuMapViewComponent,{key:t,useMapWidgetId:e,onActiveViewChange:h}))),(null==i?void 0:i.view)&&(0,m.jsx)(m.React.Fragment,null,(0,m.jsx)(Z,{jimuMapView:i,toolTypes:a,onDrawEnd:y}),s&&(0,m.jsx)("div",{role:"group","aria-label":u("bufferDistance"),css:m.css`margin-top: 0.75rem;`},(0,m.jsx)("div",{className:"text-truncate"},u("bufferDistance")),(0,m.jsx)("div",{className:"d-flex mt-1"},(0,m.jsx)(G,{distance:o,unit:l,onBufferChange:r})))))}var ee=c(88866),te=c.n(ee);const ae=e=>{const{className:t}=e,a=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a}(e,["className"]),n=(0,m.classNames)("jimu-icon-component",t);return m.React.createElement(f.Icon,Object.assign({className:n,icon:te()},a))};function ne(e){var t;const{label:a,desc:s,filterTypes:l,mapWidgetIds:r,onFilterChange:i,onRelationChange:c,onBufferChange:u,useDataSources:d,spatialRelations:p,dsEnableBuffer:v,dsBufferDistance:h,dsBufferUnit:y,drawEnableBuffer:x,drawBufferDistance:S,drawBufferUnit:b,createToolTypes:R}=e,w=f.hooks.useTranslate(g),j=m.React.useRef(null),I=m.ReactRedux.useSelector((e=>{if((null==r?void 0:r.length)>0){const t=r[0];return null!=e.appConfig.widgets[t]}return!1})),C=m.React.useMemo((()=>I&&((null==l?void 0:l.includes(n.CurrentMapExtent))||(null==l?void 0:l.includes(n.InteractiveDrawMode)))),[l,I]),N=m.React.useMemo((()=>{const e=[];return(null==d?void 0:d.length)>0&&e.push({value:"data",label:w("featureFromDs")}),C&&(null==l?void 0:l.includes(n.CurrentMapExtent))&&e.push({value:"map",label:w(`spatialFilterType_${n.CurrentMapExtent}`)}),C&&(null==l?void 0:l.includes(n.InteractiveDrawMode))&&e.push({value:"draw",label:w(`spatialFilterType_${n.InteractiveDrawMode}`)}),e}),[C,d,w,l]),[M,D]=m.React.useState(null===(t=null==N?void 0:N[0])||void 0===t?void 0:t.value);m.React.useEffect((()=>{var e;"none"===M||N.find((e=>e.value===M))||D(null===(e=null==N?void 0:N[0])||void 0===e?void 0:e.value)}),[M,N]),m.React.useEffect((()=>{"map"!==M&&"draw"!==M&&"none"!==M||(c(null),u(0,o.Meters),i({geometry:null})),"data"===M&&null==j.current&&i({geometry:null})}),[M,c,u,i]);const O=m.React.useCallback((e=>D(e.target.value)),[]),T=m.React.useCallback(((e,t,a,n)=>{i({geometry:e,graphic:a,layer:t,clearAfterApply:n})}),[i]),k=m.React.useCallback((e=>{j.current=e,i({geometry:e})}),[i]);return(null==d?void 0:d.length)>0||C?(0,m.jsx)("div",{role:"group","aria-label":a},(0,m.jsx)("div",{className:(0,m.classNames)("form-title my-2 d-flex align-items-center",{"d-none":!a&&!s})},a&&(0,m.jsx)("div",{className:"mr-2"},a),s&&(0,m.jsx)(f.Tooltip,{placement:"bottom",css:m.css`white-space: pre-line;`,title:s},(0,m.jsx)(f.Button,{size:"sm",icon:!0,type:"tertiary"},(0,m.jsx)(ae,{color:"var(--primary)",size:"s"})))),N.length>0&&(0,m.jsx)("div",null,(0,m.jsx)("div",null,w("chooseFilterType")),(0,m.jsx)(f.Select,{"aria-label":w("chooseFilterType"),css:m.css`height: 32px;`,value:M,onChange:O},(0,m.jsx)("option",{key:"-",value:"none"},"-"),N.map((e=>(0,m.jsx)("option",{key:e.value,value:e.value},e.label))))),"data"===M&&(0,m.jsx)(Q,{enableBuffer:v,bufferDistance:h,bufferUnit:y,spatialRelations:p,useDataSources:d,onSelectionChange:k,onRelationChange:c,onBufferChange:u}),"map"===M&&(0,m.jsx)(K,{mapWidgetIds:r,createToolTypes:R,onGeometryChange:T}),"draw"===M&&(0,m.jsx)(X,{enableBuffer:x,bufferDistance:S,bufferUnit:b,mapWidgetIds:r,createToolTypes:R,onGeometryChange:T,onBufferChange:u})):null}var se=c(74758);const oe=m.React.createContext(null);function le(){const e=m.React.useContext(oe);let t,a;if(e.includes(":")){const n=e.split(":");t=n[0],a=n[1]}return m.ReactRedux.useSelector((e=>{var n,s,o,l;const r=null===(s=null===(n=e.appConfig.layouts[t])||void 0===n?void 0:n.content)||void 0===s?void 0:s[a];return(null===(l=null===(o=null==r?void 0:r.setting)||void 0===o?void 0:o.autoProps)||void 0===l?void 0:l.height)===se.LayoutItemSizeModes.Auto}))}const re=e=>m.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .form-title {
      color: var(--dark-800);
      font-weight: 500;
      font-size: 13px;
      line-height: 18px;
    }
    .query-form__content {
      flex: 1 1 ${e?"auto":0};
      max-height: ${e?"61.8vh":"none"};
      overflow: auto;
    }
  `;function ie(e){const{widgetId:t,configId:a,outputDS:n,onFormSubmit:o}=e,l=m.ReactRedux.useSelector((e=>e.appConfig.widgets[t].config.queryItems.find((e=>e.configId===a)))),r=Object.assign({},_,l),i=f.hooks.useTranslate(g),[c,u]=m.React.useState(null),{useAttributeFilter:d,useSpatialFilter:p,spatialFilterTypes:v,sqlExprObj:h,spatialMapWidgetIds:y,spatialInteractiveCreateToolTypes:x,spatialRelationUseDataSources:S,spatialRelations:b,spatialRelationEnableBuffer:R,spatialRelationBufferDistance:w,spatialRelationBufferUnit:j,spatialInteractiveEnableBuffer:I,spatialInteractiveBufferDistance:C,spatialInteractiveBufferUnit:N,attributeFilterLabel:M=i("attributeFilter"),spatialFilterLabel:D=i("spatialFilter"),attributeFilterDesc:O,spatialFilterDesc:T}=r,[k,E]=m.React.useState(h),P=m.React.useRef(null),z=m.React.useRef(s.Intersect),L=m.React.useRef(null),B=le(),F=m.React.useRef((0,H.getShownClauseNumberByExpression)(h)),q=null==n?void 0:n.getOriginDataSources()[0];m.React.useEffect((()=>{h?(F.current=(0,H.getShownClauseNumberByExpression)(h),E(h)):(F.current=0,E(null))}),[h]);const A=m.React.useCallback((()=>{var e;Array.isArray(null===(e=P.current)||void 0===e?void 0:e.geometry)?(0,U.loadArcGISJSAPIModules)(["esri/geometry/geometryEngine"]).then((e=>{const t=e[0].union(P.current.geometry);o(k,Object.assign(Object.assign({},P.current),{geometry:t,relation:z.current,buffer:L.current}))})):o(k,Object.assign(Object.assign({},P.current),{relation:z.current,buffer:L.current}))}),[o,k]),V=m.React.useCallback((()=>{F.current=(0,H.getShownClauseNumberByExpression)(h),E(h),u(Symbol())}),[h]),$=m.React.useCallback((e=>{F.current=(0,H.getShownClauseNumberByExpression)(e),E(e)}),[]),G=m.React.useCallback((e=>{P.current=e}),[]),J=m.React.useCallback((e=>{z.current=e}),[]),Q=m.React.useCallback(((e,t)=>{L.current={distance:e,unit:t}}),[]),K=d&&null!=h,Y=p&&(v.length>0||(null==S?void 0:S.length)>0);return(0,m.jsx)(W.Provider,{value:{resetSymbol:c}},(0,m.jsx)("div",{className:"query-form",css:re(B)},(0,m.jsx)("div",{className:"query-form__content my-2"},K&&(0,m.jsx)("div",{role:"group","aria-label":M},(0,m.jsx)("div",{className:(0,m.classNames)("form-title my-2 d-flex align-items-center",{"d-none":!M&&!O})},M&&(0,m.jsx)("div",{className:"mr-2"},M),O&&(0,m.jsx)(f.Tooltip,{placement:"bottom",css:m.css`white-space: pre-line;`,title:O},(0,m.jsx)(f.Button,{size:"sm",icon:!0,type:"tertiary"},(0,m.jsx)(ae,{color:"var(--primary)",size:"s"})))),q&&(0,m.jsx)(H.SqlExpressionRuntime,{widgetId:t,dataSource:q,expression:k,onChange:$})),K&&Y&&(0,m.jsx)("hr",{className:"my-3",css:m.css`border: none; height: 1px; background-color: var(--light-300);`}),Y&&(0,m.jsx)(ne,{widgetId:t,label:D,desc:T,filterTypes:v,mapWidgetIds:y,createToolTypes:x,onFilterChange:G,onRelationChange:J,onBufferChange:Q,spatialRelations:b,dsEnableBuffer:R,dsBufferDistance:w,dsBufferUnit:j,drawEnableBuffer:I,drawBufferDistance:C,drawBufferUnit:N,useDataSources:S})),(0,m.jsx)("div",{className:"query-form__actions d-flex align-items-center"},(0,m.jsx)(f.Button,{className:"active ml-auto",onClick:A},i("apply")),(F.current>0||Y)&&(0,m.jsx)(f.Button,{className:"ml-2",onClick:V},i("reset")))))}var ce=c(98940),ue=c.n(ce);const de=e=>{const{className:t}=e,a=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a}(e,["className"]),n=(0,m.classNames)("jimu-icon-component",t);return m.React.createElement(f.Icon,Object.assign({className:n,icon:ue()},a))};var pe=c(10119),me=c.n(pe);const fe=e=>{const{className:t}=e,a=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a}(e,["className"]),n=(0,m.classNames)("jimu-icon-component",t);return m.React.createElement(f.Icon,Object.assign({className:n,icon:me()},a))};var ge;!function(e){e.Pending="Pending",e.Fulfilled="Fulfilled",e.Rejected="Rejected"}(ge||(ge={}));const ve=m.css`
  border: 1px solid var(--light-200);
  .esri-widget__heading {
    font-size: 14px;
    font-weight: 500;
    margin: 0;
    color: var(--black);
  }

  .esri-feature__content-element {
    padding: 0;
  }

  .jimu-btn.expanded {
    align-self: flex-start;
  }
`;class he extends m.React.PureComponent{constructor(e){super(e),this.toggleExpanded=e=>{e.stopPropagation(),this.setState({showContent:!this.state.showContent})};const{togglable:t=!1}=this.props;this.state={showContent:!t,loadStatus:ge.Pending}}componentDidMount(){this.createFeature()}componentDidUpdate(){this.feature&&(this.feature.graphic.popupTemplate=this.props.popupTemplate,this.feature.visibleElements=this.getVisibleElements())}destoryFeature(){this.feature&&!this.feature.destroyed&&this.feature.destroy()}getVisibleElements(){const{togglable:e=!1}=this.props,{showContent:t}=this.state,a=!e||t;return{title:!0,content:{fields:a,text:a,media:a,attachments:a},lastEditedInfo:!1}}createFeature(){let e;return e=this.Feature?Promise.resolve():(0,U.loadArcGISJSAPIModules)(["esri/widgets/Feature"]).then((e=>{[this.Feature]=e})),e.then((()=>{var e,t,a;const n=document&&document.createElement("div");n.className="jimu-widget",this.refs.featureContainer.appendChild(n);const s=this.props.dataSource.getOriginDataSources(),o=null===(e=null==s?void 0:s[0])||void 0===e?void 0:e.getRootDataSource();this.destoryFeature(),this.props.graphic.popupTemplate=this.props.popupTemplate,this.feature=new this.Feature({container:n,defaultPopupTemplateEnabled:!0,spatialReference:(null===(a=null===(t=this.props.dataSource)||void 0===t?void 0:t.layer)||void 0===a?void 0:a.spatialReference)||null,map:(null==o?void 0:o.map)||null,graphic:this.props.graphic,visibleElements:this.getVisibleElements()})})).then((()=>{this.setState({loadStatus:ge.Fulfilled})}))}render(){const{togglable:e=!1,intl:t}=this.props,{showContent:a}=this.state;return(0,m.jsx)("div",{className:"feature-info-component d-flex align-items-center p-2",css:ve},e&&(0,m.jsx)(f.Button,{"aria-label":t.formatMessage({id:a?"hide":"show"}),className:(0,m.classNames)("p-0",{expanded:a}),type:"tertiary",icon:!0,size:"sm",onClick:this.toggleExpanded},a?(0,m.jsx)(fe,{size:"s"}):(0,m.jsx)(de,{size:"s",autoFlip:!0})),(0,m.jsx)("div",{className:"flex-grow-1",ref:"featureContainer"}))}}const ye=(0,m.injectIntl)(he),xe=m.css`
  overflow: auto;
  flex-flow: row;
  cursor: pointer;
  flex-shrink: 0;
  min-height: 2rem;
  &.selected {
    .feature-info-component {
      border-color: var(--primary-500);
      border-width: 2px;
    }
  }
`,Se=e=>{const{widgetId:t,data:a,dataSource:n,popupTemplate:s}=e,o=m.ReactRedux.useSelector((e=>{var t,s,o;return null===(o=null===(s=null===(t=e.dataSourcesInfo)||void 0===t?void 0:t[n.id])||void 0===s?void 0:s.selectedIds)||void 0===o?void 0:o.includes(a.getId())})),r=m.ReactRedux.useSelector((e=>e.appConfig.widgets[t].config.resultListDirection!==l.Horizontal)),i=m.React.useCallback((()=>{var e,s;const o=a.getId(),l=(null!==(e=n.getSelectedRecordIds())&&void 0!==e?e:[]).includes(o)?[]:[a];m.MessageManager.getInstance().publishMessage(new m.DataRecordsSelectionChangeMessage(t,l)),null===(s=n.selectRecordsByIds)||void 0===s||s.call(n,l.map((e=>e.getId())))}),[t,a,n]);return(0,m.jsx)("div",{className:(0,m.classNames)("query-result-item",{selected:o}),onClick:i,css:xe,role:"option","aria-selected":o},(0,m.jsx)(ye,{graphic:a.feature,popupTemplate:s,togglable:r,dataSource:n}))};var be=function(e,t,a,n){return new(a||(a=Promise))((function(s,o){function l(e){try{i(n.next(e))}catch(e){o(e)}}function r(e){try{i(n.throw(e))}catch(e){o(e)}}function i(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,r)}i((n=n.apply(e,t||[])).next())}))};function Re(e,t){return be(this,void 0,void 0,(function*(){const{resultFieldsType:a,resultDisplayFields:n,resultTitleExpression:s=""}=t,o=e.getOriginDataSources()[0],l=yield o.getPopupInfo();if(a===i.SelectAttributes){let t=n;if(null==n){const a=e.getSchema();t=(null==a?void 0:a.fields)?Object.values(a.fields).map((e=>e.jimuName)):[]}if(l){const e=[];return t.forEach((t=>{const a=l.fieldInfos.find((e=>e.fieldName===t));a?e.push(a):e.push({fieldName:t,label:t})})),{content:[{type:"fields",fieldInfos:e}],title:s,outFields:["*"]}}return{content:[{type:"fields",fieldInfos:t.map((e=>({fieldName:e,label:e})))}],title:s,outFields:["*"]}}return null}))}function we(e,t,a){var n;return be(this,void 0,void 0,(function*(){const s=yield t.getPopupInfo(),o=t.getLayerDefinition(),l=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==o?void 0:o.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==s?void 0:s.fieldInfos)||[]).filter((e=>e.visible))),r=null===(n=t.getSchema())||void 0===n?void 0:n.fields,i=l.map((e=>e.fieldName)),c=r?Object.keys(r).filter((e=>i.includes(r[e].name))):[];t.setSelectedFields(c);const u=yield t.load(a,{widgetId:e}),d=t.getOriginDataSources()[0];if(!(null==d?void 0:d.layer)||d.isSelectionView()){const e=yield function(e){return be(this,void 0,void 0,(function*(){if(e.isSelectionView()){const t=e.getMainDataSource();if(t.layer)return yield t.layer.load(),t.layer;{const e=yield t.createJSAPILayerByDataSource();return yield e.load(),e}}if(e.layer)return yield e.layer.load(),e.layer;{const t=yield e.createJSAPILayerByDataSource();return yield t.load(),t}}))}(d);u.forEach((t=>{const a=t.feature;a.sourceLayer=e.associatedLayer||e,a.layer=a.sourceLayer}))}const p={records:u,fields:l.map((e=>e.fieldName))},f=new m.DataRecordSetChangeMessage(e,t.id,m.RecordSetChangeType.Update,{records:p.records,fields:p.fields,dataSource:t});return m.MessageManager.getInstance().publishMessage(f),p}))}const{useRef:je,useState:Ie}=m.React,Ce=e=>m.css`
    display: flex;
    flex: 1 1 ${e?"auto":0};
    overflow: auto;
    max-height: ${e?"calc(61.8vh - 100px)":"none"};

    .query-result-item + .query-result-item {
      margin-left: 0.5rem;
      margin-top: 0;
    }

    &.vertical {
      flex-direction: column;
      .list-items {
        position: relative;
        flex-direction: column;
      }

      .feature-info-component {
        width: 100%;
      }

      .query-result-item + .query-result-item {
        margin-left: 0;
        margin-top: 0.5rem;
      }
    }
    .list-items {
      display: flex;
    }
    .lazyload-detector {
      height: 2px;
      width: 2px;
      opacity: 0;
    }
  `;function Ne(e){var t;const{widgetId:a,outputDS:n,queryParams:s,resultCount:o,records:r,queryItem:i,direction:c,onRenderDone:u}=e,[d,p]=Ie(r),[g,v]=Ie(),[h,y]=Ie(P.Init),x=f.hooks.useRefValue(d),S=f.hooks.useRefValue(o),b=f.hooks.useRefValue(h),R=f.hooks.useRefValue((null==r?void 0:r.length)===o),w=je(0),j=je(),I=null!==(t=null==n?void 0:n.getQueryPageSize())&&void 0!==t?t:m.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE,C=je(null),N=le();m.React.useEffect((()=>{w.current=1,j.current.scrollTop=0,p(r)}),[r]);const M=()=>{return e=this,t=void 0,l=function*(){if(R.current||b.current===P.Loading)return;w.current=w.current+1,y(P.Loading);const{records:e}=yield we(a,n,Object.assign(Object.assign({},s),{page:w.current,pageSize:I}));S.current>0&&x.current.length+e.length>=S.current&&(R.current=!0);const t=x.current.concat(e);p(t),null==u||u({dataItems:t}),y(P.Loaded)},new((o=void 0)||(o=Promise))((function(a,n){function s(e){try{i(l.next(e))}catch(e){n(e)}}function r(e){try{i(l.throw(e))}catch(e){n(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}i((l=l.apply(e,t||[])).next())}));var e,t,o,l};return m.React.useEffect((()=>{Re(n,i).then((e=>{v(e)}))}),[n,i]),f.hooks.useEffectOnce((()=>{const e=null==C?void 0:C.current;if(e){const t=new IntersectionObserver((e=>{e[0].isIntersecting&&M()}));return null==t||t.observe(e),()=>{null==t||t.disconnect()}}})),(0,m.jsx)("div",{className:(0,m.classNames)({vertical:c===l.Vertical}),css:Ce(N),ref:j},(0,m.jsx)("div",{className:"list-items"},null==d?void 0:d.map(((e,t)=>(0,m.jsx)(Se,{key:e.getId(),data:e,dataSource:n,widgetId:a,popupTemplate:g})))),(0,m.jsx)("div",{ref:C,className:"lazyload-detector"},"Â "),h===P.Loading&&(0,m.jsx)(f.Loading,{type:f.LoadingType.Donut}))}const{useRef:Me,useState:De}=m.React,Oe=e=>m.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .list_items {
      flex: 1 1 ${e?"auto":0};
      max-height: ${e?"calc(61.8vh - 100px)":"none"};
      overflow: auto;
      display: flex;
      flex-direction: row;
    }

    .query-result-item + .query-result-item {
      margin-left: 0.5rem;
      margin-top: 0;
    }

    &.vertical {
      .list_items {
        flex-direction: column;
      }
      .feature-info-component {
        width: 100%;
      }
      .query-result-item + .query-result-item {
        margin-top: 0.5rem;
        margin-left: 0;
      }
    }
    .page-size-selector {
      width: auto;
    }
  `;function Te(e){var t;const{widgetId:a,outputDS:n,queryItem:s,queryParams:o,resultCount:r,records:i,onRenderDone:c,direction:u}=e,[d,p]=De(i),[v,h]=De(),[y,x]=De(P.Init),S=Me(1),b=f.hooks.useTranslate(g),R=null!==(t=null==n?void 0:n.getQueryPageSize())&&void 0!==t?t:m.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE,[w,j]=De(R),I=le();m.React.useEffect((()=>{S.current=1,p(i),j(R)}),[i]),m.React.useEffect((()=>{Re(n,s).then((e=>{h(e)}))}),[n,s]);const C=(e,t)=>{return s=this,l=void 0,i=function*(){S.current=e,x(P.Loading);const s=yield we(a,n,Object.assign(Object.assign({},o),{page:e,pageSize:t}));p(s.records),null==c||c({dataItems:s.records,pageSize:t,page:S.current}),x(P.Loaded)},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{o(i.next(e))}catch(e){t(e)}}function n(e){try{o(i.throw(e))}catch(e){t(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof r?s:new r((function(e){e(s)}))).then(a,n)}o((i=i.apply(s,l||[])).next())}));var s,l,r,i};return(0,m.jsx)("div",{className:(0,m.classNames)({vertical:u===l.Vertical}),css:Oe(I)},(0,m.jsx)("div",{className:"list_items mb-2"},null==d?void 0:d.map(((e,t)=>(0,m.jsx)(Se,{key:e.getId(),data:e,dataSource:n,widgetId:a,popupTemplate:v})))),y===P.Loading&&(0,m.jsx)(f.Loading,{type:f.LoadingType.Donut}),r>0&&(0,m.jsx)("div",{className:"d-flex justify-content-between align-items-center"},(0,m.jsx)(f.Select,{className:"page-size-selector",value:w,onChange:e=>{const t=+e.target.value;t>0&&(j(t),C(1,t))},size:"sm"},function(e){const t=[e];return Math.round(e/2)!==t[0]&&t.push(Math.round(e/2)),Math.round(e/5)!==t[1]&&t.push(Math.round(e/5)),t.reverse()}(R).map((e=>(0,m.jsx)("option",{key:e,value:e},e,"/",b("page"))))),(0,m.jsx)(f.Pagination,{className:"d-flex justify-content-end",disabled:y===P.Loading,current:S.current,totalPage:Math.ceil(r/w),onChangePage:e=>C(e,w)})))}const ke=e=>{const{className:t}=e,a=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a}(e,["className"]),n=(0,m.classNames)("jimu-icon-component",t);return m.React.createElement(f.Icon,Object.assign({className:n,icon:b()},a))},{iconMap:Ee}=M(),Pe=m.css`
  display: flex;
  flex-direction: column;

  .query-result__header {
    color: var(--dark-800);
    font-weight: 500;
    font-size: 14px;
    line-height: 18px;
  }

  .query-result-container {
    flex: 1 1 0;
    display: flex;
    flex-direction: column;
  }
`;function ze(e){var t,a;const{queryItem:n,queryParams:s,resultCount:o,records:i,defaultPageSize:c,widgetId:u,outputDS:d,onNavBack:p}=e,v=f.hooks.useTranslate(g),[h,y]=m.React.useState(null),[x,S]=m.React.useState([]),b=m.React.useRef(),R=m.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets[u].enableDataAction)||void 0===t||t})),w=m.ReactRedux.useSelector((e=>e.appConfig.widgets[u].config.resultPagingStyle)),j=m.ReactRedux.useSelector((e=>e.appConfig.widgets[u].config.resultListDirection)),I=Object.assign({},_,n),C=null!=w?w:r.MultiPage,N=null!=j?j:l.Vertical;f.hooks.useEffectOnce((()=>{b.current.focus()})),m.React.useEffect((()=>{y({records:i,pageSize:c,page:1})}),[i,c]);const M=m.React.useCallback((({dataItems:e,pageSize:t,page:a})=>{y({records:e,pageSize:t,page:a})}),[]),D=m.React.useCallback((()=>{var e;const t=m.DataSourceManager.getInstance().getDataSource(null==d?void 0:d.id),a=null==t?void 0:t.getSelectedRecords(),n=null!==(e=null==t?void 0:t.getSelectedRecordIds())&&void 0!==e?e:[];let s=!1;s=n.length!==x.length||n.some((e=>null==x.find((t=>t.getId()===e)))),s&&S(a)}),[null==d?void 0:d.id,x]),O=m.React.useCallback((()=>{var e;if(h){if(C===r.LazyLoad)return`${v("featuresDisplayed")}: ${null===(e=null==h?void 0:h.records)||void 0===e?void 0:e.length} / ${o}`;const t=(h.page-1)*h.pageSize+1,a=t+h.pageSize-1;return o>0?`${v("featuresDisplayed")}: ${t} - ${Math.min(a,o)} / ${o}`:`${v("featuresDisplayed")}: 0 - 0 / 0`}return""}),[h,o,v,C]),T=m.React.useMemo((()=>(0,m.Immutable)({dataSourceId:n.outputDataSourceId,mainDataSourceId:n.outputDataSourceId})),[null==n?void 0:n.outputDataSourceId]);return(0,m.jsx)("div",{className:"query-result h-100",css:Pe,role:"listbox","aria-label":v("results")},(0,m.jsx)(m.DataSourceComponent,{useDataSource:T,onDataSourceInfoChange:D}),(0,m.jsx)("div",{className:"query-result__header d-flex align-items-center"},(0,m.jsx)(f.Button,{ref:b,className:"p-0 mr-2",size:"sm",type:"tertiary",icon:!0,onClick:()=>p()},(0,m.jsx)(ke,{autoFlip:!0})),null!==(t=I.resultsLabel)&&void 0!==t?t:v("results"),(null===(a=null==h?void 0:h.records)||void 0===a?void 0:a.length)>0&&(0,m.jsx)(m.React.Fragment,null,(0,m.jsx)(f.Tooltip,{title:v("clearResult"),placement:"bottom"},(0,m.jsx)(f.Button,{className:"ml-auto",icon:!0,size:"sm",type:"tertiary",onClick:()=>{p(!0),y(null)},"aria-label":v("clearResult")},(0,m.jsx)(f.Icon,{icon:Ee.toolDelete}))),R&&(0,m.jsx)(m.React.Fragment,null,(0,m.jsx)("div",{css:m.css`width: 1px; height: 16px; background-color: var(--light-400);`}),(0,m.jsx)(f.DataActionDropDown,{dataName:d.getLabel(),widgetId:u,dataSource:d,size:"sm",type:"tertiary",records:(null==x?void 0:x.length)>0?x:null==h?void 0:h.records})))),(0,m.jsx)("div",{className:"query-result-container mt-1"},(0,m.jsx)("div",{className:"query-result-info mb-2",role:"alert","aria-live":"polite"},O()),C===r.LazyLoad&&o>0&&(0,m.jsx)(Ne,{widgetId:u,queryItem:n,outputDS:d,queryParams:s,resultCount:o,records:i,direction:N,onRenderDone:M}),C===r.MultiPage&&o>0&&(0,m.jsx)(Te,{widgetId:u,queryItem:n,outputDS:d,queryParams:s,resultCount:o,records:i,direction:N,onRenderDone:M})))}var Le=c(65283),Be=c.n(Le);const Fe=e=>{const{className:t}=e,a=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a}(e,["className"]),n=(0,m.classNames)("jimu-icon-component",t);return m.React.createElement(f.Icon,Object.assign({className:n,icon:Be()},a))};const _e=m.css`
  &.wrapped .query-form {
    height: 100%;
  }
  .query-task__content {
    display: flex;
    flex-direction: column;
    width: 100%;
  }
  .query-form__header {
    display: flex;
    .nav-action {
      flex: 1 1 0;
      overflow: hidden;
      display: flex;
    }
    .result-menu {
      display: flex;
    }
  }
`;function qe(e){var t,a;const{queryItem:n,onNavBack:o,total:l,wrappedInPopper:r=!1,className:c="",index:u}=e,d=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a}(e,["queryItem","onNavBack","total","wrappedInPopper","className","index"]),p=f.hooks.useTranslate(g),[v,h]=m.React.useState(0),[y,x]=m.React.useState(!0),[S,b]=m.React.useState(0),R=m.React.useRef(null),w=m.React.useRef(null),[j,I]=m.React.useState(null),C=m.React.useRef(n.sqlExprObj),N=m.React.useRef(null),M=m.React.useRef(),D=Object.assign({},_,n),{icon:O,name:T,displayLabel:k}=D,E=null!==(a=null===(t=j)||void 0===t?void 0:t.getQueryPageSize())&&void 0!==a?a:m.CONSTANTS.DEFAULT_QUERY_PAGE_SIZE;f.hooks.useEffectOnce((()=>{M.current.focus()}));const P=m.React.useMemo((()=>(0,m.Immutable)({dataSourceId:n.outputDataSourceId,mainDataSourceId:n.outputDataSourceId})),[n.outputDataSourceId]),z=m.React.useCallback((e=>{x(e)}),[]),B=m.React.useCallback((e=>{I(e)}),[]),q=m.React.useCallback((()=>{const t=new m.DataRecordSetChangeMessage(e.widgetId,j.id,m.RecordSetChangeType.Remove,{records:[],fields:[],dataSource:j});m.MessageManager.getInstance().publishMessage(t)}),[e.widgetId,j]),A=m.React.useCallback(((e=!1)=>{e&&(w.current=null,null==j||j.setStatus(m.DataSourceStatus.NotReady),b(0),q()),h(0)}),[j,q]),V=m.React.useCallback((()=>{h(1)}),[]),U=m.React.useCallback(((t,a)=>{C.current=t,N.current=a;const n=j;h(2),q(),function(e,t,a,n,o,l){var r,c,u,d;return be(this,void 0,void 0,(function*(){const p=e.getDataSourceJson(),f=e.getOriginDataSources()[0];(null==p?void 0:p.isDataInDataSourceInstance)&&e.setSourceRecords(f.getSourceRecords());const{useAttributeFilter:g,useSpatialFilter:v,sortOptions:h,resultFieldsType:y,resultDisplayFields:x,resultTitleExpression:S}=n;let b=x;if(null==x){const t=e.getSchema();b=(null==t?void 0:t.fields)?Object.values(t.fields).map((e=>e.jimuName)):[]}const R=g?e.mergeQueryParams(null!==(r=f.getCurrentQueryParams())&&void 0!==r?r:{},{where:null!==(c=null==t?void 0:t.sql)&&void 0!==c?c:"1=1"}):null,w=Object.assign({returnGeometry:!0,page:o,pageSize:l},R);if(v&&(null==a?void 0:a.geometry)){const{geometry:e,relation:t=s.Intersect,buffer:n}=a;Object.assign(w,{geometry:e.toJSON(),spatialRelationship:t,distance:null==n?void 0:n.distance,units:(null==n?void 0:n.unit)?m.lodash.kebabCase(n.unit):void 0})}if((null==h?void 0:h.length)>0&&Object.assign(w,{orderByFields:h.map((e=>`${e.jimuFieldName} ${e.order}`))}),y===i.SelectAttributes){const t=function(e,t,a){const n=new Set;if(null==e||e.forEach((e=>n.add(e))),t){const e=t.match(/\{\w*\}/g);(null==e?void 0:e.length)>0&&e.forEach((e=>n.add(e.substring(1,e.length-1))))}return a&&n.add(a),Array.from(n)}(b,S,e.getIdField());Object.assign(w,{outFields:t})}else{const e=yield f.getPopupInfo(),t=Object.values(null!==(u=f.getSchema().fields)&&void 0!==u?u:{}).map((e=>e.name)),a=null===(d=null==e?void 0:e.fieldInfos)||void 0===d?void 0:d.filter((e=>t.includes(e.fieldName)));Object.assign(w,{outFields:null==a?void 0:a.map((e=>e.fieldName))})}return w}))}(n,t,a,D,1,E).then((t=>(R.current=t,n.setCountStatus(m.DataSourceStatus.Unloaded),function(e,t,a){return be(this,void 0,void 0,(function*(){return t.loadCount(a,{widgetId:e,refresh:!0})}))}(e.widgetId,n,t)))).then((t=>(b(t),n.updateQueryParams(R.current,e.widgetId),n.setStatus(m.DataSourceStatus.Unloaded),we(e.widgetId,n,R.current)))).then((e=>{w.current=e.records})).finally((()=>{(null==a?void 0:a.layer)&&(null==a?void 0:a.clearAfterApply)&&a.layer.removeAll(),h(1)}))}),[D,e.widgetId,j,E,q]),H=m.React.useCallback((()=>{w.current=null,null==j||j.setStatus(m.DataSourceStatus.NotReady),b(0),q()}),[j,q]);return(0,m.jsx)("div",{className:(0,m.classNames)("query-task h-100 d-flex",c,{wrapped:r}),css:_e},(0,m.jsx)("div",{className:(0,m.classNames)("query-task__content",{"d-none":1===v})},(0,m.jsx)(m.DataSourceComponent,{useDataSource:P,onDataSourceCreated:B}),(0,m.jsx)("div",{className:"query-form__header align-items-center"},(0,m.jsx)("div",{className:(0,m.classNames)("nav-action align-items-center",{"d-none":r})},(0,m.jsx)(f.Button,{className:(0,m.classNames)("p-0 mr-2",{"d-none":1===l}),size:"sm",type:"tertiary",icon:!0,onClick:o,"aria-label":p("back"),ref:M},(0,m.jsx)(ke,{autoFlip:!0})),(0,m.jsx)(F,{icon:O,name:k?T:""})),(0,m.jsx)("div",{className:(0,m.classNames)("result-menu ml-auto align-items-center",{"d-none":0===S})},(0,m.jsx)(f.Tooltip,{title:p("checkResult"),placement:"bottom"},(0,m.jsx)(f.Button,{size:"sm",type:"tertiary","aria-label":p("checkResult"),icon:!0,onClick:V},(0,m.jsx)(Fe,null))),(0,m.jsx)("div",{css:m.css`width: 1px; height: 16px; background-color: var(--light-400);`}),(0,m.jsx)(f.Tooltip,{title:p("clearResult"),placement:"bottom"},(0,m.jsx)(f.Button,{size:"sm",type:"tertiary","aria-label":p("clearResult"),icon:!0,onClick:H},(0,m.jsx)($,null))))),y&&(0,m.jsx)(ie,Object.assign({},d,{configId:n.configId,outputDS:j,onFormSubmit:U})),(0,m.jsx)(L,{useDataSource:n.useDataSource,showMessage:!0,onStatusChange:z})),(0,m.jsx)("div",{className:(0,m.classNames)("query-task__content",{"d-none":1!==v})},(0,m.jsx)(ze,{widgetId:e.widgetId,queryItem:n,queryParams:R.current,resultCount:S,records:w.current,defaultPageSize:E,outputDS:j,onNavBack:A})),2===v&&(0,m.jsx)(f.Loading,{type:f.LoadingType.Donut}))}const Ae=()=>({name:T.TreeItemActionType.RenderOverrideItem,children:[{name:T.TreeItemActionType.RenderOverrideItemBody,children:[{name:T.TreeItemActionType.RenderOverrideItemMainLine}]}]});function Ve(e){const{queryItems:t,widgetId:a,className:n=""}=e,[s,o]=m.React.useState(0),[l,r]=m.React.useState((0,m.Immutable)({})),[i,c]=m.React.useState(0),u=m.React.useCallback(((e,a)=>{const n=t[e].configId;r(l.set(n,!a))}),[t,l]),d=m.React.useCallback((()=>Array.from(t).map(((e,t)=>{var a;return{itemStateDetailContent:e,itemStateDisabled:null!==(a=l[e.configId])&&void 0!==a&&a,itemKey:`${t}`}}))),[t,l]);return(0,m.jsx)("div",{className:`runtime-query__query-list h-100 ${n}`,css:m.css`.jimu-tree-item__body {width: 100%;}`},0===s&&t.length>1&&(0,m.jsx)(T.List,{itemsJson:d(),isItemFocused:()=>!1,overrideItemBlockInfo:Ae,onClickItemBody:(e,t)=>{const{itemJsons:a}=t.props;var n;n=+a[0].itemKey,o(1),c(n)},renderOverrideItemMainLine:(e,t)=>{const{itemJsons:a}=t.props,n=a[0],s=n.itemStateDetailContent,o=+n.itemKey;return(0,m.jsx)(V,{key:s.configId,index:o,queryItem:s,onStatusChange:e=>{u(o,e)}})}}),(1===s||1===t.length)&&(0,m.jsx)(qe,{widgetId:a,index:t.length>1?i:0,total:t.length,queryItem:t[t.length>1?i:0],onNavBack:()=>{o(0),c(-1)}}))}const $e=[{name:"preventOverflow",options:{padding:1}}];function Ue(e){const{id:t,icon:a,label:n,forceClose:s,onOpenedChange:o,popperTitle:l,minSize:r,defaultSize:i,onWidthChange:c,buttonType:u="tertiary",children:d}=e,p=m.React.useRef(),g=m.React.useRef(0),[v,h]=m.React.useState(!1),[y,x]=m.React.useState(0),S=f.hooks.useCheckSmallBrowserSzieMode();m.React.useEffect((()=>{s&&h(!1)}),[s]),f.hooks.useEffectOnce((()=>{if("function"==typeof c){g.current=Math.round(p.current.clientWidth),c(t,g.current);const e=new m.ResizeObserver(m.lodash.throttle((e=>{const a=Math.round(e[0].contentRect.width);g.current!==a&&(g.current=a,c(t,a))}),200));return e.observe(p.current),()=>{e.disconnect()}}}));const b=m.React.useCallback((()=>{"function"==typeof o&&o(t,!v),h(!v),x(y+1)}),[t,v,y,o]);return(0,m.jsx)("div",{className:"runtime-query__widget-popper"},(0,m.jsx)(f.Button,{icon:!0,size:"sm",type:u,ref:p,onClick:b},a&&(0,m.jsx)(f.Icon,Object.assign({size:16},"string"==typeof a?{icon:a,color:""}:{icon:a.svg,color:a.properties.color})),n&&(0,m.jsx)("span",{className:"ml-2"},n)),S?(0,m.jsx)(f.MobilePanel,{open:v,title:l,toggle:b},d):(0,m.jsx)(f.Popper,{className:"ui-unit-popper ui-unit-popper_k-arrangement-icon flex-grow-1",floating:!0,open:v,onHeaderClose:b,headerTitle:l,minSize:r,defaultSize:i,dragBounds:"body",version:y,reference:p.current,placement:"bottom-start",modifiers:$e},d))}const{iconMap:He}=M(),We=m.css`
  > div + div {
    margin-left: 8px;
  }
`;function Ge(e){const{queryItems:t,widgetId:a,minSize:n,defaultSize:s,widgetLabel:o,wrap:l=!1}=e,r=m.React.useRef(),i=m.React.useRef(0),c=m.React.useRef({}),[u,d]=m.React.useState(t.length),[p,g]=m.React.useState(-1),v=m.React.useRef(null),h=m.React.useCallback((()=>{let e=0;for(let a=0;a<u;a++){const n=t[a],s=c.current[n.configId];if(!(s>0))return;if(e+=s+8,e>=i.current&&u!==a)return void d(a)}d(t.length)}),[u,t]);m.React.useEffect((()=>(v.current&&v.current.disconnect(),v.current=new m.ResizeObserver(m.lodash.throttle((e=>{const t=Math.round(e[0].contentRect.width);i.current!==t&&(i.current=t,h())}),200)),v.current.observe(r.current),()=>{v.current.disconnect()})),[h]),f.hooks.useEffectOnce((()=>{var e;i.current=null===(e=r.current)||void 0===e?void 0:e.clientWidth,h()}));const y=m.React.useCallback(((e,a)=>{const n=t[e];c.current[n.configId]!==a&&(c.current[n.configId]=a,h())}),[t,h]),x=m.React.useCallback(((e,t)=>{t?g(e):e===p&&g(-1)}),[p]),[S,b]=m.React.useMemo((()=>{const e=[],a=[];for(let n=0;n<t.length;n++)n<u?e.push(t[n]):a.push(t[n]);return[e,a]}),[t,u]);return(0,m.jsx)("div",{ref:r,css:We,className:(0,m.classNames)("runtime-query__query-list h-100 d-flex",{"flex-wrap":l})},S.map(((e,t)=>{const o=Object.assign({},_,e);return(0,m.jsx)(Ue,{id:t,key:o.configId,icon:o.icon,buttonType:"default",label:o.displayLabel?o.name:void 0,popperTitle:o.name,onWidthChange:y,minSize:n,defaultSize:s,onOpenedChange:x,forceClose:p>=0&&p!==t},(0,m.jsx)(qe,{widgetId:a,index:t,total:1,queryItem:o,wrappedInPopper:!0,className:"pb-3 px-3"}))})),b.length>0&&(0,m.jsx)(Ue,{id:S.length+1,icon:He.iconMore,minSize:n,buttonType:"default",popperTitle:o,defaultSize:s,onOpenedChange:x,forceClose:p>=0&&p!==S.length+1},(0,m.jsx)(Ve,{widgetId:a,queryItems:b})))}const{iconMap:Je}=M(),Qe=m.css`
  background-color: var(--white);
`;class Ke extends m.React.PureComponent{render(){var e,t,n,s,o,l,r,i,c;const{config:u,id:d,icon:p,label:v,layoutId:h,layoutItemId:y}=this.props,x=this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:g._widgetLabel});return(null===(e=u.queryItems)||void 0===e?void 0:e.length)?u.arrangeType===a.Popper?(0,m.jsx)(oe.Provider,{value:`${h}:${y}`},(0,m.jsx)(Ue,{id:0,icon:p,popperTitle:v,minSize:null===(n=null===(t=u.sizeMap)||void 0===t?void 0:t.arrangementIconPopper)||void 0===n?void 0:n.minSize,defaultSize:null===(o=null===(s=u.sizeMap)||void 0===s?void 0:s.arrangementIconPopper)||void 0===o?void 0:o.defaultSize},(0,m.jsx)(Ve,{widgetId:d,queryItems:u.queryItems,className:"p-3"}))):u.arrangeType===a.Inline?(0,m.jsx)(oe.Provider,{value:`${h}:${y}`},(0,m.jsx)(Ge,{widgetId:d,widgetLabel:v,wrap:u.arrangeWrap,queryItems:u.queryItems,minSize:null===(r=null===(l=u.sizeMap)||void 0===l?void 0:l.arrangementIconPopper)||void 0===r?void 0:r.minSize,defaultSize:null===(c=null===(i=u.sizeMap)||void 0===i?void 0:i.arrangementIconPopper)||void 0===c?void 0:c.defaultSize})):(0,m.jsx)("div",{className:"jimu-widget runtime-query p-3",css:Qe},(0,m.jsx)(oe.Provider,{value:`${h}:${y}`},(0,m.jsx)(Ve,{widgetId:d,queryItems:u.queryItems}))):(0,m.jsx)(f.WidgetPlaceholder,{icon:Je.iconQuery,widgetId:this.props.id,message:x})}}Ke.versionManager=O})(),u})())}}}));