System.register(["jimu-core","jimu-ui/advanced/setting-components","jimu-ui","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/dynamic-url-editor"],(function(e,t){var s={},a={},o={},r={},n={};return{setters:[function(e){s.Immutable=e.Immutable,s.React=e.React,s.classNames=e.classNames,s.css=e.css,s.jsx=e.jsx},function(e){a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection},function(e){o.Button=e.Button,o.ButtonGroup=e.ButtonGroup,o.Icon=e.Icon,o.NumericInput=e.NumericInput,o.Switch=e.Switch,o.TextArea=e.TextArea,o.TextInput=e.TextInput,o.defaultMessages=e.defaultMessages},function(e){r.AllDataSourceTypes=e.AllDataSourceTypes,r.DataSourceSelector=e.DataSourceSelector},function(e){n.DynamicUrlEditor=e.DynamicUrlEditor}],execute:function(){e((()=>{var e={28455:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 1C4.15 1 1 4.15 1 8s3.15 7 7 7 7-3.15 7-7-3.15-7-7-7zm1.167 11.667H6.834v-2.334h2.333v2.334zm-2.333-4.5V3.333h2.333v4.834H6.834z" fill="#000"></path></svg>'},1810:e=>{"use strict";e.exports=s},21835:e=>{"use strict";e.exports=o},33037:e=>{"use strict";e.exports=r},76880:e=>{"use strict";e.exports=n},23080:e=>{"use strict";e.exports=a}},t={};function i(s){var a=t[s];if(void 0!==a)return a.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var l={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(l),i.d(l,{default:()=>h});var e=i(1810),t=i(23080),s=i(21835);const a={_widgetLabel:"Embed",websiteAddress:"Website address",code:"Code",codePlaceholder:"Paste the HTML code you want to embed.",embedBy:"Embed by",attributeHint:"URL from an attribute",expressionHint:"URL by an expression",autoRefresh:"Auto refresh",autoInterval:"Interval",autoUnit:"Minute",reloadSetting:"Do not reload iframe when URL changes"};var o;!function(e){e.Url="url",e.Code="code"}(o||(o={}));var r=i(33037),n=i(76880),c=i(28455),u=i.n(c);const d=t=>{const{className:a}=t,o=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(a=Object.getOwnPropertySymbols(e);o<a.length;o++)t.indexOf(a[o])<0&&Object.prototype.propertyIsEnumerable.call(e,a[o])&&(s[a[o]]=e[a[o]])}return s}(t,["className"]),r=(0,e.classNames)("jimu-icon-component",a);return e.React.createElement(s.Icon,Object.assign({className:r,icon:u()},o))};class h extends e.React.PureComponent{constructor(t){super(t),this.supportedDsTypes=(0,e.Immutable)([r.AllDataSourceTypes.FeatureLayer,r.AllDataSourceTypes.SceneLayer]),this.embedTypeChange=e=>{const{config:t}=this.props;this.props.config.embedType!==e&&this.props.onSettingChange({id:this.props.id,config:t.set("embedType",e)})},this.checkURL=e=>{if(!e||""===e)return this.setState({urlError:""}),!0;if(!new RegExp("^(([h][t]{2}[p][s])?://)").test(e))return this.setState({urlError:this.formatMessage("httpsUrlMessage")}),!1;if(new RegExp("^(([h][t]{2}[p][s])?://localhost)").test(e))return this.setState({urlError:""}),!0;const t=e.indexOf(".");return t<0||t===e.length-1?(this.setState({urlError:this.formatMessage("invalidUrlMessage")}),!1):(this.setState({urlError:""}),!0)},this.embedCodeChangeRightAway=e=>{const{config:t,id:s}=this.props;this.props.onSettingChange({config:t.set("embedCode",e),id:s})},this.formatMessage=e=>this.props.intl.formatMessage({id:e,defaultMessage:Object.assign(Object.assign({},s.defaultMessages),a)[e]}),this.onDataSourceChange=e=>{e&&this.props.onSettingChange({id:this.props.id,useDataSources:e})},this.onToggleUseDataEnabled=e=>{this.props.onSettingChange({id:this.props.id,useDataSourcesEnabled:e})},this.onSwitchChanged=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set(t,e)})},this.handleAutoInterval=e=>{const{config:t,id:s}=this.props;this.props.onSettingChange({id:s,config:t.set("autoInterval",e)})},this.labelChange=e=>{var t;const{config:s,id:a}=this.props,o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;this.props.onSettingChange({id:a,config:s.set("label",o)})},this.webAddressExpressionChange=e=>{const{config:t,onSettingChange:s,id:a,useDataSourcesEnabled:r,useDataSources:n}=this.props,{embedType:i}=t,l=/\<exp((?!\<exp).)+\<\/exp\>/gim,c=null==e?void 0:e.match(/\<urlsearch((?!\<urlsearch).)+\<\/urlsearch\>/gim),u=null==e?void 0:e.match(l),d=e&&e.replace(/<[^>]+>/g,"").replace(/(^\s*|\s*$)/g,"");(c||u)&&0===d.indexOf("{")||this.checkURL(d)?this.setState({showUrlError:!1}):this.setState({showUrlError:!0});const h=null==e?void 0:e.match(l);s(i===o.Url&&r&&(null==n?void 0:n.length)>0&&h?{id:a,config:t.set("expression",e)}:{id:a,config:t.set("expression",e).set("enableLabel",!1)})},this.isUsedDataSource=()=>{const{useDataSources:e,useDataSourcesEnabled:t}=this.props;return t&&e&&e.length>0},this.hasExpressionTag=e=>null==e?void 0:e.match(/\<exp((?!\<exp).)+\<\/exp\>/gim),this.state={showUrlError:!1,urlError:"",isExpPopupOpen:!1}}render(){const{showUrlError:a,urlError:i}=this.state,{theme:l,useDataSources:c,config:u,useDataSourcesEnabled:h,id:p,selectWidgets:g}=this.props,{embedType:m,enableLabel:f,label:x}=u,b=m===o.Url&&h&&(null==c?void 0:c.length)>0&&this.hasExpressionTag(u.expression);return(0,e.jsx)("div",{css:(this.props.theme,e.css`
    label {
      cursor: pointer;
    }
    .embed-dynamic-con{
      z-index: 3;
      .ql-editor{
        min-height: 174px;
      }
    }
  `)},(0,e.jsx)("div",{className:"widget-iframe jimu-widget"},(0,e.jsx)("div",null,(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,{label:this.formatMessage("embedBy")}),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(s.ButtonGroup,{className:"w-100"},(0,e.jsx)(s.Button,{className:"w-50","aria-label":`${this.formatMessage("embedBy")} ${this.formatMessage("url")}`,type:m===o.Url?"primary":"default",onClick:()=>this.embedTypeChange(o.Url)},this.formatMessage("url")),(0,e.jsx)(s.Button,{className:"w-50","aria-label":`${this.formatMessage("embedBy")} ${this.formatMessage("code")}`,type:m===o.Code?"primary":"default",onClick:()=>this.embedTypeChange(o.Code)},this.formatMessage("code")))),m===o.Url&&(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{className:"choose-ds w-100"},(0,e.jsx)(r.DataSourceSelector,{types:this.supportedDsTypes,useDataSources:this.props.useDataSources,useDataSourcesEnabled:h,onToggleUseDataEnabled:this.onToggleUseDataEnabled,onChange:this.onDataSourceChange,widgetId:this.props.id}))),(0,e.jsx)(t.SettingRow,null,m===o.Url?(0,e.jsx)("div",{className:"d-flex flex-column w-100 embed-dynamic-con"},(0,e.jsx)(n.DynamicUrlEditor,{widgetId:p,useDataSourcesEnabled:h,useDataSources:c,selectWidgets:g,onChange:this.webAddressExpressionChange,value:u.expression}),a&&(0,e.jsx)("div",{className:"d-flex w-100 align-items-center justify-content-between",style:{marginTop:"5px"}},(0,e.jsx)(d,{color:l.colors.danger}),(0,e.jsx)("div",{style:{width:"calc(100% - 20px)",margin:"0 4px",overflow:"hidden",textOverflow:"ellipsis",color:l.colors.danger}},i))):(0,e.jsx)(s.TextArea,{style:{height:"300px"},className:"w-100",spellCheck:!1,placeholder:this.formatMessage("codePlaceholder"),value:u.embedCode||"",onAcceptValue:this.embedCodeChangeRightAway})),b&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{className:"d-flex justify-content-between w-100"},(0,e.jsx)("label",{className:"w-75 text-truncate d-inline-block font-dark-600"},this.formatMessage("label")),(0,e.jsx)(s.Switch,{className:"can-x-switch",checked:f||!1,"data-key":"enableLabel",onChange:e=>{this.onSwitchChanged(e.target.checked,"enableLabel")},"aria-label":this.formatMessage("label")}))),f&&(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(s.TextInput,{type:"text",className:"w-100",value:x||"",onChange:this.labelChange}))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{className:"d-flex justify-content-between w-100"},(0,e.jsx)("label",{className:"w-75 text-truncate d-inline-block font-dark-600"},this.formatMessage("autoRefresh")),(0,e.jsx)(s.Switch,{className:"can-x-switch",checked:this.props.config&&this.props.config.autoRefresh||!1,"data-key":"autoRefresh",onChange:e=>{this.onSwitchChanged(e.target.checked,"autoRefresh")},"aria-label":this.formatMessage("autoRefresh")}))),u.autoRefresh&&(0,e.jsx)(t.SettingRow,{flow:"wrap",label:`${this.formatMessage("autoInterval")} (${this.formatMessage("autoUnit")})`},(0,e.jsx)(s.NumericInput,{style:{width:"100%"},value:u.autoInterval||1,precision:2,min:.2,max:1440,onChange:this.handleAutoInterval,"aria-label":`${this.formatMessage("autoInterval")} (${this.formatMessage("autoUnit")})`}))))))}}h.mapExtraStateProps=(e,t)=>{var s,a;const o=e&&(null===(a=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appConfig)||void 0===a?void 0:a.widgets),r=[];if(o)for(const e in o){const s=o[e];"widgets/common/embed/"===s.uri&&s.id!==t.id&&r.push(s)}return{appConfig:e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig,appTheme:e&&e.appStateInBuilder&&e.appStateInBuilder.theme,selectWidgets:r}}})(),l})())}}}));