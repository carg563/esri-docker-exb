System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/widgets/FeatureForm","esri/widgets/Editor","esri/layers/FeatureLayer","esri/form/FormTemplate","esri/form/elements/FieldElement","esri/form/elements/GroupElement","esri/Graphic","esri/tasks/support/Query","jimu-core/data-source"],(function(e,t){var i={},s={},a={},r={},o={},n={},l={},d={},c={},u={},h={},p={};return{setters:[function(e){i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.React=e.React,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.defaultMessages=e.defaultMessages,i.jsx=e.jsx,i.polished=e.polished,i.privilegeUtils=e.privilegeUtils},function(e){s.JimuMapViewComponent=e.JimuMapViewComponent},function(e){a.Button=e.Button,a.Icon=e.Icon,a.Select=e.Select,a.Switch=e.Switch,a.WidgetPlaceholder=e.WidgetPlaceholder,a.defaultMessages=e.defaultMessages},function(e){r.default=e.default},function(e){o.default=e.default},function(e){n.default=e.default},function(e){l.default=e.default},function(e){d.default=e.default},function(e){c.default=e.default},function(e){u.default=e.default},function(e){h.default=e.default},function(e){p.FeatureDataRecordImpl=e.FeatureDataRecordImpl}],execute:function(){e((()=>{var e={94127:e=>{e.exports='<svg viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M193 10H10v28h183V10zm197 53H10v2h380v-2zM10 299h380v2H10v-2zm142-196H25v22h127v-22zm235.99-11H12.01v44h375.98V92zM10 90v48h380V90H10zm348 38c7.732 0 14-6.268 14-14s-6.268-14-14-14-14 6.268-14 14 6.268 14 14 14zM25 171h127v22H25v-22zm-12.99-11h375.98v44H12.01v-44zM10 206v-48h380v48H10zm362-24c0 7.732-6.268 14-14 14s-14-6.268-14-14 6.268-14 14-14 14 6.268 14 14zm-220 57H25v22h127v-22zm235.99-11H12.01v44h375.98v-44zM10 226v48h380v-48H10zm348 38c7.732 0 14-6.268 14-14s-6.268-14-14-14-14 6.268-14 14 6.268 14 14 14zm-188 62H10v22h160v-22zm209 2h-18a9 9 0 00-9 9 9 9 0 009 9h18a9 9 0 009-9 9 9 0 00-9-9zm-18-2c-6.075 0-11 4.925-11 11s4.925 11 11 11h18c6.075 0 11-4.925 11-11s-4.925-11-11-11h-18zm25 11a7 7 0 11-14 0 7 7 0 0114 0zM10 367h160v22H10v-22zm351 2h18a9 9 0 019 9 9 9 0 01-9 9h-18a9 9 0 01-9-9 9 9 0 019-9zm-11 9c0-6.075 4.925-11 11-11h18c6.075 0 11 4.925 11 11s-4.925 11-11 11h-18c-6.075 0-11-4.925-11-11zm29 7a7 7 0 100-14 7 7 0 000 14z" fill="#A8A8A8"></path></svg>'},33869:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 7.5a.522.522 0 01-.516.527H2.976L6.473 11.6a.535.535 0 010 .746.508.508 0 01-.73 0L1 7.5l4.743-4.846a.508.508 0 01.73 0 .535.535 0 010 .746L2.976 6.973h11.508c.285 0 .516.236.516.527z" fill="#000"></path></svg>'},34750:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 0a.5.5 0 00-.5.5V7H.5a.5.5 0 000 1H7v6.5a.5.5 0 001 0V8h6.5a.5.5 0 000-1H8V.5a.5.5 0 00-.5-.5z" fill="#000"></path></svg>'},88866:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5.5a1 1 0 100-2 1 1 0 000 2zM6.5 7.5A.5.5 0 017 7h1.5v4.5h1a.5.5 0 010 1h-3a.5.5 0 010-1h1V8H7a.5.5 0 01-.5-.5z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16A8 8 0 118 0a8 8 0 010 16zm0-1A7 7 0 108 1a7 7 0 000 14z" fill="#000"></path></svg>'},68282:e=>{"use strict";e.exports=u},18667:e=>{"use strict";e.exports=l},79280:e=>{"use strict";e.exports=d},1990:e=>{"use strict";e.exports=c},47037:e=>{"use strict";e.exports=n},7434:e=>{"use strict";e.exports=h},55495:e=>{"use strict";e.exports=o},3234:e=>{"use strict";e.exports=r},74645:e=>{"use strict";e.exports=s},1810:e=>{"use strict";e.exports=i},70198:e=>{"use strict";e.exports=p},21835:e=>{"use strict";e.exports=a}},t={};function v(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,v),a.exports}v.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return v.d(t,{a:t}),t},v.d=(e,t)=>{for(var i in t)v.o(t,i)&&!v.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},v.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},v.p="";var m={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(m),v.d(m,{default:()=>L});var e,t=v(1810);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={}));var i=v(74645);const s={_widgetLabel:"Edit (beta)",initGeoEmptyMessage:"Please add an editable layer.",initAttEmptyMessage:"Please add an editable source.",noRecordTips:"No valid record is selected, select one or add one.",addFeature:"Add feature",selectLayer:"Select layer",selfSnapping:"Self snapping",featureSnapping:"Feature snapping",update:"Update",deleteRecord:"Delete this record?",deleteRecordTips:"This record will be permanently removed.",keepRecord:"Keep record"};var a=v(21835);function r(e,i,s,a,r){return t.css`
    ${"&.edit-widget-"+i} {
      .esri-editor__content{
        background-color: ${e.colors.white};
        padding: 8px 16px;
      }
      .esri-feature-form{
        ${("empty"===s||"list"===s)&&`border-bottom: 1px solid ${e.colors.palette.light[200]};`}
        background-color: ${e.colors.white};
        .esri-feature-form__form-header{
          margin: 0;
          ${"form"===s&&"display: none;"}
          .esri-feature-form__description-text{
            font-weight: 500;
            font-size: 13px;
          }
        }
      }
      .esri-feature-templates{
        width: 100%;
        height: calc(100% - 40px);
        .esri-item-list{
          height: 100%;
          .esri-item-list__scroller{
            height: 100%;
          }
        }
      }
      .esri-editor__temp-wrapper{
        height: 100%;
      }
      .esri-editor__header{
        min-height: 56px;
        padding-left: ${r&&1!==a?"35px":"15px"};
        .esri-widget__heading{
          font-weight: 600;
          font-size: 16px;
          margin: 2px 8px;
          text-align: left;
        }
      }
      .esri-editor__controls{
        ${!r&&"justify-content: space-between !important; flex-direction: row !important;"}
        .esri-editor__control-button:first-of-type{
          color: ${e.colors.white};
          background-color: ${e.colors.palette.primary[500]};
          border: 1px solid ${e.colors.palette.primary[500]};
          :hover{
            background-color: ${e.colors.palette.primary[600]};
          }
        }
        .esri-editor__control-button{
          color: ${e.colors.palette.dark[800]};
          background-color: ${e.colors.white};
          border: 1px solid ${e.colors.palette.light[400]};
          :hover{
            background-color: ${e.colors.palette.light[100]};
          }
        }
        .esri-editor__control-button + .esri-editor__control-button{
          margin-left: 2%;
        }
      }
      .esri-editor__feature-list-item,
      .esri-item-list__list-item{
        border-color:  ${e.colors.palette.light[200]};
        box-shadow: unset;
        :hover{
          border-color: ${e.colors.palette.dark[300]};
        }
      }
      .esri-editor__warning-card{
        border-top: none;
        .esri-icon-notice-triangle{
          color: ${e.colors.palette.danger[500]};
          font-size: 22px;
          margin-right: 8px;
        }
        .esri-editor__warning-heading{
          font-size: 16px;
          font-weight: 500;
          color: ${e.colors.black};
        }
        .esri-editor__warning-message{
          font-weight: 500;
          font-size: 13px;
        }
        .esri-editor__warning-option--primary,
        .esri-editor__warning-option--positive,
        .esri-editor__warning-option--negative{
          text-align: center;
          padding: ${t.polished.rem(4)} ${t.polished.rem(16)};
          line-height: ${t.polished.rem(22)};
          border-radius: 2px;
        }
        .esri-editor__warning-option--primary{
          border: 1px solid ${e.colors.palette.light[200]};
        }
        .esri-editor__warning-option--positive,
        .esri-editor__warning-option--negative{
          color: ${e.colors.white};
          background-color: ${e.colors.palette.danger[500]};
        }
      }
      .attr-height{
        overflow-y: auto;
        height: calc(100% - 112px);
        background-color: ${e.colors.white};
      }
      .snapping-option{
        position: absolute;
        top: 170px;
        width: calc(100% - 33px);
        margin: 10px 16px;
        padding: 16px 7px 10px;
        border-top: 1px solid ${e.colors.palette.light[300]};
        .snapping-item{
          display: flex;
          justify-content: space-between;
          margin-bottom: 16px;
        }
      }
      .feature-list{
        height: calc(100% - 76px);
        max-height: unset;
        .esri-editor__scroller{
          max-height: unset;
        }
      }
      .esri-editor__scroller{
        max-height: unset;
        .esri-item-list__scroller{
          max-height: unset;
        }
      }
      .layer-selector{
        padding: 12px 15px;
      }
      .single-buttons{
        flex: 1;
      }
      .multi-buttons{
        width: 49%;
      }
      .add-feature-btn{
        position: absolute;
        right: 15px;
        top: 12px;
        button{
          width: 32px;
          height: 32px;
        }
      }
      .back-list-btn{
        position: absolute;
        left: 15px;
        top: 15px;
      }
      .edit-blank{
        min-height: 300px;
        .placeholder-icon{
          color: ${e.colors.palette.dark[200]};
        }
        & > div{
          top: calc(50% + 20px);
          transform: translateY(-50%);
        }
        p{
          font-size: ${t.polished.rem(14)};
          margin-top: ${t.polished.rem(16)};
          line-height: ${t.polished.rem(19)};
          color: ${e.colors.palette.dark[500]};
        }
      }
    }
  `}class o extends t.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onDataSourceInfoChange=(e,t)=>{this.props.onIsDataSourceNotReady(this.props.useDataSource.dataSourceId,null==e?void 0:e.status);const i=null==t?void 0:t.selectedIds,s=null==e?void 0:e.selectedIds,a=i!==s&&(0!==(null==i?void 0:i.length)||0!==(null==s?void 0:s.length)),r=null==t?void 0:t.gdbVersion,o=null==e?void 0:e.gdbVersion;a&&this.props.onDataSourceSelectedChange(this.props.useDataSource.dataSourceId,s),r!==o&&this.props.onDataSourceVersionChange(this.props.useDataSource.dataSourceId)},this.onCreateDataSourceFailed=()=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}componentWillUnmount(){this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null),this.props.onIsDataSourceNotReady(this.props.useDataSource.dataSourceId,t.DataSourceStatus.NotReady)}render(){const{useDataSource:e}=this.props;return(0,t.jsx)(t.DataSourceComponent,{useDataSource:e,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed,onDataSourceInfoChange:this.onDataSourceInfoChange})}}var n=v(34750),l=v.n(n);const d=e=>{const{className:i}=e,s=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(e,["className"]),r=(0,t.classNames)("jimu-icon-component",i);return t.React.createElement(a.Icon,Object.assign({className:r,icon:l()},s))};var c=v(88866),u=v.n(c);const h=e=>{const{className:i}=e,s=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(e,["className"]),r=(0,t.classNames)("jimu-icon-component",i);return t.React.createElement(a.Icon,Object.assign({className:r,icon:u()},s))};var p=v(33869),f=v.n(p);const g=e=>{const{className:i}=e,s=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(e,["className"]),r=(0,t.classNames)("jimu-icon-component",i);return t.React.createElement(a.Icon,Object.assign({className:r,icon:f()},s))};var y=v(3234),b=v(55495),S=v(47037),w=v(18667),x=v(79280),j=v(1990),F=v(68282),C=v(7434),I=v(70198),_=function(e,t,i,s){return new(i||(i=Promise))((function(a,r){function o(e){try{l(s.next(e))}catch(e){r(e)}}function n(e){try{l(s.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,n)}l((s=s.apply(e,t||[])).next())}))};const N=v(94127),k="esri-feature-form__form-header",M="esri-feature-form__description-text",D="esri-widget__heading",E="esri-feature-form",O="esri-editor__scroller",$="esri-item-list__list-item-label",A="esri-editor__warning-option";class L extends t.React.PureComponent{constructor(i){super(i),this.handleActiveViewChange=e=>{this.setState({jimuMapView:e},(()=>{e?this.createEditor(e):this.destoryEdit()}))},this.formatMessage=(e,i)=>{const r=Object.assign({},s,a.defaultMessages,t.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:r[e]},i)},this.destoryEdit=()=>{this.edit&&!this.edit.destroyed&&this.edit.destroy()},this.flatMapArray=e=>{const t=[];for(const i in e)(null==e?void 0:e[i])&&t.push(...e[i]);return t},this.flatMapArrayWithView=(e,t)=>{const i=[],s=null==t?void 0:t.dataSourceId;for(const t in e)0===t.indexOf(s)&&(null==e?void 0:e[t])&&i.push(...e[t]);return i},this.createEditForm=(e,i,s)=>_(this,void 0,void 0,(function*(){var a,r,o;const{dataSources:n,editFeatures:l}=this.state,{id:d,config:c}=this.props,{layersConfig:u}=c,h=n[e],p=this.getInLayersConfigFeatures(l,u),v=this.flatMapArray(p).length;if(1===v){const e=null===(a=h.getSelectedRecords())||void 0===a?void 0:a[0];if(!e)return;if(i||!this.edit)this.renderFeatureForm(h,e,s);else{null===(r=document.getElementById(`edit-container-${d}`))||void 0===r||r.classList.remove("esri-hidden"),this.createOrUpdateheader(h,e.feature);const i=this.edit;if(!i)return;const s=yield t.dataSourceUtils.changeToJSAPIGraphic(null==e?void 0:e.feature);i.feature=s}}else(v>1||0===v)&&(null===(o=document.getElementById(`edit-container-${d}`))||void 0===o||o.classList.add("esri-hidden"))})),this.getDsAccessibleInfo=e=>e?fetch(`${e}?f=pjson`).then((e=>_(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>!Object.keys(e).includes("error"))):Promise.resolve(!1),this.getPrivilege=()=>t.privilegeUtils.checkExbAccess(t.privilegeUtils.CheckTarget.Experience).then((e=>{var t;return null===(t=null==e?void 0:e.capabilities)||void 0===t?void 0:t.canEditFeature})),this.renderFeatureForm=(i,s,a)=>{const{config:r,id:o}=this.props,{editMode:n}=r;this.destoryEdit(),this.getFeatureLayer(i).then((r=>_(this,void 0,void 0,(function*(){if(a&&a!==this.currentRequestId)return;if(this.removeLayerOnce=!1,!r)return;const l=document&&document.createElement("div");let d;l.id=`edit-container-${o}`,l.className=`edit-container-${o}`,this.refs.editContainer.appendChild(l),d=r.layer?r.layer:r;const c=yield this.getDsAccessibleInfo(null==d?void 0:d.url),u=yield this.getPrivilege(),h=c||u;if(this.setState({formEditable:h}),n===e.Attribute){const e=this.constructFormElements(i.id),a=new w.default({elements:e}),r=((null==s?void 0:s.feature)?yield t.dataSourceUtils.changeToJSAPIGraphic(null==s?void 0:s.feature):void 0)||new F.default({layer:d});this.edit=new y.default({container:l,feature:r,layer:d,formTemplate:a}),this.createOrUpdateheader(i,r),s&&this.setState({featureFormStep:"form"});const o=this.edit;o.on("submit",(()=>{const e=r;if(e){(null==e?void 0:e.geometry)&&(e.geometry=null);const t=o.getValues();Object.keys(t).forEach((i=>{e.attributes[i]=t[i]}));const i={updateFeatures:[e]};this.applyAttributeUpdates(i)}})),d.on("edits",(function(e){var t,s,a,r,o,n;const{addedFeatures:l,updatedFeatures:d,deletedFeatures:c}=e,u=l&&l.length>0,h=d&&d.length>0,p=c&&c.length>0;if(u){const a=null===(s=null===(t=null==e?void 0:e.edits)||void 0===t?void 0:t.addFeatures)||void 0===s?void 0:s[0];if(a){const e=new I.FeatureDataRecordImpl(a,i);i.afterAddRecord(e)}}if(h){const t=null===(r=null===(a=null==e?void 0:e.edits)||void 0===a?void 0:a.updateFeatures)||void 0===r?void 0:r[0];if(t){const e=new I.FeatureDataRecordImpl(t,i);i.afterUpdateRecord(e)}}if(p){const t=null===(n=null===(o=null==e?void 0:e.edits)||void 0===o?void 0:o.deleteFeatures)||void 0===n?void 0:n[0];if(t){const e=new I.FeatureDataRecordImpl(t,i);i.afterDeleteRecordById(e.getId())}}}))}})))).catch((e=>{this.removeLayerOnce=!1,console.error(e)}))},this.createOrUpdateheader=(e,i)=>{var s;const{id:a}=this.props,{featureFormStep:r}=this.state,o=this.getLayerDisplayField(e),n="new"===r?this.formatMessage("addFeature"):null===(s=null==i?void 0:i.attributes)||void 0===s?void 0:s[o];if(null===document||void 0===document?void 0:document.getElementById(`form_heading_${a}`))document.getElementById(`form_heading_${a}`).innerText=n;else{const e=document&&document.createElement("header");e.className="esri-editor__header",e.innerHTML=`\n        <h4 id='form_heading_${a}' class='${(0,t.classNames)(D)}'>${n}</h4>\n      `,this.refs.formHeaderContainer.appendChild(e)}},this.deleteChangeDataSource=e=>{const{config:t}=this.props,{layersConfig:i}=t,{activeId:s,editFeatures:a}=this.state,r=Object.assign({},a);r[s]=e;const o=this.getInLayersConfigFeatures(r,i),n=this.flatMapArray(o).length,l=n>1?"list":1===n?"form":"empty";this.setState({editFeatures:r,featureFormStep:l},(()=>{this.createEditForm(s,!1)}))},this.applyAttributeUpdates=e=>{const{dataSources:t,editFeatures:i,activeId:s}=this.state,a=this.edit,r=t[s],o=r.getGDBVersion();a.layer.applyEdits(e,{gdbVersion:o}).then((t=>{if(t.addFeatureResults.length>0){const e=t.addFeatureResults[0].objectId;r.selectRecordById(e)}if(null==e?void 0:e.deleteFeatures){const t=(null==r?void 0:r.getSelectedRecords()).filter((t=>t.feature.attributes!==(null==e?void 0:e.deleteFeatures[0].attributes)));if(t.length>0)this.deleteChangeDataSource(t);else{const e=Object.assign({},i);delete e[s];const t=this.refs.formHeaderContainer;(null==t?void 0:t.innerHTML)&&(t.innerHTML=""),this.destoryEdit(),this.setState({editFeatures:e,featureFormStep:"empty",activeId:""})}}else(null==e?void 0:e.updateFeatures)&&this.setState({attrUpdating:!1})})).catch((t=>{(null==e?void 0:e.updateFeatures)&&this.setState({attrUpdating:!1}),console.log("error = ",t)}))},this.constructFormElements=e=>{let{activeId:t}=this.state;e&&(t=e);const{config:i}=this.props,{layersConfig:s}=i,a=s.asMutable({deep:!0}).find((e=>e.id===t));if(!a)return[];const{groupedFields:r}=a;return r.map((e=>{var t;return(null===(t=null==e?void 0:e.children)||void 0===t?void 0:t.length)>0?new j.default({label:e.name,description:e.subDescription||(null==e?void 0:e.description),elements:null==e?void 0:e.children.map((e=>new x.default({fieldName:e.jimuName,label:null==e?void 0:e.alias,description:e.subDescription||(null==e?void 0:e.description),editable:e.editAuthority,visibilityExpression:`${e.editAuthority}`})))}):new x.default({fieldName:e.jimuName,label:null==e?void 0:e.alias,description:e.subDescription||(null==e?void 0:e.description),editable:e.editAuthority,visibilityExpression:`${e.editAuthority}`})}))},this.onFilterChange=e=>{this.setState({filterText:e.target.value})},this.renderListItems=e=>{var i,s,a;const{filterText:r}=this.state,o=[];for(const t in e){const n=e[t],l=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i.dataSource,d=null==l?void 0:l.belongToDataSource,c=null==d?void 0:d.jimuChildId,u=(null===(s=null==d?void 0:d.layerDefinition)||void 0===s?void 0:s.name)||(null===(a=null==d?void 0:d.layerDefinition)||void 0===a?void 0:a.description),h=this.getLayerDisplayField(l),p=this.getLayerObjectIdField(l),v={id:c,label:u,dsId:t,items:n.filter((e=>{var t,i,s,a;const o=(null===(t=e.feature.attributes)||void 0===t?void 0:t[h])||(null===(i=e.feature.attributes)||void 0===i?void 0:i[p])||(null===(s=e.feature.attributes)||void 0===s?void 0:s.objectid),n=r.toLowerCase();return!n||(null===(a=null==o?void 0:o.toString())||void 0===a?void 0:a.toLowerCase().indexOf(n))>-1})).map((e=>{var i,s,a;const r=(null===(i=e.feature.attributes)||void 0===i?void 0:i[h])||(null===(s=e.feature.attributes)||void 0===s?void 0:s[p])||(null===(a=e.feature.attributes)||void 0===a?void 0:a.objectid);return{id:r,dsId:t,label:r,data:e.feature}}))};o.push(v)}let n=0;return o.forEach((e=>{n+=e.items.length})),0===n?(0,t.jsx)("div",{className:"esri-item-list__no-matches-message",key:"no-matches"},"No items found"):(0,t.jsx)("div",{key:"item-container"},o.map((e=>this.renderGroup(e))))},this.renderGroup=e=>{const i=`${e.id}-heading`;if(0!==e.items.length)return(0,t.jsx)("section",{"aria-labelledby":i,className:"esri-item-list__group",key:e.label},(0,t.jsx)("h4",{id:i,className:(0,t.classNames)("esri-item-list__group-header",D)},(0,t.jsx)("span",{className:$},e.label)),(0,t.jsx)("ul",{className:"esri-item-list__list"},e.items.map((e=>this.renderItem(e)))))},this.renderItem=e=>{const i=`${e.id}__${e.label}`,{dataSources:s}=this.state;return(0,t.jsx)("li",{"aria-level":2,className:"esri-item-list__list-item","data-item":e,key:i,onClick:()=>{this.renderFeatureForm(s[e.dsId],{feature:e.data})}},(0,t.jsx)("div",{className:"esri-item-list__list-item-container"},(0,t.jsx)("span",{className:$},e.label)))},this.getLayerDisplayField=e=>{var t,i,s,a,r,o,n,l;return(null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.displayField)||(null===(i=null==e?void 0:e.layerDefinition)||void 0===i?void 0:i.displayField)||(null===(a=null===(s=null==e?void 0:e.belongToDataSource)||void 0===s?void 0:s.layerDefinition)||void 0===a?void 0:a.displayField)||(null===(r=null==e?void 0:e.layer)||void 0===r?void 0:r.objectIdField)||(null===(o=null==e?void 0:e.layerDefinition)||void 0===o?void 0:o.objectIdField)||(null===(l=null===(n=null==e?void 0:e.belongToDataSource)||void 0===n?void 0:n.layerDefinition)||void 0===l?void 0:l.objectIdField)||"OBJECTID"},this.getLayerObjectIdField=e=>{var t,i,s;return(null===(t=null==e?void 0:e.layer)||void 0===t?void 0:t.objectIdField)||(null===(s=null===(i=null==e?void 0:e.belongToDataSource)||void 0===i?void 0:i.layerDefinition)||void 0===s?void 0:s.objectIdField)||"OBJECTID"},this.renderFeatureList=(e,i)=>{const{id:s,label:a}=this.props,{filterText:r}=this.state,o=`${s}-placeholder`,n=this.refs.formHeaderContainer;return(null==n?void 0:n.innerHTML)&&(n.innerHTML=""),(0,t.jsx)("div",{className:"surface-1 h-100"},(0,t.jsx)("div",{className:E},(0,t.jsx)("div",{className:k},(0,t.jsx)("h2",{className:D},a),(0,t.jsx)("p",{className:(0,t.classNames)(`text-truncate ${M}`),key:"description",title:i},i))),(0,t.jsx)("div",{className:(0,t.classNames)(`feature-list esri-editor__content ${O}`)},(0,t.jsx)("div",{className:(0,t.classNames)("esri-item-list","esri-widget")},(0,t.jsx)("div",{className:"esri-item-list__filter-container",key:"filter"},(0,t.jsx)("input",{"aria-labelledby":o,className:(0,t.classNames)("esri-input","esri-item-list__filter-input"),title:r,value:r,onChange:this.onFilterChange,type:"search"}),r?null:(0,t.jsx)("div",{className:"esri-item-list__filter-placeholder",id:o,key:"placeholder"},(0,t.jsx)("span",{className:"esri-icon-search","aria-hidden":"true"}),(0,t.jsx)("div",{className:"esri-item-list__filter-placeholder-text"},this.formatMessage("search")))),(0,t.jsx)("div",{key:"content",className:(0,t.classNames)(O)},this.renderListItems(e)))))},this.renderFormEmpty=i=>{const{label:s,config:a}=this.props,{noDataMessage:r,layersConfig:o,editMode:n}=a,l=this.refs.formHeaderContainer;(null==l?void 0:l.innerHTML)&&(l.innerHTML="");const d=o.length>0,c=n===e.Attribute?this.formatMessage("initAttEmptyMessage"):this.formatMessage("initGeoEmptyMessage"),u=d?r||this.formatMessage("noRecordTips"):c;return(0,t.jsx)("div",{className:"surface-1 h-100"},(0,t.jsx)("div",{className:E},(0,t.jsx)("div",{className:k},(0,t.jsx)("h2",{className:D},s),(0,t.jsx)("p",{className:(0,t.classNames)(`text-truncate ${M}`),key:"description",title:i},i))),(0,t.jsx)("div",{className:"w-100 text-center edit-blank"},(0,t.jsx)("div",{className:"position-absolute edit-blank-content w-100"},(0,t.jsx)(h,{size:32,className:"placeholder-icon"}),(0,t.jsx)("p",null,u))))},this.renderControlButtons=e=>(0,t.jsx)("div",{className:(0,t.classNames)("flex-row justify-content-between esri-editor__controls"),key:"controls"},e.map((({disabled:i=!1,label:s,type:a,clickHandler:r},o)=>this.renderButton({label:s,class:(0,t.classNames)({"single-buttons":1===e.length},{"multi-buttons":e.length>1},i?"esri-button--disabled":null),type:a,disabled:i,clickHandler:r,key:o})))),this.handleNew=()=>{var e;const{dataSources:t}=this.state,{config:i}=this.props,{layersConfig:s}=i,a=null===(e=s.find((e=>null==e?void 0:e.addRecords)))||void 0===e?void 0:e.id;a&&this.setState({featureFormStep:"new",activeId:a},(()=>{this.renderFeatureForm(t[a])}))},this.handleAdd=()=>{var e;const t=null===(e=this.edit.viewModel)||void 0===e?void 0:e.feature;if(t){const e=this.edit.getValues();t.attributes=e;const i={addFeatures:[t]};this.applyAttributeUpdates(i)}},this.handleSave=()=>{var e,t;null===(t=null===(e=this.edit)||void 0===e?void 0:e.viewModel)||void 0===t||t.submit(),this.setState({attrUpdating:!0})},this.handleDeleteConfirm=()=>{this.setState({delConfirm:!0})},this.cancleDelete=()=>{this.setState({delConfirm:!1})},this.handleDelete=()=>{const e=this.edit.viewModel.feature;if(e){const t={deleteFeatures:[e]};this.applyAttributeUpdates(t)}this.setState({delConfirm:!1})},this.renderButton=e=>(0,t.jsx)(a.Button,{className:e.class,disabled:e.disabled,key:e.key,onClick:e.clickHandler,type:e.type},e.label),this.constructFieldConfig=e=>e.map((e=>{var t;return(null===(t=null==e?void 0:e.children)||void 0===t?void 0:t.length)>0?{name:e.jimuName,label:e.alias||e.name,description:null==e?void 0:e.subDescription,fieldConfig:null==e?void 0:e.children.map((e=>({name:e.jimuName,label:e.alias||e.name,description:null==e?void 0:e.subDescription,editable:e.editAuthority})))}:{name:e.jimuName,label:e.alias||e.name,description:null==e?void 0:e.subDescription,editable:e.editAuthority}})),this.createEditor=e=>{let{jimuMapView:t}=this.state;const{selfSnappingCheck:i,featureSnappingCheck:s}=this.state,{useMapWidgetIds:a}=this.props;if(!a||0===a.length)return;if(e&&(t=e),!t)return;const{id:r,config:o}=this.props,{layersConfig:n,selfSnapping:l,featureSnapping:d}=o;if(0===(null==n?void 0:n.length))return;let c;this.destoryEdit(),document.getElementById(`edit-container-${r}`)?c=document.getElementById(`edit-container-${r}`):(c=document&&document.createElement("div"),c.id=`edit-container-${r}`,c.className=`h-100 edit-container-${r}`,this.refs.editContainer.appendChild(c));const u=[];let h=0;const p=()=>{this.edit=new b.default({container:c,view:t.view,layerInfos:u}),this.setState({snappingShow:!0}),this.edit.watch("activeWorkflow",(e=>{e?this.setState({snappingShow:!1,stepId:null==e?void 0:e.stepId}):(this.setState({snappingShow:!0,stepId:""}),setTimeout((()=>{this.overrideClickOfEditor()}),500))})),setTimeout((()=>{this.overrideClickOfEditor()}),500);const e=t.view.map.layers.map((e=>({layer:e}))),a=l||d,r=i||s;this.edit.snappingOptions.enabled=a&&r,this.edit.snappingOptions.selfEnabled=i,this.edit.snappingOptions.featureEnabled=s,this.edit.snappingOptions.featureSources=e};n.forEach((e=>_(this,void 0,void 0,(function*(){var i,s;const{groupedFields:a,addRecords:r,deleteRecords:o,updateGeometries:l,layerId:d,id:c}=e,v=t.view.map.layers;let m=v.find((e=>e.id===d));m||v.forEach((e=>{var t;const i=null===(t=e)||void 0===t?void 0:t.layers;i&&(c.includes(e.id)||c.includes(d))&&(m=i.find((e=>{var t;return(null===(t=e.layerId)||void 0===t?void 0:t.toString())===d||e.id===d})))}));const f=yield this.getDsAccessibleInfo(null===(i=m)||void 0===i?void 0:i.url),g=yield this.getPrivilege(),y=f||g;u.push({layer:m,fieldConfig:null===(s=this.constructFieldConfig(a))||void 0===s?void 0:s.asMutable({deep:!0}),enabled:y&&(r||l||o),addEnabled:r,updateEnabled:l,deleteEnabled:o}),h++,h===n.length&&p()}))))},this.getFeatureLayer=e=>{var i;const{id:s}=this.props,a=e,r=null===(i=null==e?void 0:e.getDataSourceJson())||void 0===i?void 0:i.isDataInDataSourceInstance;let o;const n=e&&e.getCurrentQueryParams();if(r)return a.load({returnGeometry:!0},{widgetId:s}).then((e=>_(this,void 0,void 0,(function*(){const i=yield Promise.resolve(e);return t.dataSourceUtils.createFeatureLayerByRecords(a,i)})))).catch((e=>{console.error(e)}));if(!S.default)return Promise.resolve(o);if(a.itemId){const e=parseInt(a.layerId),t={portalItem:{id:a.itemId,portal:{url:a.portalUrl}},definitionExpression:n.where,layerId:e||void 0};a.url&&(t.url=a.url),o=new S.default(t)}else{if(!a.url)return a.layer?a.load({returnGeometry:!0},{widgetId:s}).then((e=>_(this,void 0,void 0,(function*(){const i=yield Promise.resolve(e);return t.dataSourceUtils.createFeatureLayerByRecords(a,i)})))).catch((e=>{console.error(e)})):Promise.resolve(o);o=new S.default({definitionExpression:n.where,url:a.url})}return r?Promise.resolve(o):o.load().then((()=>_(this,void 0,void 0,(function*(){return yield Promise.resolve(o)})))).catch((e=>{console.error(e)}))},this.getCurrentEditLayer=e=>{const{activeId:t,jimuMapView:i}=this.state,{config:s}=this.props,{layersConfig:a}=s,r=i.view.map.layers,o=a.asMutable({deep:!0}).find((e=>e.id===t)),{id:n}=o;let l=r.find((t=>t.id===e));return l||r.forEach((t=>{var i;const s=null===(i=t)||void 0===i?void 0:i.layers;s&&((null==n?void 0:n.includes(t.id))||(null==n?void 0:n.includes(e)))&&(l=s.find((t=>{var i;return(null===(i=t.layerId)||void 0===i?void 0:i.toString())===e||t.id===e})))})),l},this.overrideClickOfEditor=(e,t)=>_(this,void 0,void 0,(function*(){var i,s,a;const{activeId:r,dataSources:o,editFeatures:n,jimuMapView:l}=this.state,d=this.edit,c=null===(i=d)||void 0===i?void 0:i.domNode.getElementsByClassName("esri-editor__feature-list-item")[0];if(!c)return;const u=e||n,h=this.flatMapArrayWithView(u,l).length;if(1===h){c.onclick=null,c.onkeydown=null;const e=t||r,i=this.getLayerObjectIdField(o[e]),n=null===(a=null===(s=null==u?void 0:u[e])||void 0===s?void 0:s[0])||void 0===a?void 0:a.feature,l=this.getCurrentEditLayer(null==n?void 0:n.layer.id);if(!l)return;const h=new C.default({where:`${i} = ${n.attributes[i]}`,outFields:["*"],returnGeometry:!0});l.queryFeatures(h).then((e=>{const t=null==e?void 0:e.features[0],i=()=>{null==d||d.startUpdateWorkflowAtFeatureEdit(t),this.setState({snappingShow:!1})};c.onclick=i,c.onkeydown=i})).catch((e=>{console.error(e)}))}else if(h>1){c.onclick=null,c.onkeydown=null;const e=()=>_(this,void 0,void 0,(function*(){var e;let t=[];const i=[];for(const t in u){const s=this.getLayerObjectIdField(o[t]),a=null==u?void 0:u[t];if((null==a?void 0:a.length)>0){const r=`${s} IN (${u[t].map((e=>{var t;return(null===(t=e)||void 0===t?void 0:t.feature).attributes[s]})).join()})`,o=null===(e=a[0])||void 0===e?void 0:e.feature,n=this.getCurrentEditLayer(null==o?void 0:o.layer.id),l=new C.default({where:r,outFields:["*"],returnGeometry:!0});i.push(n.queryFeatures(l))}}const s=yield Promise.all(i);return Object.keys(u).forEach(((e,i)=>{var a;t=t.concat((null===(a=s[i])||void 0===a?void 0:a.features)||[])})),t})),t=yield e(),i=()=>{null==d||d.startUpdateWorkflowAtMultipleFeatureSelection(t),this.setState({snappingShow:!1})};c.onclick=i,c.onkeydown=i}else{(null==d?void 0:d.activeWorkflow)&&(null==d||d.cancelWorkflow());const e=()=>{d.viewModel.canUpdate&&d.viewModel.startUpdateWorkflowAtFeatureSelection()};c.onkeydown=e,c.onclick=e}})),this.startWorkFlowWhenAwait=(e,t)=>_(this,void 0,void 0,(function*(){var i,s;const{activeId:a,dataSources:r,editFeatures:o,jimuMapView:n}=this.state,l=this.edit,d=e||o,c=this.flatMapArrayWithView(d,n).length;if(1===c){const e=t||a,o=this.getLayerObjectIdField(r[e]),n=null===(s=null===(i=null==d?void 0:d[e])||void 0===i?void 0:i[0])||void 0===s?void 0:s.feature,c=this.getCurrentEditLayer(null==n?void 0:n.layer.id);if(!c)return;const u=new C.default({where:`${o} = ${n.attributes[o]}`,outFields:["*"],returnGeometry:!0});c.queryFeatures(u).then((e=>{const t=null==e?void 0:e.features[0];null==l||l.startUpdateWorkflowAtFeatureEdit(t),this.setState({snappingShow:!1})})).catch((e=>{console.error(e)}))}else if(c>1){const e=()=>_(this,void 0,void 0,(function*(){var e;let t=[];const i=[];for(const t in d){const s=this.getLayerObjectIdField(r[t]),a=null==d?void 0:d[t];if((null==a?void 0:a.length)>0){const r=`${s} IN (${d[t].map((e=>{var t;return(null===(t=e)||void 0===t?void 0:t.feature).attributes[s]})).join()})`,o=null===(e=a[0])||void 0===e?void 0:e.feature,n=this.getCurrentEditLayer(null==o?void 0:o.layer.id),l=new C.default({where:r,outFields:["*"],returnGeometry:!0});i.push(n.queryFeatures(l))}}const s=yield Promise.all(i);return Object.keys(d).forEach(((e,i)=>{var a;t=t.concat((null===(a=s[i])||void 0===a?void 0:a.features)||[])})),t})),t=yield e();null==l||l.startUpdateWorkflowAtMultipleFeatureSelection(t),this.setState({snappingShow:!1})}else{if((null==l?void 0:l.activeWorkflow)&&(null==l||l.cancelWorkflow()),!l.viewModel.canUpdate)return;l.viewModel.startUpdateWorkflowAtFeatureSelection(),this.setState({snappingShow:!1})}})),this.idsArrayEquals=(e,t)=>{var i,s;if(!t)return!1;if((null===(i=this.selectedIds[e])||void 0===i?void 0:i.length)!==t.length)return!1;let a=!0;return null===(s=this.selectedIds[e])||void 0===s||s.forEach(((e,i)=>{e!==t[i]&&(a=!1)})),a},this.onDataSourceSelectedChange=(t,i)=>_(this,void 0,void 0,(function*(){var s,a;if(this.idsArrayEquals(t,i))return;const r=this.currentRequestId+1;this.currentRequestId++,this.selectedIds[t]=i;const{config:o}=this.props,{editMode:n,layersConfig:l}=o,{activeId:d,dataSources:c,editFeatures:u,jimuMapView:h,stepId:p}=this.state;let v=t;const m=Object.assign({},u);if(!c[v]){const e=this.dsManager.getDataSource(v);e&&(c[v]=e)}const f=null===(s=c[v])||void 0===s?void 0:s.getSelectedRecords();m[v]=f,Object.keys(m).forEach((e=>{var t;m[e]=null===(t=c[e])||void 0===t?void 0:t.getSelectedRecords()}));const g=this.getInLayersConfigFeatures(m,l),y=this.flatMapArray(g).length,b=y>1?"list":1===y?"form":"empty";if(0===(null==f?void 0:f.length)&&1===y){let e;for(const t in m)1===(null===(a=null==m?void 0:m[t])||void 0===a?void 0:a.length)&&(e=t);v=e}const S=d!==t;if(n===e.Attribute&&this.setState({editFeatures:m,activeId:v,featureFormStep:b},(()=>{this.createEditForm(v,S,r)})),n===e.Geometry){if(!h)return;const e=["awaiting-feature-to-update","editing-existing-feature","awaiting-update-feature-candidate"];this.setState({editFeatures:m,activeId:t},(()=>{e.includes(p)?this.startWorkFlowWhenAwait(m,v):this.overrideClickOfEditor(m,v)}))}})),this.onIsDataSourceNotReady=(e,i)=>{this.setState((s=>{var a;if(!(null===(a=s.dataSources[e])||void 0===a?void 0:a.getDataSourceJson().isOutputFromWidget))return;const r=Object.assign({},s.outputDataSourceIsNotReady);return r[e]=i===t.DataSourceStatus.NotReady,{outputDataSourceIsNotReady:r}}))},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((i=>{const s=Object.assign({},i.dataSources);return s[e]=t,{dataSources:s}}))},this.onDataSourceVersionChange=t=>{const{config:i}=this.props,{editMode:s}=i;s===e.Attribute&&this.setState({activeId:t},(()=>{this.createEditForm(t,!0)}))},this.onLayerChange=e=>{var t;const{dataSources:i}=this.state,s=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;this.setState({activeId:s},(()=>{this.renderFeatureForm(i[s])}))},this.changeSnapping=(e,t)=>{const i="selfSnappingCheck"===e?{selfSnappingCheck:t}:{featureSnappingCheck:t};this.setState(i,(()=>{const{config:e}=this.props,{selfSnapping:t,featureSnapping:i}=e,{jimuMapView:s,selfSnappingCheck:a,featureSnappingCheck:r}=this.state,o=t||i,n=a||r,l=this.edit,d=s.view.map.layers.map((e=>({layer:e})));l.snappingOptions.enabled=o&&n,l.snappingOptions.selfEnabled=a,l.snappingOptions.featureEnabled=r,l.snappingOptions.featureSources=d}))},this.handleBack=()=>{const{id:e,config:t}=this.props,{layersConfig:i}=t,{editFeatures:s}=this.state,a=this.getInLayersConfigFeatures(s,i),r=this.flatMapArray(a).length;0===r?this.setState({featureFormStep:"empty"}):r>1&&this.setState({featureFormStep:"list"}),document.getElementById(`edit-container-${e}`).classList.add("esri-hidden")},this.getInLayersConfigFeatures=(e,t)=>{const i=Object.assign({},e);return Object.keys(e).forEach((e=>{t.some((t=>e.includes(t.id)))||delete i[e]})),i},this.state={jimuMapView:void 0,dataSources:{},outputDataSourceIsNotReady:{},editFeatures:{},activeId:void 0,featureFormStep:"empty",filterText:"",selfSnappingCheck:!0,featureSnappingCheck:!0,snappingShow:!1,formEditable:!1,delConfirm:!1,attrUpdating:!1},this.dsManager=t.DataSourceManager.getInstance(),this.removeLayerOnce=!1,this.selectedIds={},this.currentRequestId=0}componentDidUpdate(i,s){var a,r,o,n,l,d,c,u,h,p,v,m,f;const{id:g,config:y}=this.props,{editFeatures:b,dataSources:S}=this.state,{editMode:w,layersConfig:x}=y,{config:j}=i,{layersConfig:F}=j,C=F!==x;if(0===x.length&&this.destoryEdit(),!!(null===(r=null===(a=this.props)||void 0===a?void 0:a.stateProps)||void 0===r?void 0:r.editModeChange)&&(this.props.dispatch(t.appActions.widgetStatePropChange(g,"editModeChange",!1)),this.destoryEdit()),C)if(w===e.Geometry)this.createEditor();else{const e=this.edit,t=Object.keys(b),i=x.some((e=>t.includes(e.id)));if((null==e?void 0:e.formTemplate)&&0!==x.length){const t=this.constructFormElements();(null==e?void 0:e.formTemplate)&&(e.formTemplate.elements=t),0===t.length?null===(o=document.getElementById(`edit-container-${g}`))||void 0===o||o.classList.add("esri-hidden"):null===(n=document.getElementById(`edit-container-${g}`))||void 0===n||n.classList.remove("esri-hidden")}else if(0!==x.length&&i){const e=this.getInLayersConfigFeatures(b,x),i=this.flatMapArray(e).length;if(1===i){const e=null==S?void 0:S[t[0]],i=null===(l=e.getSelectedRecords())||void 0===l?void 0:l[0];if(!i)return;this.renderFeatureForm(e,i)}else(i>1||0===i)&&(null===(d=document.getElementById(`edit-container-${g}`))||void 0===d||d.classList.add("esri-hidden"))}}if((null===(u=null===(c=this.props)||void 0===c?void 0:c.stateProps)||void 0===u?void 0:u.removeLayerFlag)&&!this.removeLayerOnce){this.props.dispatch(t.appActions.widgetStatePropChange(g,"removeLayerFlag",!1));const e=Object.assign({},b);Object.keys(e).forEach((t=>{x.find((e=>e.id===t))||delete e[t]}));const i=this.getInLayersConfigFeatures(e,x),s=this.flatMapArray(i),a=s.length,r=a>1?"list":1===a?"form":"empty";if("form"===r){this.removeLayerOnce=!0;const e=null===(v=null===(p=null===(h=s[0])||void 0===h?void 0:h.dataSource)||void 0===p?void 0:p.belongToDataSource)||void 0===v?void 0:v.id;null===(m=document.getElementById(`edit-container-${g}`))||void 0===m||m.classList.remove("esri-hidden"),this.renderFeatureForm(S[e],s[0])}else"list"===r&&(null===(f=document.getElementById(`edit-container-${g}`))||void 0===f||f.classList.add("esri-hidden"));this.setState({editFeatures:e,featureFormStep:r})}}render(){var s,n,l;const{activeId:c,editFeatures:u,featureFormStep:h,selfSnappingCheck:p,featureSnappingCheck:v,snappingShow:m,formEditable:f,delConfirm:y,attrUpdating:b}=this.state,{id:S,theme:w,config:x,useDataSources:j,useMapWidgetIds:F}=this.props,{editMode:C,description:I,layersConfig:_,selfSnapping:k,featureSnapping:M}=x,D=_.asMutable({deep:!0}).find((e=>e.id===c)),E=null!==(s=null==D?void 0:D.deleteRecords)&&void 0!==s&&s,O=this.getInLayersConfigFeatures(u,_),$=this.flatMapArray(O).length,L=_.some((e=>null==e?void 0:e.addRecords)),R=[{label:this.formatMessage("update"),type:"primary",disabled:!1,clickHandler:this.handleSave}];E&&R.push({label:this.formatMessage("delete"),type:"default",clickHandler:this.handleDeleteConfirm});const P=[{label:this.formatMessage("add"),type:"primary",disabled:!1,clickHandler:this.handleAdd}],T=C===e.Attribute,z=T&&("form"===h||"new"===h)||!T&&0!==_.length,B=T&&"list"!==h&&"empty"!==h||!T&&0!==_.length,H=null===(l=null===(n=this.edit)||void 0===n?void 0:n.viewModel)||void 0===l?void 0:l.state,U=(!H||"ready"===H)&&0!==_.length;return T||F&&0!==F.length?(0,t.jsx)("div",{className:(0,t.classNames)(`jimu-widget widget-edit edit-widget-${S}`),css:r(w,S,h,$,T)},T&&b&&(0,t.jsx)("div",{className:"esri-editor__progress-bar"}),(0,t.jsx)("div",{className:(0,t.classNames)("edit-con",{"surface-1":z,"h-100":B})},(0,t.jsx)("div",{ref:"formHeaderContainer"}),(0,t.jsx)("div",{ref:"editContainer",className:(0,t.classNames)({"h-100":!T,"attr-height":T&&B})},T&&"new"===h&&(0,t.jsx)("div",{className:"layer-selector"},(0,t.jsx)("label",{className:"esri-feature-form__label"},this.formatMessage("selectLayer")),(0,t.jsx)(a.Select,{value:c,onChange:this.onLayerChange},_.filter((e=>e.addRecords)).map((e=>(0,t.jsx)("option",{key:e.id,value:e.id},e.name)))))),!T&&U&&m&&(0,t.jsx)("div",{className:"snapping-option"},k&&(0,t.jsx)("div",{className:"snapping-item",key:"selfSnapping"},(0,t.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("selfSnapping")),(0,t.jsx)(a.Switch,{className:"can-x-switch",checked:p,onChange:e=>this.changeSnapping("selfSnappingCheck",e.target.checked)})),M&&(0,t.jsx)("div",{className:"snapping-item",key:"featureSnapping"},(0,t.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("featureSnapping")),(0,t.jsx)(a.Switch,{className:"can-x-switch",checked:v,onChange:e=>this.changeSnapping("featureSnappingCheck",e.target.checked)}))),T&&$>0&&"form"===h&&f&&this.renderControlButtons(R),T&&"new"===h&&this.renderControlButtons(P)),!T&&(0,t.jsx)(i.JimuMapViewComponent,{useMapWidgetId:null==F?void 0:F[0],onActiveViewChange:this.handleActiveViewChange}),T&&$>1&&"list"===h&&this.renderFeatureList(O,I),T&&("empty"===h||0===_.length)&&this.renderFormEmpty(I),!T&&0===_.length&&this.renderFormEmpty(),T&&y&&(0,t.jsx)("div",{className:"esri-editor__overlay"},(0,t.jsx)("div",{className:"esri-editor__warning-card",role:"alert"},(0,t.jsx)("div",{className:"esri-editor__warning-header"},(0,t.jsx)("span",{className:"esri-icon-notice-triangle","aria-hidden":"true"}),(0,t.jsx)("h4",{className:(0,t.classNames)("esri-widget__heading","esri-editor__warning-heading")},this.formatMessage("deleteRecord"))),(0,t.jsx)("div",{className:"esri-editor__warning-message"},this.formatMessage("deleteRecordTips")),(0,t.jsx)("div",{className:"esri-editor__warning-divider"}),(0,t.jsx)("div",{className:(0,t.classNames)(A,"esri-editor__warning-option--primary"),role:"button",onClick:this.cancleDelete},this.formatMessage("keepRecord")),(0,t.jsx)("div",{className:(0,t.classNames)(A,"esri-editor__warning-option--positive"),role:"button",onClick:this.handleDelete},this.formatMessage("delete")))),T&&L&&"form"!==h&&"new"!==h&&(0,t.jsx)(a.Button,{size:"sm",icon:!0,type:"tertiary",className:"add-feature-btn",onClick:this.handleNew,title:this.formatMessage("addFeature"),"aria-label":this.formatMessage("addFeature")},(0,t.jsx)(d,null)),T&&("form"===h||"new"===h)&&$>1&&(0,t.jsx)(a.Button,{size:"sm",icon:!0,type:"tertiary",className:"back-list-btn",onClick:this.handleBack,title:this.formatMessage("back"),"aria-label":this.formatMessage("back")},(0,t.jsx)(g,null)),(0,t.jsx)("div",{className:"ds-container"},null==j?void 0:j.map(((e,i)=>(0,t.jsx)(o,{key:i,useDataSource:e,onIsDataSourceNotReady:this.onIsDataSourceNotReady,onDataSourceSelectedChange:this.onDataSourceSelectedChange,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed,onDataSourceVersionChange:this.onDataSourceVersionChange}))))):(0,t.jsx)(a.WidgetPlaceholder,{widgetId:S,autoFlip:!0,iconSize:"large",style:{position:"absolute",left:0,top:0},icon:N,"data-testid":"editPlaceholder"})}}L.mapExtraStateProps=(e,t)=>{var i;return{appMode:null===(i=null==e?void 0:e.appRuntimeInfo)||void 0===i?void 0:i.appMode}}})(),m})())}}}));