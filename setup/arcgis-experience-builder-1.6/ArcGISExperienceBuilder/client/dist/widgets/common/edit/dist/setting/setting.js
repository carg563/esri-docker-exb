System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/basic/list-tree","jimu-for-builder","jimu-core/react"],(function(e,t){var i={},s={},a={},o={},n={},r={},l={};return{setters:[function(e){i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.React=e.React,i.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,i.classNames=e.classNames,i.css=e.css,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.polished=e.polished,i.urlUtils=e.urlUtils,i.utils=e.utils},function(e){s.Alert=e.Alert,s.Button=e.Button,s.Checkbox=e.Checkbox,s.ConfirmDialog=e.ConfirmDialog,s.Icon=e.Icon,s.Label=e.Label,s.PanelHeader=e.PanelHeader,s.Popper=e.Popper,s.Radio=e.Radio,s.Switch=e.Switch,s.TextArea=e.TextArea,s.TextInput=e.TextInput,s.defaultMessages=e.defaultMessages},function(e){a.MapWidgetSelector=e.MapWidgetSelector,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection,a.SidePopper=e.SidePopper},function(e){o.AllDataSourceTypes=e.AllDataSourceTypes,o.DataSourceSelector=e.DataSourceSelector,o.FieldSelector=e.FieldSelector,o.dataComponentsUtils=e.dataComponentsUtils},function(e){n.List=e.List,n.Tree=e.Tree,n.TreeCollapseStyle=e.TreeCollapseStyle,n.TreeItemActionType=e.TreeItemActionType,n.TreeType=e.TreeType},function(e){r.builderAppSync=e.builderAppSync},function(e){l.Fragment=e.Fragment}],execute:function(){e((()=>{var e={748:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 10-6.586 4.533l-.077-1.008A5.5 5.5 0 1112 6.5zm-9 0a3.501 3.501 0 002.88 3.445L5.8 8.901a2.501 2.501 0 113.194-2.224l.949.456A3.5 3.5 0 103 6.5zM15.5 11l-5 1-3 4-1-9.5 9 4.5zm-5.57.094l-1.702 2.269-.542-5.152 4.76 2.38-2.517.503z" fill="#000"></path></svg>'},20173:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 2h4a1 1 0 011 1v1h8a1 1 0 011 1v9a1 1 0 01-1 1H1a1 1 0 01-1-1V3a1 1 0 011-1zm0 1v11h13V4.913H5V3H1zm6 3h1v3h3v1H8v3H7v-3H4V9h3V6z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.745 8l6.1 6.1a.527.527 0 11-.745.746L8 8.746l-6.1 6.1a.527.527 0 11-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 01.746-.746l6.1 6.1 6.1-6.1a.527.527 0 01.746.746L8.746 8z" fill="#000"></path></svg>'},57309:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.027.516A.522.522 0 007.5 0a.522.522 0 00-.527.516v9.508L4.4 7.527a.535.535 0 00-.746 0 .508.508 0 000 .73L7.5 12l3.846-3.743a.508.508 0 000-.73.535.535 0 00-.746 0l-2.573 2.497V.516zM1 8v7h13V8h1v8H0V8h1z" fill="#000"></path></svg>'},34750:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 0a.5.5 0 00-.5.5V7H.5a.5.5 0 000 1H7v6.5a.5.5 0 001 0V8h6.5a.5.5 0 000-1H8V.5a.5.5 0 00-.5-.5z" fill="#000"></path></svg>'},54357:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6.5a.5.5 0 011 0v6a.5.5 0 01-1 0v-6zM9.5 6a.5.5 0 00-.5.5v6a.5.5 0 001 0v-6a.5.5 0 00-.5-.5z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M11 0H5a1 1 0 00-1 1v2H.5a.5.5 0 000 1h1.6l.81 11.1a1 1 0 00.995.9h8.19a1 1 0 00.995-.9L13.9 4h1.6a.5.5 0 000-1H12V1a1 1 0 00-1-1zm0 3V1H5v2h6zm1.895 1h-9.79l.8 11h8.19l.8-11z" fill="#000"></path></svg>'},88866:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5.5a1 1 0 100-2 1 1 0 000 2zM6.5 7.5A.5.5 0 017 7h1.5v4.5h1a.5.5 0 010 1h-3a.5.5 0 010-1h1V8H7a.5.5 0 01-.5-.5z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16A8 8 0 118 0a8 8 0 010 16zm0-1A7 7 0 108 1a7 7 0 000 14z" fill="#000"></path></svg>'},1810:e=>{"use strict";e.exports=i},52127:e=>{"use strict";e.exports=l},3297:e=>{"use strict";e.exports=r},21835:e=>{"use strict";e.exports=s},33037:e=>{"use strict";e.exports=o},23080:e=>{"use strict";e.exports=a},82165:e=>{"use strict";e.exports=n}},t={};function d(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,d),a.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var i in t)d.o(t,i)&&!d.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var c={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(c),d.d(c,{default:()=>F});var e,t=d(1810),i=d(21835),s=d(23080),a=d(33037);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={}));const o={newEdit:"New editable source",newEditGeo:"New editable layer",newEditTips:"Support selected features view only",newMapEditTips:"Add layers from the map",attrMode:"Attribute only",geoMode:"Geometry and attribute",layerConfig:"Layer configuration",capability:"Capability",addRecords:"Add records",deleteRecords:"Delete records",updateGeometries:"Update geometries",snappingSettings:"Snapping settings",selfSnapping:"Self snapping",featureSnapping:"Feature snapping",configFields:"Configure fields",configFieldsTip:"Select fields to show",importAll:"Import all",addGroup:"Add a group",group:"Group",checkAll:"Check all",uncheckAll:"Uncheck all",removeGroupConfirmTitle:"Are you sure you want to remove the group?",removeGroupConfirmTips:"The fields included in the group will also be removed.",noDataMessage:"No data message",noDeataMessageDefaultText:"No valid record is selected, select one or add one.",editBlankStatus:'Click the "{EditString}" button to add and configure {ModeString}',editableSource:"editable data sources",editableLayer:"editable layers",changeModeConfirmTitle:"Are you sure you want to switch the mode?",changeModeConfirmTips:"You will lose the settings configured.",editable:"Editable",editFieldDescription:"Please input the description.",selectMap:"Select a Map widget"};var n=d(82165),r=d(20173),l=d.n(r);const p=e=>{const{className:s}=e,a=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(e,["className"]),o=(0,t.classNames)("jimu-icon-component",s);return t.React.createElement(i.Icon,Object.assign({className:o,icon:l()},a))};var h=d(54357),u=d.n(h);const m=e=>{const{className:s}=e,a=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(e,["className"]),o=(0,t.classNames)("jimu-icon-component",s);return t.React.createElement(i.Icon,Object.assign({className:o,icon:u()},a))};var g=d(88866),f=d.n(g);const y=e=>{const{className:s}=e,a=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(e,["className"]),o=(0,t.classNames)("jimu-icon-component",s);return t.React.createElement(i.Icon,Object.assign({className:o,icon:f()},a))};class v extends t.React.PureComponent{constructor(e){super(e),this.supportedDsTypes=(0,t.Immutable)([a.AllDataSourceTypes.FeatureLayer,a.AllDataSourceTypes.SceneLayer]),this.nameChange=e=>{const t=e.target.value;this.setState({itemLabel:t})},this.nameAccept=e=>{(e=""===(e=null==e?void 0:e.trim())?this.props.name:e)!==this.state.itemLabel&&this.setState({itemLabel:e}),this.props.optionChange("name",e)},this.getUncheckState=(e=[])=>{let t=!1;return e.forEach((e=>{!e.editAuthority&&e.editable&&(t=!0)})),t},this.handleSwitchChange=(e,t)=>{const i=e.currentTarget;i&&this.props.optionChange(t,i.checked)},this.findEditingIndex=e=>{const{groupedFields:t}=this.props;let i;return t.forEach(((t,s)=>{if(t.jimuName===e)i=[s];else if(null==t?void 0:t.children){const a=t.children.findIndex((t=>t.jimuName===e));a>-1&&(i=[s,a])}})),i},this.handleTreeBoxChange=e=>{const t=e.currentTarget;if(!t)return;const{groupedFields:i}=this.props,s=this.findEditingIndex(t.id);if(2===s.length){const[e,a]=s;i[e][a].editAuthority=t.checked}else if(1===s.length){const[e]=s;i[e].editAuthority=t.checked}this.props.optionChange("groupedFields",i);const a=this.constructTreeItem(i);this.setState({rootItemJson:a})},this.handleTreeDescChange=e=>{const{itemDesc:t}=this.state,{groupedFields:i}=this.props,s=this.findEditingIndex(e);if(2===s.length){const[e,a]=s;i[e].children[a].subDescription=t}else if(1===s.length){const[e]=s;i[e].subDescription=t}this.props.optionChange("groupedFields",i);const a=this.constructTreeItem(i);this.setState({rootItemJson:a,isOpenDetailPopper:!1})},this.formatMessage=(e,t)=>{const s=Object.assign({},o,i.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:s[e]},t)},this.minusArray=(e,t,i)=>{const s=i||"jimuName",a=e.length>t.length,o=a?t:e;return(a?e:t).filter((e=>!o.some((t=>(null==t?void 0:t[s])===(null==e?void 0:e[s])))))},this.onFieldChange=e=>{var t;if(!e)return;const{dataSource:i}=this.state,{showFields:s,groupedFields:a}=this.props,o=e.filter((e=>e));if(0===e.length)a.length=0;else{const o=this.minusArray(e,s),n=null==o?void 0:o[0];let r;if(a.forEach(((e,t)=>{if(null==e?void 0:e.children){const i=e.children.findIndex((e=>e.jimuName===(null==n?void 0:n.jimuName)));i>-1&&(r=[t,i])}else e.jimuName===(null==n?void 0:n.jimuName)&&(r=[t])})),r){if(2===r.length){const[e,t]=r;a[e].children.splice(t,1)}else if(1===r.length){const[e]=r;a.splice(e,1)}}else{const e=null===(t=i)||void 0===t?void 0:t.getLayerDefinition(),s=((null==e?void 0:e.fields)||[]).find((e=>e.name===n.jimuName)),o=null==s?void 0:s.editable;a.push(Object.assign(Object.assign({},n),{editAuthority:o,subDescription:(null==n?void 0:n.description)||"",editable:o}))}}this.props.multiOptionsChange({showFields:o,groupedFields:a});const n=this.constructTreeItem(a);this.setState({rootItemJson:n})},this.onDataSourceCreated=e=>{this.setState({dataSource:e})},this.getFieldsFromDatasource=()=>{const{useDataSource:e}=this.props,i=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),s=null==i?void 0:i.getSchema();return(null==s?void 0:s.fields)?Object.values(null==s?void 0:s.fields):[]},this.checkFieldsExist=(e,t)=>{let i=!1;for(const s of e)if(s.jimuName===t.jimuName){i=!0;break}return i},this.getSelectorFields=e=>{const t=[];return e&&e.length>0&&e.forEach((e=>{t.push(e.jimuName)})),t},this.handleTreeBoxAll=e=>{const{groupedFields:t}=this.props,i=t.map((t=>(null==t?void 0:t.children)?Object.assign(Object.assign({},t),{editAuthority:e,children:t.children.map((t=>Object.assign(Object.assign({},t),t.editable?{editAuthority:e}:{})))}):Object.assign(Object.assign({},t),t.editable?{editAuthority:e}:{})));this.props.optionChange("groupedFields",i);const s=this.constructTreeItem(i);this.setState({rootItemJson:s,hasUncheck:!e})},this.addGroupForFields=()=>{this.groupId++;const e={jimuName:`${this.formatMessage("group")}-${this.groupId}`,name:`${this.formatMessage("group")}-${this.groupId}`,alias:`${this.formatMessage("group")}-${this.groupId}`,subDescription:"",editAuthority:!1,editable:!0,children:[],groupKey:this.groupId},{groupedFields:t}=this.props;t.unshift(e),this.props.optionChange("groupedFields",t);const i=this.constructTreeItem(t);this.setState({rootItemJson:i})},this.removeGroup=e=>{var t;const{groupedFields:i}=this.props,s=i.findIndex((t=>t.jimuName===e));i.splice(s,1,...null===(t=i[s])||void 0===t?void 0:t.children),this.props.optionChange("groupedFields",i);const a=this.constructTreeItem(i);this.setState({rootItemJson:a})},this.constructTreeItem=(e=[])=>{const{theme:i}=this.props,s=this.getFieldsFromDatasource(),o=e=>Array.from(e).map(((e,n)=>Object.assign({itemKey:`${t.utils.getUUID()}_${n}`,itemStateChecked:null==e?void 0:e.editAuthority,itemStateTitle:e.alias||e.jimuName||e.name,itemStateIcon:a.dataComponentsUtils.getIconFromFieldType(e.type,i),itemStateDetailContent:e,itemStateDisabled:!(null==e?void 0:e.groupKey)&&!this.checkFieldsExist(s,e),itemStateCommands:[],isCheckboxDisabled:!e.editable},e.children?{itemChildren:o(e.children)}:{})));return{itemKey:"root item for tree data entry",itemStateTitle:"root item for tree data entry",itemChildren:o(e)}},this.setRootItemJson=e=>{this.setState({rootItemJson:e})},this.showDetailPopper=(e,t)=>{const{isOpenDetailPopper:i}=this.state;this.setState({isOpenDetailPopper:!i,popperRef:e,curEditField:t,itemDesc:(null==t?void 0:t.subDescription)||(null==t?void 0:t.description)})},this.getCurrentEditField=e=>{const{groupedFields:t}=this.props,i=this.findEditingIndex(e);let s={jimuName:"",groupKey:"",editAuthority:!1,children:[],subDescription:"",description:"",name:""};if(2===(null==i?void 0:i.length)){const[e,a]=i;s=t[e].children[a]}else if(1===(null==i?void 0:i.length)){const[e]=i;s=t[e]}return s},this.onDescChange=e=>{const t=e.target.value;this.setState({itemDesc:t})},this.state={dataSource:void 0,rootItemJson:this.constructTreeItem(e.groupedFields),itemLabel:e.name||"",hasUncheck:this.getUncheckState(e.groupedFields),isOpenDetailPopper:!1,popperRef:void 0,curEditField:void 0,itemDesc:""},this.colRef=t.React.createRef(),this.groupId=this.getGroupMaxId(e.groupedFields)}componentDidUpdate(e,t){this.props.name!==e.name&&this.setState({itemLabel:this.props.name||""}),this.props.id!==e.id&&this.setState({rootItemJson:this.constructTreeItem(this.props.groupedFields)})}getGroupMaxId(e=[]){const t=[];return e.forEach((e=>{(null==e?void 0:e.groupKey)&&t.push(null==e?void 0:e.groupKey)})),t.length>0?Math.max.apply(null,t):0}getStyle(e){return t.css`
      .layer-config-panel {
        .panel-inner {
          .title {
            max-width: 70%;
          }
        }
        .setting-container {
          height: calc(100% - ${t.polished.rem(58)});
          overflow: auto;
          .fields-list-header {
            background: ${e.colors.palette.light[200]};
            border-bottom: 1px solid ${e.colors.palette.light[600]};
            height: 34px;
            .jimu-checkbox {
              margin-top: 2px;
            }
          }
          .selected-fields-con{
            margin-top: 0;
            .selected-fields-list {
              flex: 1;
              max-height: 300px;
              overflow-y: auto;
            }
            .jimu-tree-item{
              background: ${e.colors.palette.light[200]};
              border-bottom: 1px solid ${e.colors.palette.light[300]};
              .jimu-tree-item__content{
                div:first-of-type{
                  padding-left: 2px;
                }
                .jimu-tree-item__body{
                  background: ${e.colors.palette.light[200]};
                  .jimu-tree-item__title{
                    .jimu-input{
                      width: 125px;
                    }
                  }
                }
              }
            }
          }
          .table-options {
            .table-options-item {
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            }
            .select-option {
              margin-bottom: 8px;
            }
          }
          .ds-container {
            position: absolute;
            display: none;
          }
          .component-field-selector {
            .search-input {
              width: 100%;
            }
            .field-list {
              max-height: 300px;
            }
          }
          .config-word-break {
            word-wrap: break-word;
          }
          .capability-item{
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
          }
        }
      }
    `}render(){var o;const{onClose:r,optionChange:l,dataSourceChange:d,filterDs:c,id:h,useDataSource:u,theme:g,showFields:f,editorConfig:v,addRecords:S,deleteRecords:b,updateGeometries:x}=this.props,{rootItemJson:C,itemLabel:j,dataSource:w,hasUncheck:I,isOpenDetailPopper:D,popperRef:M,curEditField:O}=this.state,T=v.editMode===e.Geometry,A=this.getSelectorFields(f),N=null===(o=w||t.DataSourceManager.getInstance().getDataSource(h))||void 0===o?void 0:o.getLayerDefinition(),k=(null==N?void 0:N.type)===t.SupportedLayerServiceTypes.Table,F=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),R=null==N?void 0:N.capabilities,P=F(R,"create"),L=F(R,"update"),E=F(R,"delete"),B={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:n.TreeItemActionType.RenderOverrideItem,children:[{name:n.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:n.TreeItemActionType.RenderOverrideItemContent,children:[{name:n.TreeItemActionType.RenderOverrideItemBody,children:[{name:n.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:n.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:n.TreeItemActionType.RenderOverrideItemDragHandle},{name:n.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:n.TreeItemActionType.RenderOverrideItemIcon},{name:n.TreeItemActionType.RenderOverrideItemTitle},{name:n.TreeItemActionType.RenderOverrideItemCommands},{name:n.TreeItemActionType.RenderOverrideItemDetailToggle}]}]},{name:n.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]},{name:n.TreeItemActionType.RenderOverrideItemSubitems}]})};return(0,t.jsx)("div",{className:"w-100 h-100",css:this.getStyle(g)},(0,t.jsx)("div",{className:"w-100 h-100 layer-config-panel"},(0,t.jsx)("div",{className:"w-100 d-flex px-3 py-0"},(0,t.jsx)(i.PanelHeader,{level:1,className:"py-3 panel-inner",showClose:!!r,onClose:r,title:this.formatMessage("layerConfig")})),(0,t.jsx)("div",{className:"setting-container"},(0,t.jsx)(s.SettingSection,{title:this.formatMessage("data"),className:"pt-0"},(0,t.jsx)(s.SettingRow,null,(0,t.jsx)(a.DataSourceSelector,{types:this.supportedDsTypes,hideDataView:!0,disableRemove:()=>!0,useDataSources:u?(0,t.Immutable)([u]):(0,t.Immutable)([]),mustUseDataSource:!0,onChange:d,closeDataSourceListOnChange:!0,hideDs:c}))),u&&(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(s.SettingSection,{title:this.formatMessage("label")},(0,t.jsx)(s.SettingRow,null,(0,t.jsx)(i.TextInput,{type:"text",className:"w-100",value:j,onChange:this.nameChange,onAcceptValue:this.nameAccept,"aria-label":this.formatMessage("label")}))),(0,t.jsx)(s.SettingSection,{title:this.formatMessage("capability")},(!T&&k||T)&&(0,t.jsx)("div",{className:"capability-item",key:"addRecords"},(0,t.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("addRecords")),(0,t.jsx)(i.Switch,{className:"can-x-switch",checked:S,onChange:e=>this.handleSwitchChange(e,"addRecords"),disabled:!P})),(0,t.jsx)("div",{className:"capability-item",key:"deleteRecords"},(0,t.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("deleteRecords")),(0,t.jsx)(i.Switch,{className:"can-x-switch",checked:b,onChange:e=>this.handleSwitchChange(e,"deleteRecords"),disabled:!E})),T&&(0,t.jsx)("div",{className:"capability-item",key:"updateGeometries"},(0,t.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("updateGeometries")),(0,t.jsx)(i.Switch,{className:"can-x-switch",checked:x,onChange:e=>this.handleSwitchChange(e,"updateGeometries"),disabled:!L}))),(0,t.jsx)(s.SettingSection,{title:this.formatMessage("configFields")},(0,t.jsx)(s.SettingRow,{flow:"wrap",label:this.formatMessage("configFieldsTip")},(0,t.jsx)(a.FieldSelector,{useDataSources:u?(0,t.Immutable)([u]):(0,t.Immutable)([]),onChange:this.onFieldChange,selectedFields:(0,t.Immutable)(A),isMultiple:!0,isSearchInputHidden:!1,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})),(0,t.jsx)(s.SettingRow,{className:"fields-list-header"},(0,t.jsx)("div",{className:"d-flex w-100 ml-4 fields-list-check"},(0,t.jsx)(i.Checkbox,{id:"editAll","data-field":"editAll",onClick:()=>this.handleTreeBoxAll(I),checked:!I,title:I?`${this.formatMessage("editable")} (${this.formatMessage("checkAll")})`:`${this.formatMessage("editable")} (${this.formatMessage("uncheckAll")})`}),(0,t.jsx)(i.Label,{for:"editAll",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("field")},this.formatMessage("field"))),(0,t.jsx)(i.Button,{icon:!0,size:"sm",type:"tertiary",onClick:this.addGroupForFields,title:this.formatMessage("addGroup"),"aria-label":this.formatMessage("addGroup")},(0,t.jsx)(p,null))),(0,t.jsx)(s.SettingRow,{className:"selected-fields-con"},(0,t.jsx)(n.Tree,Object.assign({className:"selected-fields-list",rootItemJson:C,treeType:n.TreeType.Intact,dndEnabled:!0,showCheckbox:!0,collapseStyle:n.TreeCollapseStyle.Arrow,renderOverrideItemCommands:(e,s)=>{const{itemJsons:a}=s.props,[o]=a,{jimuName:n}=null==o?void 0:o.itemStateDetailContent,r=this.getCurrentEditField(n),{jimuName:l,groupKey:d}=r;return d?(0,t.jsx)(i.Button,{icon:!0,size:"sm",type:"tertiary",onClick:()=>this.removeGroup(l),title:this.formatMessage("remove"),"aria-label":this.formatMessage("remove")},(0,t.jsx)(m,null)):""},renderOverrideItemDetailToggle:(e,s)=>{const{itemJsons:a,itemJsons:[{itemStateDetailVisible:o,itemStateDetailContent:n,itemStateDisabled:r}]}=s.props,[l]=a,{jimuName:d}=null==l?void 0:l.itemStateDetailContent,c=this.getCurrentEditField(d);return n?(0,t.jsx)(i.Button,{icon:!0,type:"tertiary",title:this.formatMessage("description"),"aria-label":this.formatMessage("description"),disabled:!!r,"aria-expanded":!!o,className:"jimu-tree-item__detail-toggle",onClick:e=>{e.stopPropagation(),this.showDetailPopper(s.dragRef,c)},css:()=>t.css`
                            &.jimu-tree-item__detail-toggle {
                              display: flex;
                              align-items: center;
                              cursor: pointer;

                              .icon-btn-sizer {
                                margin: 0;
                                min-width: 0.5rem;
                                min-height: 0.5rem;
                              }
                            }
                          `},(0,t.jsx)(y,{autoFlip:!o})):null},isItemDroppable:(e,t)=>{var i;const{targetItemJsons:s}=e;return!!(null===(i=s[0])||void 0===i?void 0:i.itemChildren)},isFolder:(e,t)=>{const{targetItemJsons:i}=e,[s]=i,{groupKey:a}=null==s?void 0:s.itemStateDetailContent;return!!a},onUpdateItem:(e,t)=>{var i;const{itemJsons:s,updateType:a}=e,o=s[s.length-1],[r]=s,{jimuName:d}=null==r?void 0:r.itemStateDetailContent,c=this.getCurrentEditField(d),{groupKey:p}=c;if(!p&&a===n.TreeItemActionType.HandleStartEditing)return;const h=null===(i=o.itemChildren)||void 0===i?void 0:i.map((e=>{var t;return(null==e?void 0:e.itemChildren)?Object.assign(Object.assign({},e.itemStateDetailContent),{children:e.itemChildren.map((e=>Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked}))),name:e.itemStateTitle,alias:e.itemStateTitle,editAuthority:!(null===(t=e.itemChildren)||void 0===t?void 0:t.some((e=>!1===e.itemStateChecked)))}):Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked})}));l("groupedFields",h);const u=this.getUncheckState(h);this.setState({rootItemJson:o,hasUncheck:u})},isItemFocused:()=>!1},B)),(0,t.jsx)(i.Popper,{placement:"bottom-start",disableResize:!0,reference:M,offset:[-27,3],open:D,showArrow:!1,toggle:e=>{this.setState({isOpenDetailPopper:!D})}},(0,t.jsx)("div",{style:{width:228,height:132},className:"p-3"},(0,t.jsx)(i.TextArea,{id:null==O?void 0:O.jimuName,className:"w-100",style:{height:60},placeholder:this.formatMessage("editFieldDescription"),value:(null==O?void 0:O.subDescription)||(null==O?void 0:O.description),onChange:this.onDescChange}),(0,t.jsx)("div",{className:"mt-3",style:{float:"right"}},(0,t.jsx)(i.Button,{size:"sm",type:"primary",onClick:()=>this.handleTreeDescChange(null==O?void 0:O.jimuName)},this.formatMessage("commonModalOk")),(0,t.jsx)(i.Button,{size:"sm",className:"ml-1",onClick:()=>{this.setState({isOpenDetailPopper:!1})}},this.formatMessage("commonModalCancel"))))))),(0,t.jsx)("div",{className:"ds-container"},(0,t.jsx)(t.DataSourceComponent,{useDataSource:(0,t.Immutable)(u),onDataSourceCreated:this.onDataSourceCreated}))))))}}var S=d(3297);class b extends t.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,t.jsx)(t.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var x=d(57309),C=d.n(x);const j=e=>{const{className:s}=e,a=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(e,["className"]),o=(0,t.classNames)("jimu-icon-component",s);return t.React.createElement(i.Icon,Object.assign({className:o,icon:C()},a))};var w=d(34750),I=d.n(w);const D=e=>{const{className:s}=e,a=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(e,["className"]),o=(0,t.classNames)("jimu-icon-component",s);return t.React.createElement(i.Icon,Object.assign({className:o,icon:I()},a))};var M=d(748),O=d.n(M);const T=e=>{const{className:s}=e,a=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i}(e,["className"]),o=(0,t.classNames)("jimu-icon-component",s);return t.React.createElement(i.Icon,Object.assign({className:o,icon:O()},a))};var A=d(52127),N=function(e,t,i,s){return new(i||(i=Promise))((function(a,o){function n(e){try{l(s.next(e))}catch(e){o(e)}}function r(e){try{l(s.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};const k=d(55339);class F extends t.React.PureComponent{constructor(s){super(s),this.sidePopperTrigger=t.React.createRef(),this.updateDsHash=e=>{this.dsHash={};let t=0;e.forEach((e=>{this.dsHash[t]=e.useDataSource,t++}))},this.getNewConfigId=e=>{var t;return`${e}-${((null===(t=this.props.config)||void 0===t?void 0:t.layersConfig.length)>0?this.getArrayMaxId(this.props.config.layersConfig):0)+1}`},this.dataSourceChangeSave=i=>{if(!i)return;const{config:s}=this.props,a=s.editMode===e.Geometry,o=(0,t.Immutable)(i[0]);this.dsManager.createDataSourceByUseDataSource(o).then((e=>{var i;const s=null===(i=e)||void 0===i?void 0:i.getLayerDefinition(),n=null==s?void 0:s.capabilities,r=(null==s?void 0:s.type)===t.SupportedLayerServiceTypes.Table,l=!a&&r||a,d=this.getDsCap(n,"create")&&l,c=this.getDsCap(n,"update"),p=this.getDsCap(n,"delete"),h=null==e?void 0:e.getSchema();let u=(null==h?void 0:h.fields)?Object.values(null==h?void 0:h.fields):[];const m=(null==s?void 0:s.fields)||[];(null==u?void 0:u.length)>50&&(u=u.slice(0,50));const g=u.map((e=>{const t=m.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,subDescription:(null==e?void 0:e.description)||"",editable:i})})),f={id:e.id,name:e.getLabel(),layerId:null==e?void 0:e.jimuChildId,useDataSource:o,addRecords:d,deleteRecords:p,updateGeometries:c,featureSnapping:!1,showFields:u,groupedFields:g};let y;if(this.props.config.layersConfig[this.index]){const e=this.props.config.layersConfig.asMutable({deep:!0});e.splice(this.index,1,f),y=(0,t.Immutable)(e)}else y=this.props.config.layersConfig.concat([(0,t.Immutable)(f)]);this.dsHash[this.index]=o,this.updateDsHash(y);const v={id:this.props.id,config:this.props.config.set("layersConfig",y),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(v)})).catch((e=>{console.error(e)}))},this.importAllLayersConfigSave=e=>N(this,void 0,void 0,(function*(){if(0===(null==e?void 0:e.length))return;const i=yield(()=>N(this,void 0,void 0,(function*(){let i=this.props.config.layersConfig;const s=[];e.forEach((e=>{s.push(this.dsManager.createDataSourceByUseDataSource((0,t.Immutable)(e)))}));const a=yield Promise.all(s);return e.forEach(((e,s)=>{const o=a[s],n=(0,t.Immutable)(e),r=null==o?void 0:o.getLayerDefinition(),l=(null==r?void 0:r.fields)||[],d=null==o?void 0:o.getSchema();let c=(null==d?void 0:d.fields)?Object.values(null==d?void 0:d.fields):[];(null==c?void 0:c.length)>50&&(c=c.slice(0,50));const p=c.map((e=>{const t=l.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,subDescription:(null==e?void 0:e.description)||"",editable:i})})),h=null==r?void 0:r.capabilities,u=this.getDsCap(h,"create"),m=this.getDsCap(h,"update"),g=this.getDsCap(h,"delete");if(u||m||g){const e={id:o.id,name:o.getLabel(),layerId:null==o?void 0:o.jimuChildId,useDataSource:n,addRecords:u,deleteRecords:g,updateGeometries:m,featureSnapping:!1,showFields:c,groupedFields:p};i=i.concat([(0,t.Immutable)(e)]),this.dsHash[this.index]=n}})),i})))();this.updateDsHash(i.asMutable({deep:!0}));const s={id:this.props.id,config:this.props.config.set("layersConfig",i),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(s)})),this.getDsCap=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),this.onFilterDs=i=>{var s;if(!(null==i?void 0:i.url)||(null==i?void 0:i.isOutputFromWidget))return!0;const{useMapWidgetIds:a,config:o}=this.props,{layersConfig:n,editMode:r}=o,l=n.map((e=>e.id));let d=!1;if(r===e.Geometry){const e=null==a?void 0:a[0];if(!e)return!0;const o=(null===(s=(0,t.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e])||void 0===s?void 0:s.useDataSources).map((e=>e.dataSourceId)),n=i.id.split("-")[0];d=!o.includes(n)||o.includes(n)&&l.includes(i.id)}else d=l.includes(i.id);return(e=>{var t;const i=null===(t=this.dsManager.getDataSource(e))||void 0===t?void 0:t.getLayerDefinition(),s=null==i?void 0:i.capabilities,a=this.getDsCap(s,"create"),o=this.getDsCap(s,"editing"),n=this.getDsCap(s,"delete");return a||o||n})(i.id)||(d=!0),d},this.onCloseLayerPanel=()=>{this.setState({showLayerPanel:!1}),this.index=0},this.getUniqueValues=(e=[],t=[])=>e.concat(t).filter((function(e,t,i){return i.indexOf(e)===t})),this.getUseDataSourcesByDsHash=()=>{const e={};Object.keys(this.dsHash).forEach((i=>{const s=this.dsHash[i].dataSourceId;let a;a=e[s]?(0,t.Immutable)({dataSourceId:this.dsHash[i].dataSourceId,mainDataSourceId:this.dsHash[i].mainDataSourceId,dataViewId:this.dsHash[i].dataViewId,rootDataSourceId:this.dsHash[i].rootDataSourceId,fields:this.getUniqueValues(e[s].fields,this.dsHash[i].fields)}):this.dsHash[i],e[s]=a}));const i=[];return Object.keys(e).forEach((t=>{i.push(e[t])})),i},this.removeLayer=e=>{this.index===e&&this.onCloseLayerPanel();const t=this.props.config.layersConfig.asMutable({deep:!0});t.splice(e,1);const i=this.props.config.set("layersConfig",t);delete this.dsHash[e],this.updateDsHash(t);const s={id:this.props.id,config:i,useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(s),this.index>e&&this.index--,S.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"removeLayerFlag",value:!0})},this.optionChangeSave=(e,t)=>{const i=this.props.config.layersConfig[this.index];if(i){const s=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},i),{[e]:t})),a={id:this.props.id,config:s};this.props.onSettingChange(a)}},this.multiOptionsChangeSave=e=>{const t=this.props.config.layersConfig[this.index];if(t){const i=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},t),e)),s={id:this.props.id,config:i};this.props.onSettingChange(s)}},this.getStyle=e=>t.css`
      .widget-setting-edit {
        .layerlist-tools{
          .layerlist-tools-item{
            display: flex;
            margin-bottom: 8px;
          }
        }

        .filter-item {
          display: flex;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          line-height: 23px;
          cursor: pointer;
          background-color: ${e.colors.secondary};

          .filter-item-icon {
            width: 14px;
            margin-right: 0.5rem;
          }
          .filter-item-name {
            word-wrap: break-word;
          }
        }

        .edit-tips{
          font-style: italic;
          font-size: 12px;
          color: ${e.colors.palette.dark[500]};
        }
        .filter-item-active {
          border-left: 2px solid ${e.colors.palette.primary[600]};
        }
        .capability-header{
          margin-bottom: 12px;
        }
        .capability-item{
          display: flex;
          justify-content: space-between;
          margin-bottom: 12px;
        }
        .edit-blank-placeholder {
          .placeholder-icon {
            color: ${e.colors.palette.dark[200]};
          }
          & > div {
            top: 50%;
            transform: translateY(-50%);
            padding: 1rem;
          }
          p {
            font-size: ${t.polished.rem(14)};
            margin-top: ${t.polished.rem(16)};
            line-height: ${t.polished.rem(19)};
            color: ${e.colors.palette.dark[500]};
          }
        }

        .setting-ui-unit-tree, .setting-ui-unit-list {
          width: 100%;
          .tree-item {
            justify-content: space-between;
            align-items: center;
            font-size: ${t.polished.rem(13)};
            &.tree-item_level-1 {
            }
            .jimu-checkbox {
              margin-right: .5rem;
            }
          }
        }
        .setting-ui-unit-list-new {
          padding-top: ${t.polished.rem(8)};
        }
      }
    `,this.formatMessage=(e,t)=>{const s=Object.assign({},o,i.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:s[e]},t)},this.onMapWidgetSelected=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.onPropertyChange("layersConfig",[])},this.onShowLayerPanel=e=>{const{showLayerPanel:t}=this.state;e===this.index?this.setState({showLayerPanel:!t}):(this.setState({showLayerPanel:!0,refreshPanel:!this.state.refreshPanel}),this.index=e)},this.onItemUpdated=(e,t)=>{const{id:i,config:s}=this.props,a=e.map((e=>e.itemStateDetailContent)),o={id:i,config:s.set("layersConfig",a)};this.updateDsHash(a),this.onShowLayerPanel(t),this.props.onSettingChange(o)},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((i=>{const s=Object.assign({},i.dataSources);return s[e]=t,{dataSources:s}}))},this.isDataSourceAccessible=e=>{var t;const i=(null===(t=this.props.useDataSources)||void 0===t?void 0:t.filter((t=>e===t.dataSourceId)).length)>0;return null!==this.state.dataSources[e]&&i},this.importAll=()=>{var e;const{useMapWidgetIds:i,config:s}=this.props,{layersConfig:a}=s,o=null==i?void 0:i[0];if(!o)return;const n=(null===(e=(0,t.getAppStore)().getState().appStateInBuilder.appConfig.widgets[o])||void 0===e?void 0:e.useDataSources).map((e=>e.dataSourceId)),r=[];n.forEach((e=>{this.dsManager.getDataSource(e).getDataSourcesByType(t.DataSourceTypes.FeatureLayer).forEach((t=>{var i;(null===(i=null==t?void 0:t.getDataSourceJson())||void 0===i?void 0:i.url)&&-1===a.findIndex((e=>e.id===t.id))&&r.push({dataSourceId:t.id,mainDataSourceId:t.id,rootDataSourceId:e})}))})),this.importAllLayersConfigSave(r)},this.onEditModeChange=e=>{this.toBeChangedMode=e;const{config:t}=this.props,{editMode:i,layersConfig:s}=t;0!==s.length?e!==i&&this.setState({changeModeConfirmOpen:!0}):this.onPropertyChange("editMode",this.toBeChangedMode)},this.handleChangeModeOk=()=>{const e=[{name:"editMode",value:this.toBeChangedMode},{name:"layersConfig",value:[]}];this.onMultiplePropertyChange(e),this.setState({changeModeConfirmOpen:!1}),S.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"editModeChange",value:!0})},this.handleChangeModeClose=()=>{this.setState({changeModeConfirmOpen:!1})},this.onPropertyChange=(e,t)=>{const{config:i}=this.props;if(t===i[e])return;const s=i.set(e,t),a={id:this.props.id,config:s};this.props.onSettingChange(a)},this.onMultiplePropertyChange=e=>{const{config:t}=this.props;let i=t;e.forEach((e=>{e.value!==t[e.name]&&(i=i.set(e.name,e.value))}));const s={id:this.props.id,config:i};this.props.onSettingChange(s)},this.index=0,this.dsManager=t.DataSourceManager.getInstance(),this.updateDsHash(this.props.config.layersConfig?this.props.config.layersConfig:[]),this.state={showLayerPanel:!1,refreshPanel:!1,dataSources:{},changeModeConfirmOpen:!1}}getArrayMaxId(e){const t=e.map((e=>e.id.split("-").reverse()[0]));return t.length>0?Math.max.apply(null,t):0}render(){var a,o,r,l;const{showLayerPanel:d,changeModeConfirmOpen:c}=this.state,{theme:p,config:h,useMapWidgetIds:u}=this.props,{layersConfig:m,editMode:g,selfSnapping:f,featureSnapping:y}=h,S=g===e.Attribute,x=g===e.Geometry,C=S?this.formatMessage("newEdit"):this.formatMessage("newEditGeo"),w=S?this.formatMessage("editableSource"):this.formatMessage("editableLayer"),I=m.length,M=(0,t.getAppStore)().getState().appStateInBuilder.appConfig,O=null==u?void 0:u[0],N=x&&(!u||0===(null==u?void 0:u.length)||!(null===(a=M.widgets)||void 0===a?void 0:a[O])),F={isItemFocused:(e,t)=>{const{itemJsons:[i,s]}=t.props;return d&&s.indexOf(i)===this.index},overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:n.TreeItemActionType.RenderOverrideItem,children:[{name:n.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:n.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:n.TreeItemActionType.RenderOverrideItemBody,children:[{name:n.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:n.TreeItemActionType.RenderOverrideItemDragHandle},{name:n.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:n.TreeItemActionType.RenderOverrideItemTitle},{name:n.TreeItemActionType.RenderOverrideItemDetailToggle},{name:n.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,t.jsx)("div",{css:this.getStyle(p)},(0,t.jsx)("div",{className:"widget-setting-edit"},null===(o=this.props.useDataSources)||void 0===o?void 0:o.map(((e,i)=>(0,t.jsx)(b,{key:i,useDataSource:e,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed}))),(0,t.jsx)(s.SettingSection,{className:"p-0 m-0 "+(I>0?"":"border-0")},(0,t.jsx)("div",{ref:this.sidePopperTrigger},(0,t.jsx)(s.SettingSection,{className:"border-0"},(0,t.jsx)(s.SettingRow,null,(0,t.jsx)("div",{className:"layerlist-tools w-100"},(0,t.jsx)("div",{className:"w-100 pb-1"},(0,t.jsx)("div",{className:"layerlist-tools-item radio"},(0,t.jsx)(i.Radio,{id:"edit-attr",style:{cursor:"pointer"},name:"edit-attr",onChange:()=>this.onEditModeChange(e.Attribute),checked:S}),(0,t.jsx)(i.Label,{style:{cursor:"pointer"},for:"edit-attr",className:"ml-1"},this.formatMessage("attrMode")))),(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)("div",{className:"layerlist-tools-item radio"},(0,t.jsx)(i.Radio,{id:"map-view",style:{cursor:"pointer"},name:"map-view",onChange:()=>this.onEditModeChange(e.Geometry),checked:x}),(0,t.jsx)(i.Label,{style:{cursor:"pointer"},for:"map-view",className:"ml-1"},this.formatMessage("geoMode")))))),x&&(0,t.jsx)(A.Fragment,null,(0,t.jsx)(s.SettingRow,{label:this.formatMessage("selectMap")}),(0,t.jsx)(s.SettingRow,null,(0,t.jsx)(s.MapWidgetSelector,{onSelect:this.onMapWidgetSelected,useMapWidgetIds:u}),(0,t.jsx)(i.Button,{icon:!0,size:"sm",type:"default",onClick:this.importAll,className:"ml-1",title:this.formatMessage("importAll"),"aria-label":this.formatMessage("importAll")},(0,t.jsx)(j,null)))),(0,t.jsx)(s.SettingRow,null,(0,t.jsx)(i.Button,{className:"w-100 text-dark set-link-btn",type:"primary",onClick:()=>{this.onShowLayerPanel(I)},disabled:N,title:C},(0,t.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,t.jsx)(D,{className:"mr-1 mb-1"}),C))),(0,t.jsx)(s.SettingRow,null,(0,t.jsx)("div",{className:"text-break edit-tips"},x?this.formatMessage("newMapEditTips"):this.formatMessage("newEditTips")))),(0,t.jsx)(s.SettingSection,{className:"pt-0 border-0"},(0,t.jsx)("div",{className:"setting-ui-unit-list"},!!I&&(0,t.jsx)(n.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:Array.from(h.layersConfig).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateTitle:e.name,itemStateCommands:[{label:this.formatMessage("remove"),iconProps:()=>({icon:k,size:12}),action:()=>{this.removeLayer(t)}}]}))),dndEnabled:!0,renderOverrideItemDetailToggle:(e,s)=>{var a,o;const{itemJsons:n}=s.props,[r]=n,l=null===(o=null===(a=null==r?void 0:r.itemStateDetailContent)||void 0===a?void 0:a.useDataSource)||void 0===o?void 0:o.dataSourceId;return this.isDataSourceAccessible(l)?"":(0,t.jsx)(i.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:this.formatMessage("dataSourceCreateError")})},onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[s,a]=i;this.onItemUpdated(a,+s.itemKey)},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;this.onShowLayerPanel(+i.itemKey)}},F)),I===this.index&&d&&(0,t.jsx)(n.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:e,itemKey:`${this.index}`,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},F,{isItemFocused:()=>!0})))),x&&(null==u?void 0:u.length)>0&&I>0&&(0,t.jsx)(s.SettingSection,{className:"pt-0 border-0"},(0,t.jsx)(s.SettingRow,{label:this.formatMessage("snappingSettings"),className:"capability-header"}),(0,t.jsx)("div",{className:"capability-item",key:"selfSnapping"},(0,t.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("selfSnapping")),(0,t.jsx)(i.Switch,{className:"can-x-switch",checked:f,onChange:e=>this.onPropertyChange("selfSnapping",e.target.checked)})),(0,t.jsx)("div",{className:"capability-item",key:"featureSnapping"},(0,t.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("featureSnapping")),(0,t.jsx)(i.Switch,{className:"can-x-switch",checked:y,onChange:e=>this.onPropertyChange("featureSnapping",e.target.checked)}))))),0===I&&!d&&(0,t.jsx)("div",{className:"w-100 text-center edit-blank-placeholder"},(0,t.jsx)("div",{className:"position-absolute w-100"},(0,t.jsx)(T,{size:48,className:"placeholder-icon"}),(0,t.jsx)("p",null,this.formatMessage("editBlankStatus",{EditString:C,ModeString:w})))),I>0&&(0,t.jsx)(s.SettingSection,{title:this.formatMessage("iconGroup_general")},(0,t.jsx)(s.SettingRow,{flow:"wrap",label:this.formatMessage("description")},(0,t.jsx)(i.TextArea,{className:"w-100",style:{height:"90px"},placeholder:this.formatMessage("editFieldDescription"),value:null!==(r=h.description)&&void 0!==r?r:"",onBlur:e=>this.onPropertyChange("description",e.target.value)})),!x&&(0,t.jsx)(s.SettingRow,{flow:"wrap",label:this.formatMessage("noDataMessage")},(0,t.jsx)(i.TextArea,{className:"w-100",style:{height:"75px"},placeholder:this.formatMessage("noDeataMessageDefaultText"),value:h.noDataMessage,onBlur:e=>this.onPropertyChange("noDataMessage",e.target.value)}))),(0,t.jsx)(s.SidePopper,{isOpen:d&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.onCloseLayerPanel,trigger:null===(l=this.sidePopperTrigger)||void 0===l?void 0:l.current},(0,t.jsx)(v,Object.assign({},h.layersConfig.asMutable({deep:!0})[this.index],{intl:this.props.intl,theme:p,editorConfig:this.props.config,dataSourceChange:this.dataSourceChangeSave,filterDs:this.onFilterDs,optionChange:this.optionChangeSave,multiOptionsChange:this.multiOptionsChangeSave,onClose:this.onCloseLayerPanel}))),c&&(0,t.jsx)(i.ConfirmDialog,{level:"warning",title:this.formatMessage("changeModeConfirmTitle"),hasNotShowAgainOption:!1,content:this.formatMessage("changeModeConfirmTips"),onConfirm:this.handleChangeModeOk,onClose:this.handleChangeModeClose})))}}F.mapExtraStateProps=(e,t)=>{var i,s;return{activeTabId:e&&(null===(s=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.widgetsState[t.id])||void 0===s?void 0:s.activeTabId)}}})(),c})())}}}));