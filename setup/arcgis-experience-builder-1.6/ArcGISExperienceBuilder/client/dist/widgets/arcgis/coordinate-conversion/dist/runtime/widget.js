System.register(["jimu-core","jimu-ui","jimu-arcgis","jimu-ui/advanced/setting-components","esri/widgets/CoordinateConversion/support/Format","esri/tasks/Locator","esri/core/Handles","esri/widgets/CoordinateConversion/support/Conversion","esri/widgets/CoordinateConversion/CoordinateConversionViewModel","esri/geometry/Point","esri/Graphic","esri/layers/GraphicsLayer","esri/symbols/support/jsonUtils","esri/widgets/CoordinateConversion/support/formatUtils","esri/widgets/CoordinateConversion/support/coordinateConversionUtils"],(function(t,e){var s={},i={},o={},a={},n={},r={},l={},p={},d={},u={},h={},c={},m={},g={},f={};return{setters:[function(t){s.BaseWidget=t.BaseWidget,s.React=t.React,s.css=t.css,s.getAppStore=t.getAppStore,s.jsx=t.jsx,s.urlUtils=t.urlUtils},function(t){i.AlertPopup=t.AlertPopup,i.Button=t.Button,i.Checkbox=t.Checkbox,i.Collapse=t.Collapse,i.Icon=t.Icon,i.Label=t.Label,i.ListGroup=t.ListGroup,i.ListGroupItem=t.ListGroupItem,i.Loading=t.Loading,i.LoadingType=t.LoadingType,i.Option=t.Option,i.Popper=t.Popper,i.Select=t.Select,i.TextArea=t.TextArea,i.TextInput=t.TextInput,i.defaultMessages=t.defaultMessages},function(t){o.JimuMapViewComponent=t.JimuMapViewComponent},function(t){a.SettingRow=t.SettingRow},function(t){n.default=t.default},function(t){r.default=t.default},function(t){l.default=t.default},function(t){p.default=t.default},function(t){d.default=t.default},function(t){u.default=t.default},function(t){h.default=t.default},function(t){c.default=t.default},function(t){m.default=t.default},function(t){g.default=t.default},function(t){f.default=t.default}],execute:function(){t((()=>{var t={66549:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M18 14h10.667a2 2 0 110 4H18v10.667a2 2 0 11-4 0V18H3.333a2 2 0 110-4H14V3.333a2 2 0 114 0V14z"></path></svg>'},76635:t=>{t.exports='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M7.294 12.695L.215 5.307a.79.79 0 010-1.083c.287-.299.751-.299 1.038 0L8 11.264l6.747-7.04c.287-.299.751-.299 1.038 0a.79.79 0 010 1.083l-7.08 7.388a.968.968 0 01-1.41 0z" fill="#000"></path><path d="M0 0h16v16H0z"></path></g></svg>'},93321:t=>{t.exports='<svg viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M7.745 7l4.1 4.1a.527.527 0 01-.745.746L7 7.746l-4.1 4.1a.527.527 0 01-.746-.746l4.1-4.1-4.1-4.1a.527.527 0 01.746-.746l4.1 4.1 4.1-4.1a.527.527 0 01.746.746L7.746 7z" fill="#000"></path><path d="M1 1h12v12H1z"></path></g></svg>'},25541:t=>{t.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M.5 9a.5.5 0 01-.5-.5V1a1 1 0 011-1h6.5a.5.5 0 010 1H1v7.5a.5.5 0 01-.5.5zM3 3v8h8V3H3zm0-1h8a1 1 0 011 1v8a1 1 0 01-1 1H3a1 1 0 01-1-1V3a1 1 0 011-1z" fill="#000" fill-rule="nonzero"></path></svg>'},19063:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 32"><path d="M10.942 1.099c2.56-.213 5.227.64 7.36 2.133 3.2 2.24 5.12 6.187 4.587 10.027-.32 2.24-1.28 4.373-2.347 6.4-2.027 3.733-4.693 7.04-7.467 10.24-.32.32-.533.64-.853.853-.427.427-1.173.32-1.493-.107-2.027-2.24-3.947-4.587-5.653-7.04-1.493-2.133-2.88-4.373-3.84-6.827-.533-1.28-.96-2.667-.96-4.053-.107-2.667.747-5.44 2.56-7.573 1.92-2.453 4.907-3.84 8.107-4.053zM9.556 3.232c-2.027.427-3.947 1.6-5.227 3.2a8.366 8.366 0 00-2.027 5.44c0 1.813.64 3.52 1.28 5.12a33.403 33.403 0 003.84 6.187 48.471 48.471 0 004.16 5.12c2.56-2.88 5.013-5.973 6.933-9.387.96-1.707 1.813-3.413 2.24-5.333s0-3.84-.853-5.547c-.96-1.813-2.56-3.307-4.373-4.16-1.92-.853-4.053-.96-5.973-.64zm1.493 2.347c1.6-.213 3.2.32 4.373 1.387 1.173.96 1.813 2.453 1.92 3.947s-.533 2.88-1.493 3.947c-1.067 1.173-2.56 1.813-4.16 1.813-1.493 0-3.093-.64-4.16-1.707-.96-.853-1.6-2.347-1.6-3.733 0-1.493.533-2.987 1.6-3.947.96-1.067 2.133-1.6 3.52-1.707zm-.213 2.133c-1.28.213-2.347 1.28-2.667 2.56-.32 1.173 0 2.347.747 3.2 1.173 1.28 3.2 1.6 4.693.64 1.387-.853 2.027-2.667 1.387-4.16-.533-1.707-2.453-2.667-4.16-2.24z"></path></svg>'},50361:t=>{t.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.938 8A7 7 0 011.01 9H0a8.001 8.001 0 0015.938-1A8 8 0 001.02 3.98L1 .702a.5.5 0 10-1 .006L.031 5.9l5.128-.826a.5.5 0 00-.16-.987L1.819 4.6A7 7 0 0114.938 8z" fill="#000"></path></svg>'},13598:t=>{t.exports='<svg viewBox="0 0 12 12" xmlns="http://www.w3.org/2000/svg"><path d="M7.185 0c.105 0 .195.118.232.24l.013.062.245 1.567c.294.145.588.29.85.465l.19.138 1.53-.603c.154-.05.264-.016.332.031l.036.03 1.224 2.11c.051.1.06.201-.01.302l-.05.06-1.286 1.025c.061.181.061.362.061.603 0 .181-.034.328-.052.467l-.01.136 1.409.965c.105.052.12.192.083.307l-.022.055-1.224 2.11c-.053.104-.195.163-.312.14l-.056-.019-1.53-.603a4.796 4.796 0 01-.82.494l-.22.109-.245 1.568c0 .103-.135.207-.25.234L7.246 12H4.798c-.157 0-.27-.089-.298-.19l-.253-1.619c-.293-.145-.587-.29-.85-.465l-.19-.138-1.53.603c-.153.05-.264.017-.332-.03l-.036-.03L.085 8.02c-.05-.101-.06-.202.01-.302l.051-.06 1.286-1.026c-.061-.18-.061-.362-.061-.603 0-.18.034-.328.051-.466l.01-.137-1.286-.965c-.104-.103-.164-.25-.14-.329L1.247 1.99c.102-.1.204-.16.342-.141l.087.02 1.469.603.419-.281c.135-.09.268-.17.407-.236l.214-.086.245-1.628c0-.103.135-.207.25-.234L4.738 0h2.448zm-.658 1h-1.2l-.243 1.627-.586.192a1.42 1.42 0 00-.3.154l-.503.335-.441.29-1.439-.593-.59 1.017 1.207.905v.5c0 .088-.003.147-.013.228l-.044.31a.577.577 0 00-.004.065l.005.26.005.027.223.66L1.258 8.05l.581 1.001 1.536-.604.45.356c.162.126.334.226.712.416l.618.304.23 1.476h1.274l.23-1.476.751-.371c.206-.106.342-.182.453-.258l.126-.091.451-.356 1.506.595.587-1.01-1.272-.872v-.607l.009-.117.048-.341.003-.035v-.18l-.003-.098-.004-.034-.225-.665 1.345-1.073-.581-1.002-1.535.605-.451-.355-.126-.092a5.312 5.312 0 00-.59-.326l-.614-.303L6.527 1zM6 3.75a2.25 2.25 0 110 4.5 2.25 2.25 0 010-4.5zm0 1a1.25 1.25 0 100 2.5 1.25 1.25 0 000-2.5z" fill="#000" fill-rule="nonzero"></path></svg>'},66721:t=>{t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 0h6v1.5H2.542L6 4.861v1.055L5.916 6H4.857L1.5 2.545V6H0V0zm10 0v1.5h3.457L10 4.861v1.055l.084.084h1.059L14.5 2.545V6H16V0h-6zm4.5 13.455L11.143 10h-1.059l-.084.084v1.055l3.457 3.361H10V16h6v-6h-1.5v3.455zM4.857 10L1.5 13.455V10H0v6h6v-1.5H2.542L6 11.139v-1.055L5.916 10H4.857z"></path></svg>'},68282:t=>{"use strict";t.exports=h},12007:t=>{"use strict";t.exports=l},73570:t=>{"use strict";t.exports=u},62121:t=>{"use strict";t.exports=c},11642:t=>{"use strict";t.exports=m},94884:t=>{"use strict";t.exports=r},26572:t=>{"use strict";t.exports=d},91802:t=>{"use strict";t.exports=p},93105:t=>{"use strict";t.exports=n},51853:t=>{"use strict";t.exports=f},714:t=>{"use strict";t.exports=g},74645:t=>{"use strict";t.exports=o},1810:t=>{"use strict";t.exports=s},21835:t=>{"use strict";t.exports=i},23080:t=>{"use strict";t.exports=a}},e={};function v(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,v),o.exports}v.d=(t,e)=>{for(var s in e)v.o(e,s)&&!v.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},v.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),v.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},v.p="";var C={};return v.p=window.jimuConfig.baseUrl,(()=>{"use strict";v.r(C),v.d(C,{default:()=>E});var t=v(1810),e=v(21835),s=v(74645);function i(e){const s=e.surfaces[1].bg,i=e.colors.palette.primary[700];return t.css`
     overflow: auto;
    .widget-coordinate-conversion {
      padding: 15px 10px 10px 15px;
      background-color: ${s};

      .input-container {
        background-color: ${i};
        padding: 5px;
        border-radius: 2px;

        .jimu-widget-setting--row-label {
          font-weight: bold;
          color: var(--white) !important;
         }

        .actionButton {
          color: var(--primary-200);
          &:hover {
            color: var(--white);
          }
          &:disabled {
            color: var(--primary-400);
          }
        }

         .addBtn svg {
           color: ${i};
         }
        }
      }

      .actionButton {
        margin-left: 2px;
        padding: 0.25rem;
      }

      .actionButton:disabled{
        cursor: default;
      }

      .jimu-widget-setting--row-label {
        font-weight: bold;
      }
    }
  `}const o={_widgetLabel:"Coordinate Conversion",inputPlaceHolder:"Enter Coordinates/Address",errorMsgTitle:"Error",address:"Address",basemap:"Basemap",dd:"DD",ddm:"DDM",dms:"DMS",mgrs:"MGRS",usng:"USNG",utm:"UTM",xy:"Long-Lat",inputLabel:"Input",mapPoint:"Add Point",copyAll:"Copy All",copySuccessMessage:"Copy Successful",zoom:"Zoom",inputSettingsTitle:"Input format settings",defaultCoordinate:"Default coordinate",coordinateLabel:"Label",coordinateFormat:"Format",resetFormat:"Reset format",addConversion:"Add Conversion",addConversionCheckboxLabel:"Add new conversion at the top of the list",outputSettings:"Output Format Settings",expandOutput:"Expand Output",removeCoordinate:"Remove Coordinate",outputSettingsEditPopupTitle:"Edit Conversion",xLabel:"X",yLabel:"Y",latLabel:"Lat",lonLabel:"Lon",eastingLabel:"Easting",northingLabel:"Northing",zoneLabel:"Zone",bandLabel:"Band",gzdLabel:"GZD",gridSquareLabel:"Grid Sq",parseCoordinatesError:"Unable to parse coordinates. Please check your input.",noAddressFoundMsg:"No address found",confirmInputNotation:"Confirm Input Notation",multipleNotationLabel:"notations found that match your input. Please confirm which you would like to use:",latLongWarningMessage:"The input coordinate has been detected as having both a prefix and suffix for the latitude or longitude value, returned coordinate is based on the prefix.",DDLatLongNotation:"Decimal Degrees - Latitude/Longitude",DDLongLatNotation:"Decimal Degrees  - Longitude/Latitude",DDMLatLongNotation:"Degrees Decimal Minutes - Latitude/Longitude",DDMLongLatNotation:"Degrees Decimal Minutes - Longitude/Latitude",DMSLatLongNotation:"Degrees Minutes Seconds - Latitude/Longitude",DMSLongLatNotation:"Degrees Minutes Seconds - Longitude/Latitude",MGRSNotation:"MGRS",USNGNotation:"USNG",UTMBandNotation:"UTM - Band Letter",UTMHemNotation:"UTM - Hemisphere (N/S)",selectAddress:"Select address"};var a=v(23080);const n=v(25541),r=v(13598),l=v(93321),p=v(50361),d=v(76635);class u extends t.React.PureComponent{constructor(s){super(s),this.outputLabel=t.React.createRef(),this._copyOutputTextbox=t.React.createRef(),this._copyDetailsTextbox=t.React.createRef(),this.editTextFocus=t.React.createRef(),this.details1Input=t.React.createRef(),this.details2Input=t.React.createRef(),this.details3Input=t.React.createRef(),this.details4Input=t.React.createRef(),this.componentDidMount=()=>{this.setDetailSection()},this.componentDidUpdate=t=>{t.displayCoordinates!==this.props.displayCoordinates&&this.setDetailSection()},this.nls=t=>{const s=Object.assign({},o,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.onOutputSettingsClick=()=>{this.setState({outputSettingsActive:!this.state.outputSettingsActive,currentOutputFormatLabel:this.state.outputFormatLabel},(()=>{setTimeout((()=>{this.editTextFocus.current.focus()}),500)}))},this.onFormatLabelChange=t=>{this.setState({currentOutputFormatLabel:t.trim()})},this.onFormatChange=t=>{this.setState({outputFormatPattern:t.trim()})},this.onResetButtonClick=()=>{this.setState({outputFormatPattern:this.props.conversionInfo.format.defaultPattern})},this.onOutputSettingsOkClicked=()=>{("address"===this.props.conversionInfo.format.name||""!==this.state.currentOutputFormatLabel&&""!==this.state.outputFormatPattern)&&this.setState({outputSettingsActive:!1,outputFormatLabel:this.state.currentOutputFormatLabel},(()=>{this.props.onCurrentPatternChange(this.props.index,this.state.outputFormatLabel,this.state.outputFormatPattern)}))},this.onOutputSettingsCancelClicked=()=>{this.setState({outputSettingsActive:!1,outputFormatPattern:this.props.conversionInfo.format.currentPattern})},this.onExpandClick=()=>{this.setState({isOutputFormatExpanded:!this.state.isOutputFormatExpanded},(()=>{this.props.onOutPutSettingsActive(this.props.index,this.state.isOutputFormatExpanded)}))},this.onRemoveClick=t=>{this.setState({isRemoveFormatActive:!this.state.isRemoveFormatActive}),this.props.onRemove(this.props.index)},this.onCopyButtonClick=()=>{window.getSelection&&window.getSelection().removeAllRanges(),this._copyOutputTextbox.current.select(),document.execCommand("copy"),this.setState({isCopyMessageOpen:!0}),setTimeout((()=>{window.getSelection&&window.getSelection().removeAllRanges(),this.setState({isCopyMessageOpen:!1})}),500)},this.onCoordinateCopyBtnClick=t=>{let e="";switch(t.currentTarget.id){case"refCopyDetails1"+this.props.parentWidgetId+this.props.index:e=this.state.details1Value,this.setState({isDetails1CopyMessageOpen:!0});break;case"refCopyDetails2"+this.props.parentWidgetId+this.props.index:e=this.state.details2Value,this.setState({isDetails2CopyMessageOpen:!0});break;case"refCopyDetails3"+this.props.parentWidgetId+this.props.index:e=this.state.details3Value,this.setState({isDetails3CopyMessageOpen:!0});break;case"refCopyDetails4"+this.props.parentWidgetId+this.props.index:e=this.state.details4Value,this.setState({isDetails4CopyMessageOpen:!0})}this.setState({copyDetailsTextboxValue:e},(()=>{setTimeout((()=>{this._copyDetailsTextbox.current&&(this._copyDetailsTextbox.current.select(),document.execCommand("copy"),this.setState({isDetails1CopyMessageOpen:!1,isDetails2CopyMessageOpen:!1,isDetails3CopyMessageOpen:!1,isDetails4CopyMessageOpen:!1}))}),500)}))},this.setDetailSection=()=>{const t=this.matchSegments();if(t.length>0)switch(this.props.conversionInfo.format.name){case"basemap":this.setState({details1Label:this.nls("xLabel"),details2Label:this.nls("yLabel"),details1Value:t[0],details2Value:t[1]});break;case"xy":this.setState({details1Label:this.nls("lonLabel"),details2Label:this.nls("latLabel"),details1Value:t[0],details2Value:t[1]});break;case"dd":this.setState({details1Label:this.nls("latLabel"),details2Label:this.nls("lonLabel"),details1Value:t[0],details2Value:t[2]});break;case"dms":this.setState({details1Label:this.nls("latLabel"),details2Label:this.nls("lonLabel"),details1Value:t[0]+" "+t[1]+" "+t[2],details2Value:t[4]+" "+t[5]+" "+t[6]});break;case"ddm":this.setState({details1Label:this.nls("latLabel"),details2Label:this.nls("lonLabel"),details1Value:t[0]+" "+t[1],details2Value:t[3]+" "+t[4]});break;case"usng":case"mgrs":this.setState({details1Label:this.nls("gzdLabel"),details2Label:this.nls("gridSquareLabel"),details3Label:this.nls("eastingLabel"),details4Label:this.nls("northingLabel"),details3Visible:!0,details4Visible:!0,details1Value:t[0],details2Value:t[1],details3Value:t[2],details4Value:t[3]});break;case"utm":this.setState({details1Label:this.nls("zoneLabel"),details2Label:this.nls("bandLabel"),details3Label:this.nls("eastingLabel"),details4Label:this.nls("northingLabel"),details3Visible:!0,details4Visible:!0,details1Value:t[0],details2Value:t[1],details3Value:t[2],details4Value:t[3]})}},this.matchSegments=()=>{let t,e;const s=[];if(this.props&&this.props.conversionInfo&&this.props.conversionInfo.position&&this.props.conversionInfo.position.coordinate){t=this.props.conversionInfo.position.coordinate,e=this.props.conversionInfo.format.coordinateSegments;for(let i=0;i<e.length;i++){const o=e[i],a=t.match(o.searchPattern);if(!a){s.push("");continue}let n=a[0];if(t=t.replace(n,"").trim(),o.substitution){const t=o.substitution.output(n);t&&(n=t)}s.push(this.props.isEmpty?"":n)}}return s},this.showDetailsCopyMsg=()=>{let s=0,i=!1;return this.state.isDetails1CopyMessageOpen?(s=1,i=this.state.isDetails1CopyMessageOpen):this.state.isDetails2CopyMessageOpen?(s=2,i=this.state.isDetails2CopyMessageOpen):this.state.isDetails3CopyMessageOpen?(s=3,i=this.state.isDetails3CopyMessageOpen):this.state.isDetails4CopyMessageOpen&&(s=4,i=this.state.isDetails4CopyMessageOpen),(0,t.jsx)(e.Popper,{open:i,version:0,placement:"bottom",showArrow:!0,reference:"refCopyDetails"+s+this.props.parentWidgetId+this.props.index,offset:[0,0]},(0,t.jsx)("div",{className:"p-2"},this.nls("copySuccessMessage")))},this.formatDisplayCoordinate=t=>{var e,s;return this.props.isRTL&&"xy"===(null===(s=null===(e=this.props.conversionInfo)||void 0===e?void 0:e.format)||void 0===s?void 0:s.name)&&t&&"-"===t.charAt(0)?t.substr(1)+t.substr(0,1):t},this.state={outputSettingsActive:!1,isCopyMessageOpen:!1,isDetails1CopyMessageOpen:!1,isDetails2CopyMessageOpen:!1,isDetails3CopyMessageOpen:!1,isDetails4CopyMessageOpen:!1,isOutputFormatExpanded:!!this.props.isOpen,isRemoveFormatActive:!1,currentOutputFormatLabel:this.props.displayLabel||this.props.conversionInfo.format.name,outputFormatLabel:this.props.displayLabel||this.props.conversionInfo.format.name,outputFormatPattern:this.props.conversionInfo.format.currentPattern,details1Label:"",details2Label:"",details3Label:"",details4Label:"",details3Visible:!1,details4Visible:!1,details1Value:"",details2Value:"",details3Value:"",details4Value:"",copyDetailsTextboxValue:""},this.outputLabel=t.React.createRef(),this.details1Input=t.React.createRef(),this.details2Input=t.React.createRef(),this.details3Input=t.React.createRef(),this.details4Input=t.React.createRef()}render(){const s=(i=this.props.theme,t.css`
  .outputSection {
    border-radius: 2px;
    padding: 5px;
    margin-top: 10px;
  }

  .format-label {
    width: 12.6rem;
  }

  .hidden {
    display: none;
  }

  .hidden-copy-outputCoords {
    opacity: 0.01;
    height: 0;
    position: absolute;
    z-index: -1;
  }

  .arrow-up {
    transform-origin: center center;
    transform: rotate(180deg);
    transition: transform .5s ease 0s;
  }

  .arrow-down {
    transform-origin: center center;
    transform: rotate(0deg);
    transition: transform .5s ease 0s;
  }

  .details-section-label {
    width: 100%;
  }

  .outputSettingsCoordinateLabel {
    margin-top: 5px;
  }

  .outputSettingsFormatLabel {
    margin-bottom: 0px;
    font-weight: bold;
    word-wrap: break-word;
    max-width: calc(100% - 120px);
  }

  .outputSettingsAddressLabel {
    max-width: calc(100% - 60px);
  }

  .invalid-value {
    border: 1px solid ${i.colors.danger};
    box-shadow: 0 0 5px ${i.colors.danger};
  }
  `);var i;return(0,t.jsx)("div",{css:s},(0,t.jsx)("div",{className:"outputSection shadow py-2"},(0,t.jsx)(a.SettingRow,{flow:"wrap"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"outputFormatLabel"+this.props.parentWidgetId+this.props.index,className:"address"===this.props.conversionInfo.format.name?"w-100 outputSettingsFormatLabel outputSettingsAddressLabel":"w-100 outputSettingsFormatLabel"},this.state.outputFormatLabel),(0,t.jsx)(e.Button,{role:"button","aria-labelledby":"outputFormatLabel"+this.props.parentWidgetId+this.props.index,"aria-haspopup":"dialog",title:this.nls("outputSettings"),className:"address"===this.props.conversionInfo.format.name?"hidden":"actionButton",type:"tertiary",icon:!0,size:"sm",active:this.state.outputSettingsActive,onClick:this.onOutputSettingsClick.bind(this)},(0,t.jsx)(e.Icon,{icon:r,size:"17"})),(0,t.jsx)(e.Button,{role:"button","aria-label":this.state.outputFormatLabel,"aria-disabled":this.props.isEmpty,disabled:this.props.isEmpty,title:this.nls("copy"),className:"actionButton",type:"tertiary",icon:!0,size:"sm",active:this.state.isCopyMessageOpen,id:"refCopy"+this.props.parentWidgetId+this.props.index,onClick:this.onCopyButtonClick.bind(this)},(0,t.jsx)(e.Icon,{icon:n,size:"17"})),"address"!==this.props.conversionInfo.format.name&&(0,t.jsx)("div",{className:this.state.isOutputFormatExpanded?"arrow-up":"arrow-down"},(0,t.jsx)(e.Button,{role:"button","aria-labelledby":"outputFormatLabel"+this.props.parentWidgetId+this.props.index,"aria-expanded":this.state.isOutputFormatExpanded,title:this.nls("expandOutput"),className:"actionButton",type:"tertiary",icon:!0,size:"sm",onClick:this.onExpandClick.bind(this)},(0,t.jsx)(e.Icon,{icon:d,size:"17"}))),(0,t.jsx)(e.Button,{role:"button","aria-labelledby":"outputFormatLabel"+this.props.parentWidgetId+this.props.index,title:this.nls("removeCoordinate"),className:"actionButton",type:"tertiary",icon:!0,size:"sm",active:this.state.isRemoveFormatActive,onClick:this.onRemoveClick.bind(this)},(0,t.jsx)(e.Icon,{icon:l,size:"17"})))),(0,t.jsx)("div",{className:"w-100 outputSettingsCoordinateLabel",ref:this.outputLabel},this.props.isEmpty?"":this.formatDisplayCoordinate(this.props.displayCoordinates)),(0,t.jsx)(e.TextArea,{tabIndex:-1,className:"hidden-copy-outputCoords",ref:this._copyOutputTextbox,value:this.props.isEmpty?"":this.props.displayCoordinates}),(0,t.jsx)(e.AlertPopup,{css:s,"aria-expanded":this.state.outputSettingsActive,isOpen:this.state.outputSettingsActive,onClickOk:this.onOutputSettingsOkClicked.bind(this),onClickClose:this.onOutputSettingsCancelClicked.bind(this),title:this.nls("outputSettingsEditPopupTitle")},(0,t.jsx)("table",{cellPadding:10},(0,t.jsx)("tbody",null,(0,t.jsx)("tr",null,(0,t.jsx)("td",null,(0,t.jsx)(e.Label,null,this.nls("coordinateLabel"))),(0,t.jsx)("td",null,(0,t.jsx)(e.TextInput,{required:!0,role:"textbox",ref:this.editTextFocus,"aria-label":this.nls("coordinateLabel"),value:this.state.outputFormatLabel,onAcceptValue:this.onFormatLabelChange,className:""===this.state.currentOutputFormatLabel?"format-label invalid-value":"format-label"}))),(0,t.jsx)("tr",{className:"address"===this.props.conversionInfo.format.name?"hidden":""},(0,t.jsx)("td",null,(0,t.jsx)(e.Label,null,this.nls("coordinateFormat"))),(0,t.jsx)("td",null,(0,t.jsx)(e.TextInput,{required:!0,role:"textbox","aria-label":this.nls("coordinateFormat"),value:this.state.outputFormatPattern,onAcceptValue:this.onFormatChange,className:""===this.state.outputFormatPattern?"invalid-value":""})),(0,t.jsx)("td",null,(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("resetFormat"),title:this.nls("resetFormat"),className:"ml-2",type:"tertiary",size:"sm",onClick:this.onResetButtonClick.bind(this)},(0,t.jsx)(e.Icon,{icon:p,size:"16"}))))))),this.state.isCopyMessageOpen&&(0,t.jsx)(e.Popper,{open:this.state.isCopyMessageOpen,version:0,placement:"bottom",showArrow:!0,reference:"refCopy"+this.props.parentWidgetId+this.props.index,offset:[0,0]},(0,t.jsx)("div",{className:"p-2"},this.nls("copySuccessMessage"))),(0,t.jsx)(e.Collapse,{isOpen:this.state.isOutputFormatExpanded},(0,t.jsx)("div",{className:"pt-2"},(0,t.jsx)(e.TextArea,{tabIndex:-1,className:"hidden-copy-outputCoords",ref:this._copyDetailsTextbox,value:this.state.copyDetailsTextboxValue}),(0,t.jsx)(a.SettingRow,{flow:"wrap"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"details1Label"+this.props.parentWidgetId+this.props.index,className:"details-section-label"},this.state.details1Label),(0,t.jsx)(e.TextInput,{role:"textbox","aria-labelledby":"details1Label"+this.props.parentWidgetId+this.props.index,size:"sm",ref:this.details1Input,value:this.formatDisplayCoordinate(this.state.details1Value),readOnly:!0}),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("copy")+" "+this.state.details1Label,disabled:this.props.isEmpty,title:this.nls("copy")+" "+this.state.details1Label,className:"actionButton",type:"tertiary",icon:!0,size:"sm",id:"refCopyDetails1"+this.props.parentWidgetId+this.props.index,active:this.state.isDetails1CopyMessageOpen,onClick:this.onCoordinateCopyBtnClick.bind(this)},(0,t.jsx)(e.Icon,{icon:n,size:"17"})))),(0,t.jsx)(a.SettingRow,{flow:"wrap"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"details2Label"+this.props.parentWidgetId+this.props.index,className:"details-section-label"},this.state.details2Label),(0,t.jsx)(e.TextInput,{role:"textbox","aria-labelledby":"details2Label"+this.props.parentWidgetId+this.props.index,size:"sm",ref:this.details2Input,value:this.formatDisplayCoordinate(this.state.details2Value),readOnly:!0}),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("copy")+" "+this.state.details2Label,disabled:this.props.isEmpty,title:this.nls("copy")+" "+this.state.details2Label,className:"actionButton",type:"tertiary",icon:!0,size:"sm",id:"refCopyDetails2"+this.props.parentWidgetId+this.props.index,active:this.state.isDetails2CopyMessageOpen,onClick:this.onCoordinateCopyBtnClick.bind(this)},(0,t.jsx)(e.Icon,{icon:n,size:"17"})))),this.state.details3Visible&&(0,t.jsx)(a.SettingRow,{flow:"wrap"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"details3Label"+this.props.parentWidgetId+this.props.index,className:"details-section-label"},this.state.details3Label),(0,t.jsx)(e.TextInput,{role:"textbox","aria-labelledby":"details3Label"+this.props.parentWidgetId+this.props.index,size:"sm",ref:this.details3Input,value:this.state.details3Value,readOnly:!0}),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("copy")+" "+this.state.details3Label,disabled:this.props.isEmpty,title:this.nls("copy")+" "+this.state.details3Label,className:"actionButton",type:"tertiary",icon:!0,size:"sm",id:"refCopyDetails3"+this.props.parentWidgetId+this.props.index,active:this.state.isDetails3CopyMessageOpen,onClick:this.onCoordinateCopyBtnClick.bind(this)},(0,t.jsx)(e.Icon,{icon:n,size:"17"})))),this.state.details3Visible&&(0,t.jsx)(a.SettingRow,{flow:"wrap"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)(e.Label,{id:"details4Label"+this.props.parentWidgetId+this.props.index,className:"details-section-label"},this.state.details4Label),(0,t.jsx)(e.TextInput,{role:"textbox","aria-labelledby":"details4Label"+this.props.parentWidgetId+this.props.index,size:"sm",ref:this.details4Input,value:this.state.details4Value,readOnly:!0}),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("copy")+" "+this.state.details4Label,disabled:this.props.isEmpty,title:this.nls("copy")+" "+this.state.details4Label,className:"actionButton",type:"tertiary",icon:!0,size:"sm",id:"refCopyDetails4"+this.props.parentWidgetId+this.props.index,active:this.state.isDetails4CopyMessageOpen,onClick:this.onCoordinateCopyBtnClick.bind(this)},(0,t.jsx)(e.Icon,{icon:n,size:"17"})))),(this.state.isDetails1CopyMessageOpen||this.state.isDetails2CopyMessageOpen||this.state.isDetails3CopyMessageOpen||this.state.isDetails4CopyMessageOpen)&&this.showDetailsCopyMsg()))))}}var h=v(93105),c=v(94884);function m(t,e){const s=new c.default({url:t});return new h.default({name:"address",getConversionStrategy:()=>"server",conversionInfo:{convert:t=>new Promise(((i,o)=>{if(s)return s.locationToAddress({location:t},{query:{}}).then((s=>{i({coordinate:s&&s.address&&s.score&&s.score>=e?s.address:"",location:t})}),(()=>{i({coordinate:"",location:t})}));i({coordinate:"",location:t})})),reverseConvert:t=>new Promise(((i,o)=>{if(s)return s.addressToLocations({address:{SingleLine:t}},{query:{}}).then((t=>{t&&t.length>0&&(t=(t=t.filter((t=>t.score>=e&&t.location))).sort(((t,e)=>e.score-t.score)),i(t[0])),i(null)}),(()=>{i(null)}));i(null)}))},coordinateSegments:[{alias:"L",description:"Address",searchPattern:/.*/}],defaultPattern:"L"})}const g={selectMapWidgetLabel:"Select a map",inputSettingsLabel:"Input settings",outputSettingsLabel:"Output settings",addressSettingsLabel:"Address settings",generalSettingsLabel:"General settings",defaultCoordinate:"Default coordinate",resetFormat:"Reset format",coordinateLabel:"Label",coordinateFormat:"Format",address:"Address",basemap:"Basemap",dd:"DD",ddm:"DDM",dms:"DMS",mgrs:"MGRS",usng:"USNG",utm:"UTM",xy:"Long-Lat",addNewLabels:"Add new labels",addConversion:"Add Conversion",deleteLabel:"delete",addConversionCheckboxLabel:"Add new conversion at the top of the list",editOutputFormats:"Edit output formats",locatorServiceLabel:"Set locator",minCandidateScore:"Minimum candidate score",invalidLocatorServiceURL:"Please enter valid geocode service url",alertPopupTitle:"Select geocode service",locationSymbol:"Location symbol",symbolLocationHint:"Hint: Symbol for current coordinate location",zoomScale:"Zoom scale"},f=v(50361);class b extends t.React.PureComponent{constructor(t){super(t),this.onCoordinateChange=t=>{this.setState({addDefaultCoordinate:t.target.value},(()=>{const t=this.props.supportedFormats.find((t=>t.name===this.state.addDefaultCoordinate));this.setState({coordinateLabel:t.label}),this.resetToDefaultPattern(this.state.addDefaultCoordinate)}))},this.onFormatLabelChange=t=>{this.setState({coordinateLabel:t.trim()})},this.onFormatChange=t=>{this.setState({currentPattern:t.trim()})},this.onResetButtonClick=()=>{const t=this.state.addDefaultCoordinate;this.resetToDefaultPattern(t)},this.resetToDefaultPattern=t=>{const e=this.props.supportedFormats.find((e=>e.name===t));e&&this.setState({currentPattern:e.defaultPattern})},this.onOkButtonClicked=()=>{if("address"===this.state.addDefaultCoordinate){if(""===this.state.coordinateLabel)return}else if("address"!==this.state.addDefaultCoordinate&&(""===this.state.coordinateLabel||""===this.state.currentPattern))return;this.setState({isAddNewFormatPopperActive:!1}),this.props.onOkClick(this.state.addDefaultCoordinate,this.state.coordinateLabel,this.state.currentPattern,this.state.canAddAtTop),this.props.onClose()},this.onCancelButtonClicked=()=>{this.setState({isAddNewFormatPopperActive:!1}),this.props.onClose()},this.onCheckBoxChange=t=>{this.setState({canAddAtTop:t.target.checked})},this.nls=t=>this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:g[t]}):g[t],this.state={addDefaultCoordinate:this.props.supportedFormats[0].name,isAddNewFormatPopperActive:this.props.isOpen,coordinateLabel:this.props.supportedFormats[0].label,currentPattern:this.props.supportedFormats[0].currentPattern,canAddAtTop:!1}}render(){const s=t.css`
      .hidden{
        display: none;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      .invalid-value {
        border: 1px solid red;
        box-shadow: 0 0 5px red;
      }
    `;return(0,t.jsx)("div",null,(0,t.jsx)(e.AlertPopup,{css:s,"aria-expanded":this.state.isAddNewFormatPopperActive,isOpen:this.state.isAddNewFormatPopperActive&&!t.urlUtils.getAppIdPageIdFromUrl().pageId,onClickOk:this.onOkButtonClicked.bind(this),onClickClose:this.onCancelButtonClicked.bind(this),title:this.nls("addConversion")},(0,t.jsx)("table",{cellPadding:10},(0,t.jsx)("tbody",null,(0,t.jsx)("tr",null,(0,t.jsx)("td",null,(0,t.jsx)(e.Label,null,this.nls("defaultCoordinate"))),(0,t.jsx)("td",null,(0,t.jsx)(e.Select,{"aria-label":this.nls("defaultCoordinate"),name:"defaultCoords",value:this.state.addDefaultCoordinate,onChange:this.onCoordinateChange},this.props.supportedFormats&&this.props.supportedFormats.map(((s,i)=>(0,t.jsx)(e.Option,{tabIndex:0,role:"option","aria-label":s.label,key:i,value:s.name},s.label)))))),(0,t.jsx)("tr",null,(0,t.jsx)("td",null,(0,t.jsx)(e.Label,{className:"mt-2"},this.nls("coordinateLabel"))),(0,t.jsx)("td",null,(0,t.jsx)(e.TextInput,{role:"textbox","aria-label":this.nls("coordinateLabel"),className:""===this.state.coordinateLabel?"invalid-value":"",value:this.state.coordinateLabel,onAcceptValue:this.onFormatLabelChange}))),(0,t.jsx)("tr",{className:"address"===this.state.addDefaultCoordinate?"hidden":""},(0,t.jsx)("td",null,(0,t.jsx)(e.Label,null,this.nls("coordinateFormat"))),(0,t.jsx)("td",null,(0,t.jsx)(e.TextInput,{role:"textbox","aria-label":this.nls("coordinateFormat"),className:""===this.state.currentPattern?"invalid-value":"",value:this.state.currentPattern,onAcceptValue:this.onFormatChange})),(0,t.jsx)("td",null,(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("resetFormat"),title:this.nls("resetFormat"),size:"sm",icon:!0,type:"tertiary",className:"reset-button ml-2",onClick:this.onResetButtonClick.bind(this)},(0,t.jsx)(e.Icon,{icon:f,size:"16"})))),(0,t.jsx)("tr",null,(0,t.jsx)("td",{colSpan:3},(0,t.jsx)(e.Label,{className:"cursor-pointer"},(0,t.jsx)(e.Checkbox,{className:"mr-2 font-13",checked:this.state.canAddAtTop,onChange:this.onCheckBoxChange.bind(this),role:"checkbox","aria-label":this.nls("addConversionCheckboxLabel")}),this.nls("addConversionCheckboxLabel"))))))))}}var x=v(12007),y=v(91802),w=v(26572),L=v(73570),S=v(68282),M=v(62121),I=v(11642),j=v(714),O=v(51853);const P=v(19063),A=v(25541),D=v(66721),N=v(13598),F=v(93321),k=v(50361),R=v(66549);class T extends t.React.PureComponent{constructor(s){super(s),this._inputTextbox=t.React.createRef(),this._copyInputTextbox=t.React.createRef(),this.componentDidMount=()=>{this._inputTextbox.current.focus(),this._isMounted=!0,this.state.coordinateVM||this.createAPIWidget()},this.componentDidUpdate=t=>{if(this.state.coordinateVM){if(t.jimuMapview&&null===this.props.jimuMapview)this.drawingLayer&&this.drawingLayer.removeAll();else if(this.props.jimuMapview&&this.props.jimuMapview.id!==t.jimuMapview.id)this.state.coordinateVM.destroy(),this.drawingLayer.destroy(),this._handles.removeAll(),this.setState({mapPointActive:!1,coordinateVM:null});else if(this.props.config.inputSettings!==t.config.inputSettings)this.setState({defaultCoords:this.props.config.inputSettings.defaultCoordinate,defFormat:this.props.config.inputSettings.format},(()=>{this.onInputSettingsOkClicked()}));else if(this.drawingLayer&&this.drawingLayer.graphics.length>0&&this.props.config.generalSettings.defaultPointSymbol!==t.config.generalSettings.defaultPointSymbol){const t=this.drawingLayer.graphics.getItemAt(0),e=this.props.config.generalSettings.defaultPointSymbol;t.symbol=I.default.fromJSON(e)}}else this.createAPIWidget()},this.componentWillUnmount=()=>{this._isMounted=!1,this.drawingLayer&&(this.drawingLayer.removeAll(),this.drawingLayer.destroy()),this._displayDefaultCursor()},this.createAPIWidget=()=>{if(this.props.locatorURL&&(this.props.jimuMapview&&this.props.jimuMapview.view&&(this.drawingLayer=new M.default({listMode:"hide",title:this.nls("_widgetLabel")+" - Drawing Layer"}),this.props.jimuMapview.view.map.addMany([this.drawingLayer]),this._handles.add(this.props.jimuMapview.view.on("click",(t=>{this.state.mapPointActive&&(this.drawingLayer.removeAll(),t.mapPoint&&this.showConversion(t.mapPoint,!1))}))),this._handles.add(this.props.jimuMapview.view.on("pointer-move",(t=>{this.state.mapPointActive&&this._displayMapPointCursor()})))),!this.state.coordinateVM)){const t=new w.default({view:this.props.jimuMapview?this.props.jimuMapview.view:null});t.watch("messages",(()=>{this._isMounted&&setTimeout((()=>{if(!this._isMounted)return;t.pause();const e=j.default.generateDefaultFormats(t.messages);t.conversions.removeAll();const s=[],i={name:"address",label:this.nls("address"),defaultPattern:"",currentPattern:"",enabled:!0,isCustom:!0};s.push(i);const o=new y.default({format:m(this.props.locatorURL,this.props.minCandidateScore)});t.conversions.add(o),e.forEach((e=>{if("basemap"!==e.name){const i=new y.default({format:e});t.conversions.add(i);const o={name:e.name,label:this.nls(e.name),defaultPattern:e.defaultPattern,currentPattern:e.currentPattern,enabled:!0,isCustom:!0};s.push(o)}})),s.sort(((t,e)=>t.label.localeCompare(e.label))),this.setState({coordinateVM:t,supportedFormats:s})}),400)}))}},this.nls=t=>{const s=Object.assign({},o,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.onMapPointClick=()=>{this.setState({mapPointActive:!this.state.mapPointActive,isAddressOptionsPopupOpen:!1},(()=>{this.state.mapPointActive?this._displayMapPointCursor():this._displayDefaultCursor()}))},this._displayMapPointCursor=()=>{this.props.jimuMapview&&this.props.jimuMapview.view&&this.props.jimuMapview.view&&this.props.jimuMapview.view.container&&"crosshair"!==this.props.jimuMapview.view.container.style.cursor&&(this.props.jimuMapview.view.container.style.cursor="crosshair")},this._displayDefaultCursor=()=>{this.props.jimuMapview&&this.props.jimuMapview.view&&this.props.jimuMapview.view&&this.props.jimuMapview.view.container&&null!==this.props.jimuMapview.view.container.style.cursor&&(this.props.jimuMapview.view.container.style.cursor=null)},this.onCopyClick=()=>{window.getSelection&&window.getSelection().removeAllRanges();const t=this.nls("inputLabel")+"  ("+this.nls(this.currentCoordinateFormat)+")\r\n"+this.state.inputValue;let e=this.props.copyAllList.join("\r\n\n");e=t+"\r\n\n"+e,this._copyInputTextbox.current.value=e,this._copyInputTextbox.current.select(),document.execCommand("copy"),this._copyInputTextbox.current.disabled=!0,this.setState({isCopyMessageOpen:!0}),setTimeout((()=>{window.getSelection&&window.getSelection().removeAllRanges(),this.setState({isCopyMessageOpen:!1}),this._copyInputTextbox.current.disabled=!1}),500)},this.onZoomClick=()=>{if(this.drawingLayer&&this.drawingLayer.graphics.length>0){const t=this.drawingLayer.graphics.getItemAt(0);this.props.jimuMapview.view.goTo({center:t.geometry,scale:this.props.config.generalSettings.zoomScale})}},this.onSettingsClick=()=>{this.setState({isInputSettingsPopupOpen:!this.state.isInputSettingsPopupOpen,isAddressOptionsPopupOpen:!1})},this.onInputSettingsOkClicked=()=>{"address"!==this.state.defaultCoords&&""===this.state.defFormat||(this.setState({isInputSettingsPopupOpen:!1}),this.currentCoordinateFormat=this.state.defaultCoords,this.state.coordinateVM.conversions.some((t=>{if(t.format.name===this.state.defaultCoords)return t.format.currentPattern=this.state.defFormat,!0})),""!==this.state.inputValue&&this.showConversion(this.location,!1))},this.onInputSettingsCancelClicked=()=>{let t="";this.state.coordinateVM.conversions.some((e=>{if(e.format.name===this.currentCoordinateFormat)return t=e.format.currentPattern,!0})),this.setState({isInputSettingsPopupOpen:!1,defaultCoords:this.currentCoordinateFormat,defFormat:t})},this.onInputCoordinateChange=t=>{t.target&&""===t.target.value.trim()?this.setState({inputValue:"",disableCopyZoom:!0}):this.setState({inputValue:t.target.value})},this.showParseCoordinateError=()=>{this.setState({disableCopyZoom:!0}),this.showMessage(this.nls("errorMsgTitle"),this.nls("parseCoordinatesError"))},this.onReverseConvertComplete=t=>{t&&this.showConversion(t,!0),this.props.processing(!1)},this.onErrorInReverseConvert=t=>{this.showParseCoordinateError(),console.error(t.message),this.props.processing(!1)},this.reverseConvertInput=(t,e,s)=>{this.state.coordinateVM.conversions.some((i=>t===i.format.name&&(this.props.processing(!0),s?this.state.coordinateVM.reverseConvert(e,i.format).then(this.onReverseConvertComplete,this.onErrorInReverseConvert):O.default.fromGeoCoordinateString({coordinate:e,spatialReference:i.format.spatialReference,formatName:i.format.name,geometryServicePromise:i.format.get("viewModel.geometryServicePromise")}).then(this.onReverseConvertComplete,this.onErrorInReverseConvert),!0)))},this.getCleanInput=t=>(t=(t=(t=t.split("°‎").join("")).replace(/\n/g,"")).replace(/\s+/g," ").trim()).toUpperCase(),this.getProcessedTextInput=(t,e,s)=>{const i=function(t,e,s){const i=e.pattern.exec(t);let o,a,n,r,l,p,d,u,h,c,m=!1,g=e.name;switch(e.name){case"dd":o=i[2],a=i[7],n=i[10],r=i[16],l=i[3].replace(/[,:]/,"."),p=i[11].replace(/[,:]/,"."),g="dd";break;case"ddrev":o=i[11],a=i[16],n=i[2],r=i[8],l=i[12].replace(/[,:]/,"."),p=i[3].replace(/[,:]/,"."),g="dd";break;case"ddm":o=i[2],a=i[7],n=i[10],r=i[15],l=i[3],d=i[4].replace(/[,:]/,"."),p=i[11],u=i[12].replace(/[,:]/,"."),g="ddm";break;case"ddmrev":o=i[10],a=i[15],n=i[2],r=i[7],l=i[11],d=i[12].replace(/[,:]/,"."),p=i[3],u=i[4].replace(/[,:]/,"."),g="ddm";break;case"dms":o=i[2],a=i[8],n=i[11],r=i[17],l=i[3],d=i[4],h=i[5].replace(/[,:]/,"."),p=i[12],u=i[13],c=i[14].replace(/[,:]/,"."),g="dms";break;case"dmsrev":o=i[11],a=i[17],n=i[2],r=i[8],l=i[12],d=i[13],h=i[14].replace(/[,:]/,"."),p=i[3],u=i[4],c=i[5].replace(/[,:]/,"."),g="dms"}switch(o&&a?(m=!0,o=new RegExp(/[Ss-]/).test(o)?"-":"+"):o=o&&new RegExp(/[Ss-]/).test(o)||a&&new RegExp(/[Ss-]/).test(a)?"-":"+",n&&r?(m=!0,n=new RegExp(/[Ww-]/).test(n)?"-":"+"):n=n&&new RegExp(/[Ww-]/).test(n)||r&&new RegExp(/[Ww-]/).test(r)?"-":"+",g){case"dd":t=o+l+","+n+p;break;case"ddm":t=o+l+" "+d+","+n+p+" "+u;break;case"dms":t=o+l+" "+d+" "+h+","+n+p+" "+u+" "+c}return{prefixSuffixError:m,str:t}}(t,e);return i.prefixSuffixError&&!s&&this.showMessage("",this.nls("latLongWarningMessage")),i.str},this.getCurrentFormat=()=>{let t;return this.state.coordinateVM.conversions.some((e=>this.state.defaultCoords===e.format.name&&(t=e.format,!0))),t},this.tryParsingFormat=(t,e)=>{return s=this,i=void 0,a=function*(){var s,i;try{const o=yield this.state.coordinateVM.reverseConvert(t,e.format);if(o){const a=yield this.state.coordinateVM.updateConversions([e],o);return(null==a?void 0:a.length)>0&&((null===(s=a[0])||void 0===s?void 0:s.displayCoordinate)===this.state.inputValue||(null===(i=a[0])||void 0===i?void 0:i.displayCoordinate)===t)?o:null}}catch(t){return null}},new((o=void 0)||(o=Promise))((function(t,e){function n(t){try{l(a.next(t))}catch(t){e(t)}}function r(t){try{l(a.throw(t))}catch(t){e(t)}}function l(e){var s;e.done?t(e.value):(s=e.value,s instanceof o?s:new o((function(t){t(s)}))).then(n,r)}l((a=a.apply(s,i||[])).next())}));var s,i,o,a},this.onInputKeyDown=t=>{if("Enter"===t.key){const t=this.getCleanInput(this.state.inputValue);(function(t){const e=t;return new Promise(((t,s)=>{const i=[{name:"dd",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([°˚º^~*]*)([NS\+\-\s])*)([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([°˚º^~*]*)([EW\+\-\s])*)$/].map((function(t){return t.source})).join("")),notationType:"DDLatLongNotation",conversionType:"dd"},{name:"ddrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d([,.]\d*)?|1[0-7]\d([,.]\d*)?|180([,.]0*)?)([°˚º^~*]*)([EW\+\-\s])*)/,/([,:;\s|\/\\]+)(([NS\+\-\s])*([0-8]?\d([,.]\d*)?|90([,.]0*)?)([°˚º^~*]*)([NS\+\-\s])*)$/].map((function(t){return t.source})).join("")),notationType:"DDLongLatNotation",conversionType:"dd"},{name:"ddm",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[°˚º^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['′\s_]*([NS\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[°˚º^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['′\s_]*([EW\+\-\s])*)/,/[\s]*$/].map((function(t){return t.source})).join("")),notationType:"DDMLatLongNotation",conversionType:"ddm"},{name:"ddmrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[°˚º^~*\s\-_]+(([0-5]\d|\d)([,.]\d*)?)['′\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[°˚º^~*\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)['′\s_]*([NS\+\-\s])*)[\s]*$/].map((function(t){return t.source})).join("")),notationType:"DDMLongLatNotation",conversionType:"ddm"},{name:"dms",pattern:new RegExp([/^(([NS\+\-\s])*([0-8]?\d|90)[°˚º^~*\s\-_]+([0-5]?\d|\d)['′\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["¨˝\s_]*([NS\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[°˚º^~*\s\-_]+([0-5]\d|\d)['′\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["¨˝\s_]*([EW\+\-\s])*)[\s]*$/].map((function(t){return t.source})).join("")),notationType:"DMSLatLongNotation",conversionType:"dms"},{name:"dmsrev",pattern:new RegExp([/^(([EW\+\-\s])*([0]?\d?\d|1[0-7]\d|180)[°˚º^~*\s\-_]+([0-5]\d|\d)['′\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["¨˝\s_]*([EW\+\-\s])*)/,/([,:;\s|\/\\]+)/,/(([NS\+\-\s])*([0-8]?\d|90)[°˚º^~*\s\-_]+([0-5]?\d|\d)['′\s\-_]+(([0-5]?\d|\d)([,.]\d*)?)["¨˝\s_]*([NS\+\-\s])*)[\s]*$/].map((function(t){return t.source})).join("")),notationType:"DMSLongLatNotation",conversionType:"dms"},{name:"mgrs",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^(\d{1,2}[-,;:\s]*[C-HJ-NP-X][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*)/,/(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*/,/(\d[-,;:\s]+\d|\d{2}[-,;:\s]+\d{2}|\d{3}[-,;:\s]+\d{3}|\d{4}[-,;:\s]+\d{4}|\d{5}[-,;:\s]+\d{5})/,/$|^[ABYZ][-,;:\s]*[A-HJ-NP-Z]{2}[-,;:\s]*(\d{2}|\d{4}|\d{6}|\d{8}|\d{10})?$/].map((function(t){return t.source})).join("")),notationType:"MGRSNotation",conversionType:"mgrs"},{name:"utm",pattern:new RegExp([/^\d{1,2}[-,;:\s]*[c-hj-np-xC-HJ-NP-X][-,;:\s]*\d{1,6}\.?\d*[mM]?[-,;:\s]?\d{1,7}\.?\d*[mM]?$/].map((function(t){return t.source})).join("")),notationType:"UTMBandNotation",conversionType:"utm"}].filter((t=>t.pattern.test(e)));i.length>0?t(i):t([])}))})(t).then((e=>{if(e&&e.length>0)if(1===e.length){const s=e[0].conversionType,i=!("dd"===s||"ddm"===s||"dms"===s),o=this.getProcessedTextInput(t,e[0],!1);this.reverseConvertInput(s,o,i)}else this.confirmInputNotationFromUser(e);else this.props.processing(!0),(s=this.props.locatorURL,i=t,o=this.props.minCandidateScore,new c.default({url:s}).addressToLocations({address:{SingleLine:i}},{query:{}}).then((t=>(t=t.sort(((t,e)=>e.score-t.score))).filter((t=>t.score>=o&&t.location))),(t=>(console.error(t.message),[])))).then((e=>{if(e&&e.length>0)if(1===e.length)this.showConversion(e[0].location,!0);else{const t=[];e.forEach(((e,s)=>{const i={value:e.address+s,label:e.address,mapPoint:e.location};t.push(i)})),this.setState({selectedAddress:t.length>0?t[0].value:"",addressOptions:t,isAddressOptionsPopupOpen:!0})}else if("address"!==this.state.defaultCoords){const e=[];this.state.coordinateVM.conversions.forEach((s=>{"address"!==s.format.name&&e.push(this.tryParsingFormat(t,s))})),e.length>0?Promise.all(e).then((t=>{let e=!1;t.some((t=>!!t&&(e=!0,this.onReverseConvertComplete(t),!0))),e||this.showParseCoordinateError()}),(t=>{this.showParseCoordinateError()})):this.showParseCoordinateError()}else this.showParseCoordinateError();this.props.processing(!1)}));var s,i,o}))}},this.confirmInputNotationFromUser=t=>{const e=[];t.forEach((t=>{const s={value:t.name,label:this.nls(t.notationType),notation:t};e.push(s)})),this.setState({confirmedInputNotation:e[0].value,inputNotationOptions:e,inputNotationWarning:t.length+" "+this.nls("multipleNotationLabel"),isConfirmInputNotationPopupOpen:!0})},this.onSelectedAddressChange=t=>{this.setState({selectedAddress:t},(()=>{this.state.selectedAddress&&(this.state.addressOptions.some((t=>{if(t.value===this.state.selectedAddress)return this.showConversion(t.mapPoint,!0),!0})),this.setState({selectedAddress:"",addressOptions:[],isAddressOptionsPopupOpen:!1}))}))},this.onInputNotationChange=t=>{this.setState({confirmedInputNotation:t.target.value})},this.onConfirmInputOkClicked=()=>{if(this.state.confirmedInputNotation){const t=this.getCleanInput(this.state.inputValue);let e;this.state.inputNotationOptions.some((t=>{if(t.value===this.state.confirmedInputNotation)return e=t.notation,!0}));const s=this.getProcessedTextInput(t,e,!1);this.reverseConvertInput(e.conversionType,s,!1),this.setState({confirmedInputNotation:"",inputNotationOptions:[],isConfirmInputNotationPopupOpen:!1})}},this.onConfirmInputCancelClicked=()=>{this.setState({confirmedInputNotation:"",inputNotationOptions:[],isConfirmInputNotationPopupOpen:!1})},this.onClearInputClick=()=>{this.drawingLayer&&this.drawingLayer.removeAll(),this.setState({inputValue:"",disableCopyZoom:!0,isAddressOptionsPopupOpen:!1},(()=>{this.props.onClear(),this._inputTextbox.current.focus()}))},this.onDefaultCoordsChange=t=>{this.setState({defaultCoords:t.target.value},(()=>{this.resetToDefaultPattern(this.state.defaultCoords)}))},this.onFormatChange=t=>{this.setState({defFormat:t.trim()})},this.onResetButtonClick=()=>{const t=this.state.defaultCoords;this.resetToDefaultPattern(t)},this.resetToDefaultPattern=t=>{const e=this.state.supportedFormats.find((e=>e.name===t));e&&this.setState({defFormat:e.defaultPattern})},this.getProjectedLocation=(t,e)=>{const s=this.state.coordinateVM.formats.findIndex((t=>{if("dd"===t.name)return!0}));return new Promise(((i,o)=>{s>-1&&e?this.state.coordinateVM.formats.getItemAt(s)._project(t,e).then((t=>{i(t)})):i(t)}))},this.showLocationOnMap=(t,e)=>{this.drawingLayer&&this.props.jimuMapview&&this.props.jimuMapview.view&&this.getProjectedLocation(t,this.props.jimuMapview.view.spatialReference).then((t=>{this.drawingLayer.removeAll();const s=new S.default({geometry:t,symbol:I.default.fromJSON(this.props.config.generalSettings.defaultPointSymbol?this.props.config.generalSettings.defaultPointSymbol:{type:"simple-marker",color:[0,76,163],outline:{color:[255,255,255],width:2}})});this.drawingLayer.add(s),e&&this.props.jimuMapview.view.set({center:t})}))},this.showConversion=(t,e)=>{if(this.location=t,this.showLocationOnMap(t,e),this.state.coordinateVM){this.setState({disableCopyZoom:!1});const e=this.state.coordinateVM.conversions.filter((t=>t.format.name===this.currentCoordinateFormat));this.state.coordinateVM.updateConversions(e.toArray(),t).then((e=>{e.forEach((t=>{if(t.format.name===this.currentCoordinateFormat){let e=t.displayCoordinate?t.displayCoordinate:"";"address"===this.currentCoordinateFormat&&""===e&&(e=this.nls("noAddressFoundMsg")),this.setState({inputValue:e})}})),this.props.onConversionComplete(t)}),(t=>{console.log(t.message)}))}},this.onAddConversion=()=>{this.setState({isAddConversionPopupOpen:!0})},this.addNewConversion=(t,e,s,i)=>{this.props.addNewConversion(t,e,s,i)},this.onAddPopperClose=()=>{this.setState({isAddConversionPopupOpen:!1})},this.showMessage=(t,e)=>{this.setState({isErrorMsgPopupOpen:!0,errorMsgPopupTitle:t,errorMsg:e})},this.hideMessage=()=>{this.setState({isErrorMsgPopupOpen:!1,errorMsgPopupTitle:"",errorMsg:""})},this.formatDisplayCoordinate=t=>this.props.isRTL&&this.currentCoordinateFormat&&"xy"===this.currentCoordinateFormat&&t&&"-"===t.charAt(0)?t.substr(1)+t.substr(0,1):t,this.getClearIcon=s=>s.length>0&&(0,t.jsx)("div",{"aria-label":this.nls("clear"),title:this.nls("clear"),onClick:this.onClearInputClick.bind(this)},(0,t.jsx)(e.Icon,{width:14,height:14,icon:F,className:"search-clear"})),this.state={mapPointActive:!1,isInputSettingsPopupOpen:!1,isAddConversionPopupOpen:!1,isCopyMessageOpen:!1,defaultCoords:this.props.config.inputSettings.defaultCoordinate,defFormat:this.props.config.inputSettings.format,disableCopyZoom:!0,inputValue:"",coordinateVM:null,supportedFormats:null,isConfirmInputNotationPopupOpen:!1,inputNotationOptions:[],confirmedInputNotation:"",inputNotationWarning:"",addressOptions:[],selectedAddress:"",isAddressOptionsPopupOpen:!1,isErrorMsgPopupOpen:!1,errorMsgPopupTitle:"",errorMsg:""},this.currentCoordinateFormat=this.props.config.inputSettings.defaultCoordinate,this._handles=new x.default,this.location=new L.default,this._isMounted=!1}render(){var s,i,o;const n=(r=this.props.theme,t.css`
  .labelDimension {
    width: 36%
  }

  .hidden {
    display: none;
  }

  .addressListGroup {
    position: absolute;
    max-height: 10rem;
    overflow-y: auto;
    z-index: 1;
    width: 100%;
    border: 1px solid ${r.border.color};
  }

  .listItem {
    padding: 5px 10px;
    border: none;
    cursor: pointer;
    margin: -7px -8px 6px -8px;
  }

  .listItem:hover {
    background-color: ${r.colors.palette.primary[300]};
  }

  .add-button-row {
    position: relative;
    margin-top: 0 !important;
  }

  .addBtn {
    position: absolute;
    top: 8px;
    cursor: pointer;
    border-radius: 15px;
    margin: 0 auto !important;
    height: 28px;
    width: 28px;
    background-color: ${r.colors.palette.light[100]};
    box-shadow: 0px 0px 2px 2px ${r.border.color} !important;
    display: flex;
    align-items: center;
   }

   .addBtn svg {
     margin: 0 auto;
   }

  .cc-search-input {
    position: relative;
    width: calc(100% - 110px);
    min-width: 100px;

      .search-clear {
        cursor: pointer;
      }

      .search-input {
        padding-right: 0.25rem;
      }

      .search-input::-ms-clear {
        display: none;
      }
  }

  .hidden-copy-input {
    opacity: 0.01;
    height:0;
    position:absolute;
    z-index: -1;
  }

  .search-without-map {
    width: calc(100% - 60px);
  }

  .invalid-value {
    border: 1px solid ${r.colors.danger};
    box-shadow: 0 0 5px ${r.colors.danger};
  }

  `);var r;return(0,t.jsx)("div",{css:n,className:"input-container shadow"},(0,t.jsx)(a.SettingRow,{className:"w-100",label:this.nls("inputLabel")+"  ("+this.nls(this.state.defaultCoords)+")",flow:"wrap"},(0,t.jsx)("div",{className:"d-flex justify-content-between w-100 align-items-center"},(0,t.jsx)("div",{className:(null===(s=this.props.jimuMapview)||void 0===s?void 0:s.view)?"cc-search-input":"cc-search-input search-without-map"},(0,t.jsx)(e.TextInput,{role:"textbox","aria-label":this.nls("inputLabel")+"  ("+this.nls(this.state.defaultCoords)+")",placeholder:this.nls("inputPlaceHolder"),onKeyDown:this.onInputKeyDown,id:"textInput"+this.props.parentWidgetId,ref:this._inputTextbox,onChange:this.onInputCoordinateChange.bind(this),className:"search-input",value:this.formatDisplayCoordinate(this.state.inputValue),suffix:this.getClearIcon(this.formatDisplayCoordinate(this.state.inputValue))}),this.state.isAddressOptionsPopupOpen&&(0,t.jsx)("div",{ref:"textInput"+this.props.parentWidgetId},(0,t.jsx)(e.ListGroup,{className:"addressListGroup p-2 shadow"},this.state.addressOptions&&this.state.addressOptions.map(((s,i)=>(0,t.jsx)(e.ListGroupItem,{tabIndex:0,className:"listItem",key:i,onKeyPress:t=>{"Enter"!==t.key&&" "!==t.key||this.onSelectedAddressChange(s.value)},onClick:()=>this.onSelectedAddressChange(s.value)},s.label))))),(0,t.jsx)(e.TextArea,{tabIndex:-1,className:"hidden-copy-input",ref:this._copyInputTextbox})),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("mapPoint"),title:this.nls("mapPoint"),className:(null===(i=this.props.jimuMapview)||void 0===i?void 0:i.view)?"actionButton":"hidden",type:"tertiary",icon:!0,size:"sm",active:this.state.mapPointActive,onClick:this.onMapPointClick.bind(this)},(0,t.jsx)(e.Icon,{icon:P,size:"17"})),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("copyAll"),"aria-disabled":this.state.disableCopyZoom,title:this.nls("copyAll"),className:"actionButton",type:"tertiary",icon:!0,size:"sm",active:this.state.isCopyMessageOpen,id:"refCopy"+this.props.parentWidgetId,disabled:this.state.disableCopyZoom,onClick:this.onCopyClick.bind(this)},(0,t.jsx)(e.Icon,{icon:A,size:"17"})),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("zoom"),"aria-disabled":this.state.disableCopyZoom,title:this.nls("zoom"),className:(null===(o=this.props.jimuMapview)||void 0===o?void 0:o.view)?"actionButton":"hidden",type:"tertiary",icon:!0,size:"sm",disabled:this.state.disableCopyZoom,onClick:this.onZoomClick.bind(this)},(0,t.jsx)(e.Icon,{icon:D,size:"17"})),(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("inputSettingsTitle"),"aria-haspopup":"dialog",title:this.nls("inputSettingsTitle"),className:"actionButton",type:"tertiary",icon:!0,size:"sm",active:this.state.isInputSettingsPopupOpen,onClick:this.onSettingsClick.bind(this)},(0,t.jsx)(e.Icon,{icon:N,size:"17"})))),(0,t.jsx)(a.SettingRow,{className:"pt-5 add-button-row"},(0,t.jsx)("div",{className:"addBtn",title:this.nls("addConversion"),id:"refAdd"+this.props.parentWidgetId,onClick:this.onAddConversion.bind(this)},(0,t.jsx)(e.Icon,{icon:R,size:"16"}))),(0,t.jsx)(e.AlertPopup,{css:n,"aria-expanded":this.state.isInputSettingsPopupOpen,isOpen:this.state.isInputSettingsPopupOpen,onClickOk:this.onInputSettingsOkClicked.bind(this),onClickClose:this.onInputSettingsCancelClicked.bind(this),title:this.nls("inputSettingsTitle")},(0,t.jsx)("table",{cellPadding:10},(0,t.jsx)("tbody",null,(0,t.jsx)("tr",null,(0,t.jsx)("td",{className:"labelDimension"},(0,t.jsx)(e.Label,null,this.nls("defaultCoordinate"))),(0,t.jsx)("td",null,(0,t.jsx)(e.Select,{"aria-label":this.nls("defaultCoordinate"),name:"defaultCoords",value:this.state.defaultCoords,onChange:this.onDefaultCoordsChange},this.state.supportedFormats&&this.state.supportedFormats.map(((s,i)=>(0,t.jsx)(e.Option,{tabIndex:0,role:"option","aria-label":s.label,key:i,value:s.name},s.label)))))),(0,t.jsx)("tr",{className:"address"===this.state.defaultCoords?"hidden":""},(0,t.jsx)("td",{className:"labelDimension"},(0,t.jsx)(e.Label,null,this.nls("coordinateFormat"))),(0,t.jsx)("td",null,(0,t.jsx)(e.TextInput,{role:"textbox","aria-label":this.nls("coordinateFormat"),value:this.state.defFormat,onAcceptValue:this.onFormatChange,className:""===this.state.defFormat?"invalid-value":""})),(0,t.jsx)("td",null,(0,t.jsx)(e.Button,{role:"button","aria-label":this.nls("resetFormat"),title:this.nls("resetFormat"),className:"ml-2",icon:!0,type:"tertiary",size:"sm",onClick:this.onResetButtonClick.bind(this)},(0,t.jsx)(e.Icon,{icon:k,size:"16"}))))))),this.state.isConfirmInputNotationPopupOpen&&(0,t.jsx)(e.AlertPopup,{css:n,"aria-expanded":this.state.isConfirmInputNotationPopupOpen,isOpen:this.state.isConfirmInputNotationPopupOpen,onClickOk:this.onConfirmInputOkClicked.bind(this),onClickClose:this.onConfirmInputCancelClicked.bind(this),title:this.nls("confirmInputNotation")},(0,t.jsx)("div",{className:"p-2"},(0,t.jsx)(e.Label,null,this.state.inputNotationWarning),(0,t.jsx)("br",null),(0,t.jsx)(e.Select,{"aria-label":this.state.inputNotationWarning,name:"confirmedInputNotation",value:this.state.confirmedInputNotation,onChange:this.onInputNotationChange},this.state.inputNotationOptions&&this.state.inputNotationOptions.map(((s,i)=>(0,t.jsx)(e.Option,{tabIndex:0,role:"option","aria-label":s.label,key:i,value:s.value},s.label)))))),this.state.isErrorMsgPopupOpen&&(0,t.jsx)(e.AlertPopup,{"aria-expanded":this.state.isErrorMsgPopupOpen,hideCancel:!0,isOpen:this.state.isErrorMsgPopupOpen,onClickOk:this.hideMessage.bind(this),onClickClose:this.hideMessage.bind(this),title:this.state.errorMsgPopupTitle},(0,t.jsx)("div",{className:"p-2"},this.state.errorMsg)),this.state.isCopyMessageOpen&&(0,t.jsx)(e.Popper,{open:this.state.isCopyMessageOpen,version:0,placement:"bottom",showArrow:!0,reference:"refCopy"+this.props.parentWidgetId,offset:[0,0]},(0,t.jsx)("div",{className:"p-2"},this.nls("copySuccessMessage"))),this.state.isAddConversionPopupOpen&&this.state.supportedFormats&&this.state.supportedFormats.length>0&&(0,t.jsx)(b,{theme:this.props.theme,supportedFormats:this.state.supportedFormats,intl:this.props.intl,isOpen:this.state.isAddConversionPopupOpen,onOkClick:this.addNewConversion,onClose:this.onAddPopperClose}))}}const V=new L.default;class E extends t.BaseWidget{constructor(e){var s,i,a;super(e),this.nls=t=>this.props.intl.formatMessage({id:t,defaultMessage:o[t]}),this.componentDidMount=()=>{this._isMounted=!0,this.isMapConfigured()||this.createAPIWidget()},this.didOutputSettingsChanged=(t,e)=>{let s=!1;return t.length!==e.length||(t.some(((t,i)=>{if(t.name!==e[i].name||t.label!==e[i].label||t.enabled!==e[i].enabled||t.currentPattern!==e[i].currentPattern)return s=!0,!0})),s)},this.componentDidUpdate=t=>{if(this.props.useMapWidgetIds!==t.useMapWidgetIds||this.didOutputSettingsChanged(this.props.config.outputSettings,t.config.outputSettings)){const e={};this.state.outputFormatCoordVM&&this.state.outputFormatCoordVM&&this.state.outputFormatCoordVM.destroy(),e.outputFormatCoordVM=null,this.isMapConfigured()?this.props.useMapWidgetIds!==t.useMapWidgetIds&&(e.showEmptyOutput=!0):e.jimuMapview=null,this.setState(e,(()=>{this.createAPIWidget()}))}},this.componentWillUnmount=()=>{this._isMounted=!1},this.onActiveViewChange=t=>{t&&t.view&&this.setState({jimuMapview:t},(()=>{this.createAPIWidget()}))},this.createAPIWidget=()=>{if(!this.state.outputFormatCoordVM){const t=new w.default({view:this.state.jimuMapview?this.state.jimuMapview.view:null});t.watch("messages",(()=>{this._isMounted&&setTimeout((()=>{if(!this._isMounted)return;t.pause();const e=j.default.generateDefaultFormats(t.messages);t.conversions.removeAll();const s=[],i=[];let o=!1;if(this._outputDisplayInfos&&this._outputDisplayInfos.length>0&&this._outputDisplayInfos.forEach((e=>{const a=e.format;let n;if(o||e.addedAtRuntime||(o=!0),e.addedAtRuntime)if("address"===a.name){const a=m(this.state.locatorURL,this.props.config.addressSettings.minCandidateScore),n={displayLabel:e.displayLabel,isOpen:e.isOpen,format:a,addedAtRuntime:!0};o?i.push(n):(t.conversions.add(new y.default({format:a})),s.push(n))}else if("basemap"!==a.name){const r=j.default.generateDefaultFormats(t.messages).filter((t=>t.name===a.name));n=new y.default({format:r[0]}),n.format.currentPattern=a.currentPattern;const l={displayLabel:e.displayLabel,isOpen:e.isOpen,format:n.format,addedAtRuntime:!0};o?i.push(l):(t.conversions.add(n),s.push(l))}})),this._outputDisplayInfos=s.slice(),this.props.config&&this.props.config.outputSettings&&this.props.config.outputSettings.length>0)this.props.config.outputSettings.forEach((e=>{if(e.enabled){let s;if("address"===e.name){const s=m(this.state.locatorURL,this.props.config.addressSettings.minCandidateScore);t.conversions.add(new y.default({format:s})),this._outputDisplayInfos.push({displayLabel:e.label,isOpen:!1,format:s})}else if("basemap"!==e.name){const i=j.default.generateDefaultFormats(t.messages).filter((t=>t.name===e.name));s=new y.default({format:i[0]}),s.format.currentPattern=e.currentPattern,t.conversions.add(s),this._outputDisplayInfos.push({displayLabel:e.label,isOpen:!1,format:i[0]})}}})),i&&i.length>0&&i.forEach((e=>{const s=new y.default({format:e.format});t.conversions.add(s),this._outputDisplayInfos.push({displayLabel:e.displayLabel,isOpen:e.isOpen,format:s.format,addedAtRuntime:!0})}));else{const s=m(this.state.locatorURL,this.props.config.addressSettings.minCandidateScore);t.conversions.add(new y.default({format:s})),this._outputDisplayInfos.push({displayLabel:this.nls("address"),isOpen:!1,format:s}),e.forEach((e=>{let s;"basemap"!==e.name&&(s=new y.default({format:e}),s.format.currentPattern=e.currentPattern,t.conversions.add(s),this._outputDisplayInfos.push({displayLabel:this.nls(e.name),isOpen:!1,format:e}))}))}this.setState({outputFormatCoordVM:t},(()=>{null===this.state.selectedInputLocation?this.setState({selectedInputLocation:V,showLoading:!1},(()=>{this.updateOutputConversions()})):this.updateOutputConversions()}))}),400)}))}},this.onCoordinateSystemRemove=t=>{this.state.outputFormatCoordVM.conversions.remove(this.state.outputFormatCoordVM.conversions.getItemAt(t)),this._outputDisplayInfos.splice(t,1),this.updateOutputConversions()},this.updateDisplayState=(t,e)=>{this._outputDisplayInfos[t].isOpen=e},this.updateCurrentPattern=(t,e,s)=>{this.state.outputFormatCoordVM.conversions.getItemAt(t).format.currentPattern=s,this._outputDisplayInfos[t].displayLabel=e,this.updateOutputConversions()},this.updateOutputConversions=()=>{this.state.selectedInputLocation&&this.setState({showLoading:!0},(()=>{this.state.outputFormatCoordVM.updateConversions(this.state.outputFormatCoordVM.conversions.toArray(),this.state.selectedInputLocation).then((()=>{this.state.outputFormatCoordVM&&this.renderOutputList(this.state.outputFormatCoordVM.conversions)}),(t=>{this.setState({showLoading:!1}),console.log(t.message)}))}))},this.renderOutputList=e=>{const s=[];this.outputCoordinateList=[],this.setState({outputList:[]}),e.forEach(((e,i)=>{let o=e.displayCoordinate;const a=this._outputDisplayInfos[i]?this._outputDisplayInfos[i].displayLabel:e.format.name;"address"!==e.format.name||""!==o&&null!==o||(o=this.nls("noAddressFoundMsg")),this.outputCoordinateList.push(a+"\r\n"+o),s.push((0,t.jsx)(u,{displayLabel:a,isOpen:!!this._outputDisplayInfos[i]&&this._outputDisplayInfos[i].isOpen,parentWidgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,index:i,key:i,displayCoordinates:o,onRemove:this.onCoordinateSystemRemove.bind(this),conversionInfo:e,onOutPutSettingsActive:this.updateDisplayState.bind(this),onCurrentPatternChange:this.updateCurrentPattern.bind(this),isEmpty:this.state.showEmptyOutput,isRTL:this.isRTL}))})),this.setState({outputList:s,showLoading:!1})},this.addNewFormat=(t,e,s,i)=>{let o;if("address"===t){const t=m(this.state.locatorURL,this.props.config.addressSettings.minCandidateScore);o=new y.default({format:t})}else{const e=j.default.generateDefaultFormats(this.state.outputFormatCoordVM.messages).filter((e=>e.name===t));e[0].currentPattern=s,o=new y.default({format:e[0]})}const a={displayLabel:e,isOpen:!1,format:o.format,addedAtRuntime:!0};i?(this.state.outputFormatCoordVM.conversions.splice(0,0,o),this._outputDisplayInfos.splice(0,0,a)):(this.state.outputFormatCoordVM.conversions.add(o),this._outputDisplayInfos.push(a)),this.updateOutputConversions()},this.onInputConversionComplete=t=>{this.setState({selectedInputLocation:t||V,showEmptyOutput:!1},(()=>{this.updateOutputConversions()}))},this.onInputProcessing=t=>{this.setState({showLoading:t})},this.onInputClear=()=>{this.setState({selectedInputLocation:V,showEmptyOutput:!0},(()=>{this.updateOutputConversions()}))},this.isMapConfigured=()=>this.props.useMapWidgetIds&&1===this.props.useMapWidgetIds.length,this.canLoadInputSettings=()=>!this.isMapConfigured()||!!this.state.jimuMapview;let n="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer";(null===(i=null===(s=this.props.config)||void 0===s?void 0:s.addressSettings)||void 0===i?void 0:i.geocodeServiceUrl)?n=this.props.config.addressSettings.geocodeServiceUrl:this.props.portalSelf&&this.props.portalSelf.helperServices&&this.props.portalSelf.helperServices.geocode&&this.props.portalSelf.helperServices.geocode.length>0&&this.props.portalSelf.helperServices.geocode[0].url&&(n=this.props.portalSelf.helperServices.geocode[0].url),this.outputCoordinateList=[],this._outputDisplayInfos=[],this._isMounted=!1,this.isRTL=!1;const r=(0,t.getAppStore)().getState();this.isRTL=null===(a=null==r?void 0:r.appContext)||void 0===a?void 0:a.isRTL,this.state={conversionInfo:[],supportedFormats:[],outputFormatCoordVM:null,apiLoaded:!1,jimuMapview:null,outputList:[],locatorURL:n,selectedInputLocation:null,showEmptyOutput:!0,showLoading:!0}}render(){return(0,t.jsx)("div",{css:i(this.props.theme),className:"jimu-widget"},(0,t.jsx)("div",{className:"widget-coordinate-conversion"},this.isMapConfigured()&&(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:this.props.useMapWidgetIds[0],onActiveViewChange:this.onActiveViewChange}),this.canLoadInputSettings()&&(0,t.jsx)(T,{copyAllList:this.outputCoordinateList,parentWidgetId:this.props.id,intl:this.props.intl,config:this.props.config,theme:this.props.theme,jimuMapview:this.state.jimuMapview,locatorURL:this.state.locatorURL,minCandidateScore:this.props.config.addressSettings.minCandidateScore,onConversionComplete:this.onInputConversionComplete,processing:this.onInputProcessing,onClear:this.onInputClear,addNewConversion:this.addNewFormat,isRTL:this.isRTL}),(0,t.jsx)("div",{className:"mt-4"},this.state.outputList),this.state.showLoading&&(0,t.jsx)(e.Loading,{type:e.LoadingType.Secondary})))}}})(),C})())}}}));